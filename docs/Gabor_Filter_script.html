<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8"/>
<title>Gabor Filter script - ImageJ</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Gabor_Filter_script","wgTitle":"Gabor Filter script","wgCurRevisionId":17402,"wgRevisionId":17402,"wgArticleId":1309,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Scripting"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Gabor_Filter_script","wgRelevantArticleId":1309,"wgRequestId":"f06321defbe3fbe507dedb09","wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgPreferredVariant":"en","fancytree_path":"/extensions/TreeAndMenu/fancytree"});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user.cssprefs":"ready","user":"ready","user.options":"loading","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","skins.erudite":"ready"});mw.loader.implement("user.options@0j3lz3q",function($,jQuery,require,module){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens@1ku9xth",function ( $, jQuery, require, module ) {
mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});/*@nomin*/;

});mw.loader.load(["mediawiki.page.startup"]);});</script>
<link rel="stylesheet" href="erudite14.css"/>
<link rel="stylesheet" href="extensions/TreeAndMenu/fancytree/fancytree.css"/><link rel="stylesheet" href="extensions/TreeAndMenu/suckerfish/suckerfish.css"/>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="erudite15.css"/>
<meta name="generator" content="MediaWiki 1.28.0"/>
<meta name="description" content="Five different parameters can be adjusted:"/>
<link rel="shortcut icon" href="skins/ij2.ico"/>

<script type="text/javascript" src="extensions/SyntaxHighlighter/syntaxhighlighter/scripts/shCore.js"></script>
<script type="text/javascript" src="extensions/SyntaxHighlighter/syntaxhighlighter/scripts/shBrushJava.js"></script>
<script type="text/javascript">
SyntaxHighlighter.all();
</script>
<link rel="stylesheet" type="text/css" media="screen" href="extensions/SyntaxHighlighter/syntaxhighlighter/styles/shCoreMinit.css" />

	<meta property="og:type" content="article"/>

	<meta property="og:site_name" content="ImageJ"/>

	<meta property="og:title" content="Gabor Filter script"/>

	<meta property="og:description" content="Five different parameters can be adjusted:"/>


<meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Gabor_Filter_script rootpage-Gabor_Filter_script skin-erudite action-view">
		<div id="top-wrap" role="banner">
			<h1><a href="Welcome" title="ImageJ" rel="home">ImageJ</a></h1>
			<div id="tagline">From ImageJ</div>

			<a id="menubutton" href="Gabor_Filter_script.html#menu">Menu</a>
			<div id="nav" role="navigation">
			<ul id='menu'>
<li id="menu-item-n-About"><a href="ImageJ">About</a></li>
<li id="menu-item-n-Downloads"><a href="Downloads">Downloads</a></li>
<li id="menu-item-n-Learn"><a href="Learn">Learn</a></li>
<li id="menu-item-n-Develop"><a href="Development">Develop</a></li>
<li id="menu-item-n-News"><a href="News">News</a></li>
<li id="menu-item-n-Events"><a href="Events">Events</a></li>
<li id="menu-item-n-Help"><a href="Help">Help</a></li>
</ul>
			</div>
		</div>

		<div id="mw-js-message"></div>
		
		<div id="main" role="main">

			<div id="bodyContent">
				<div style="font-size: large; border: 1px solid black; padding: 1em; margin-bottom: 1em; text-align: center; background-color: #fda;">
					This is an archive of the old MediaWiki-based ImageJ wiki. The current website can be found at <a href="https://imagej.net/">imagej.net</a>.
				</div>

				<h1>Gabor Filter script</h1>
				
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="thumb tright"><div class="thumbinner" style="width:302px;"><a href="./File:Kernel-Gabor-filter.png" class="image"><img alt="" src="images/a/a4/Kernel-Gabor-filter.png" width="300" height="300" class="thumbimage" /></a>  <div class="thumbcaption"><div class="magnify"><a href="./File:Kernel-Gabor-filter.png" class="internal" title="Enlarge"></a></div>Example of a two-dimensional Gabor filter kernel (with a spectrum LUT).</div></div></div> This is an example of how to create <a href="http://en.wikipedia.org/wiki/Gabor_filter" class="extiw" title="wikipedia:Gabor filter">Gabor filters</a> in Fiji using Beanshell scripting. The script will create and apply a set of Gabor filters to the currently selected image.
<p>Five different parameters can be adjusted:
</p>
<ul><li> Sigma, which defines the size of the Gaussian envelope</li>
<li> Psi, the phase offset</li>
<li> Gamma, which is the spatial aspect ratio, and specifies the ellipticity of the support of the Gabor function.</li>
<li> Fx, the frequency of the sinusoidal component</li>
<li> nAngles, the number of filter orientations</li></ul>
<p>As result, the script will display the set of filters, the filtered version of the original image for each orientation, and the projections (average, min, max, mean and variance) of the stack of filtered images.
</p>
<h2><span class="mw-headline" id="Example">Example</span></h2>
<p>This is an example of the script results using the Leaf sample image (<span><em><span style="border-bottom:1px dotted #ccc;"> File </span>&#160;&#8250; <span style="border-bottom:1px dotted #ccc;"> Open Samples </span>&#160;&#8250; <span style="border-bottom:1px dotted #ccc;"> Leaf (36K)</span></em></span>) and sigma = 8.0, gamma = 0.25, psi = 0.0, Fx = 3.0, nAngles = 5.
</p>
<div class="thumb tright"><div class="thumbinner" style="width:762px;"><a href="./File:Montage-Gabor-filter-5-angles.png" class="image"><img alt="" src="images/c/c3/Montage-Gabor-filter-5-angles.png" width="760" height="446" class="thumbimage" /></a>  <div class="thumbcaption"><div class="magnify"><a href="./File:Montage-Gabor-filter-5-angles.png" class="internal" title="Enlarge"></a></div>Demonstration of a Gabor filter applied to the Leaf sample image. Five orientations are shown on the right (0°, 36°, 72°, 108° and 144°). The original Leaf picture is shown on the upper-left corner.</div></div></div>
<h2><span class="mw-headline" id="Code">Code</span></h2>
<pre class="brush:java">
import ij.*;
import ij.process.*;
import ij.plugin.filter.*;
import ij.plugin.ContrastEnhancer;
import ij.plugin.ZProjector;

/**
* This script calculates a set of Gabor filters over the selected image.
*
* Parameters: sigma, gamma, psi, Fx, nAngles
*/

// Sigma defining the size of the Gaussian envelope
sigma = 8.0;
// Aspect ratio of the Gaussian curves
gamma = 0.25;
// Phase
psi = Math.PI / 4.0 * 0;
// Frequency of the sinusoidal component
Fx = 3.0;

// Number of diferent orientation angles to use
nAngles = 5;

// copy original image and transform it to 32 bit 
originalImage = IJ.getImage();
originalImage = new ImagePlus(originalImage.getTitle(), originalImage.getProcessor().convertToFloat());
width = originalImage.getWidth();
height = originalImage.getHeight();

// Apply aspect ratio to the Gaussian curves
sigma_x = sigma;
sigma_y = sigma / gamma;

// Decide size of the filters based on the sigma
largerSigma = (sigma_x &gt; sigma_y)&#160;? (int) sigma_x&#160;: (int) sigma_y;
if(largerSigma &lt; 1)
	largerSigma = 1;
	
ip = originalImage.getProcessor().duplicate();

sigma_x2 = sigma_x * sigma_x;
sigma_y2 = sigma_y * sigma_y;

// Create set of filters

filterSizeX = 19; //6 * largerSigma + 1;
filterSizeY = 19; //6 * largerSigma + 1;


middleX = (int) Math.round(filterSizeX / 2);
middleY = (int) Math.round(filterSizeY / 2);

is = new ImageStack(width, height);
kernels = new ImageStack(filterSizeX, filterSizeY);

rotationAngle = Math.PI/(double)nAngles;
// Rotate kernel from 0 to 180 degrees
for (i=0; i&lt;nAngles; i++)
{	
	theta = rotationAngle * i;
	filter = new FloatProcessor(filterSizeX, filterSizeY);	
	for (int x=-middleX; x&lt;=middleX; x++)
	{
		for (int y=-middleY; y&lt;=middleY; y++)
		{			
			xPrime = (double)x * Math.cos(theta) + (double)y * Math.sin(theta);
		        yPrime = (double)y * Math.cos(theta) - (double)x * Math.sin(theta);
		        
			a = 1.0 / ( 2.0 * Math.PI * sigma_x * sigma_y ) *
                            Math.exp(-0.5 * (xPrime*xPrime / sigma_x2 + yPrime*yPrime / sigma_y2) );
			c = Math.cos( 2.0 * Math.PI * (Fx * xPrime) / filterSizeX + psi); 
			
			filter.setf(x+middleX, y+middleY, (float)(a*c) );
		}
	}
	kernels.addSlice("kernel angle = " + theta, filter);
}

// Show kernels
ip_kernels = new ImagePlus("kernels", kernels);
ip_kernels.show();

// Apply kernels
for (i=0; i&lt;nAngles; i++)
{
	theta = rotationAngle * i;		
	c = new Convolver();				
	
	kernel = (float[]) kernels.getProcessor(i+1).getPixels();
	ip = originalImage.getProcessor().duplicate();		
	c.convolveFloat(ip, kernel, filterSizeX, filterSizeY);		

	is.addSlice("gabor angle = " + i, ip);
}
				
			

// Normalize filtered stack
c = new ContrastEnhancer();
for(int i=1&#160;; i &lt;= is.getSize(); i++)
{
	c.stretchHistogram(is.getProcessor(i), 0.4);
}


projectStack = new ImagePlus("filtered stack",is);
IJ.run(projectStack, "Enhance Contrast", "saturated=0.4 normalize normalize_all");
				
resultStack = new ImageStack(width, height);
				
zp = new ZProjector(projectStack);
zp.setStopSlice(is.getSize());
for (int i=0;i&lt;=5; i++)
{
	zp.setMethod(i);
	zp.doProjection();
	resultStack.addSlice("Gabor_" + i 
			+"_"+sigma+"_" + gamma + "_"+ (int) (psi / (Math.PI/4) ) +"_"+Fx, 
			zp.getProjection().getChannelProcessor());
}

// Display filtered images
(new ImagePlus("gabor, sigma="+sigma+" gamma="+gamma+ " psi="+psi, is)).show();

result= new ImagePlus ("Gabor stack projections", resultStack)&#160;;
IJ.run(result, "Enhance Contrast", "saturated=0.4 normalize normalize_all");
result.show();
</pre>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul><li> <a href="Beanshell_Scripting" class="mw-redirect" title="Beanshell Scripting">Beanshell Scripting</a></li>
<li> <a href="Scripting_Help" class="mw-redirect" title="Scripting Help">Scripting Help</a></li>
<li> <a href="Scripting_comparisons" title="Scripting comparisons">Scripting comparisons</a></li></ul>

<!-- 
NewPP limit report
Cached time: 20200713072355
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.048 seconds
Real time usage: 0.045 seconds
Preprocessor visited node count: 87/1000000
Preprocessor generated node count: 594/1000000
Post‐expand include size: 494/2097152 bytes
Template argument size: 66/2097152 bytes
Highest expansion depth: 6/40
Expensive parser function count: 0/3
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%    6.705      1 - -total
100.00%    6.705      1 - Template:Bc
 28.29%    1.897      2 - Template:Arrow
-->
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="index.php?title=Gabor_Filter_script&amp;oldid=17402">http://imagej.net/index.php?title=Gabor_Filter_script&amp;oldid=17402</a>"</div>
							</div>

			<div id="footer">
				<p> This page was last modified on 24 September 2015, at 13:53.</p><ul><li><a href="./ImageJ:Privacy_policy" title="ImageJ:Privacy policy">Privacy policy</a></li><li><a href="./ImageJ:About" class="mw-redirect" title="ImageJ:About">About ImageJ</a></li><li><a href="Imprint" title="Imprint">Imprint</a></li></ul>			</div>

			<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="./Special:Categories" title="Special:Categories">Category</a>: <ul><li><a href="./Category:Scripting" title="Category:Scripting">Scripting</a></li></ul></div></div>		</div>

		<div id="bottom-wrap">
			<div id="footer-wrap-inner">
				<div id="ternary" class="footer">
					<ul>
						<li class="widget">
							<img id="logo" src="skins/imagej-128.png" alt="">
						</li>
					</ul>
				</div>
			</div>
		</div>
		<script>(window.RLQ=window.RLQ||[]).push(function(){mw.loader.load(["ext.fancytree","ext.suckerfish","mediawiki.action.view.postEdit","site","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest","ext.SimpleTooltip"]);});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":211});});</script>
		</body>
		</html>
		