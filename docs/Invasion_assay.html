<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8"/>
<title>Invasion assay - ImageJ</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Invasion_assay","wgTitle":"Invasion assay","wgCurRevisionId":41269,"wgRevisionId":41269,"wgArticleId":2667,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Invasion_assay","wgRelevantArticleId":2667,"wgRequestId":"732742664fd55606992edc5d","wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgPreferredVariant":"en","fancytree_path":"/extensions/TreeAndMenu/fancytree"});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user.cssprefs":"ready","user":"ready","user.options":"loading","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","skins.erudite":"ready"});mw.loader.implement("user.options@0j3lz3q",function($,jQuery,require,module){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens@1ku9xth",function ( $, jQuery, require, module ) {
mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});/*@nomin*/;

});mw.loader.load(["mediawiki.page.startup"]);});</script>
<link rel="stylesheet" href="erudite14.css"/>
<link rel="stylesheet" href="extensions/TreeAndMenu/fancytree/fancytree.css"/><link rel="stylesheet" href="extensions/TreeAndMenu/suckerfish/suckerfish.css"/>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="erudite15.css"/>
<meta name="generator" content="MediaWiki 1.28.0"/>
<meta name="description" content="SPIM allows for three-dimensional imaging of thick specimens. Among other approaches this can be exploited to analyse invasion of different cell types deep into tissues. Due to their potential role in cancer treatment the invasion of mesenchymal stem cells (MSC) into tumors is a medically relevant issue."/>
<link rel="shortcut icon" href="skins/ij2.ico"/>

<script type="text/javascript" src="extensions/SyntaxHighlighter/syntaxhighlighter/scripts/shCore.js"></script>
<script type="text/javascript" src="extensions/SyntaxHighlighter/syntaxhighlighter/scripts/shBrushBash.js"></script>
<script type="text/javascript" src="extensions/SyntaxHighlighter/syntaxhighlighter/scripts/shBrushJava.js"></script>
<script type="text/javascript">
SyntaxHighlighter.all();
</script>
<link rel="stylesheet" type="text/css" media="screen" href="extensions/SyntaxHighlighter/syntaxhighlighter/styles/shCoreMinit.css" />

	<meta property="og:type" content="article"/>

	<meta property="og:site_name" content="ImageJ"/>

	<meta property="og:title" content="Invasion assay"/>

	<meta property="og:description" content="SPIM allows for three-dimensional imaging of thick specimens. Among other approaches this can be exploited to analyse invasion of different cell types deep into tissues. Due to their potential role in cancer treatment the invasion of mesenchymal stem cells (MSC) into tumors is a medically relevant issue."/>


<meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Invasion_assay rootpage-Invasion_assay skin-erudite action-view">
		<div id="top-wrap" role="banner">
			<h1><a href="Welcome" title="ImageJ" rel="home">ImageJ</a></h1>
			<div id="tagline">From ImageJ</div>

			<a id="menubutton" href="Invasion_assay.html#menu">Menu</a>
			<div id="nav" role="navigation">
			<ul id='menu'>
<li id="menu-item-n-About"><a href="ImageJ">About</a></li>
<li id="menu-item-n-Downloads"><a href="Downloads">Downloads</a></li>
<li id="menu-item-n-Learn"><a href="Learn">Learn</a></li>
<li id="menu-item-n-Develop"><a href="Development">Develop</a></li>
<li id="menu-item-n-News"><a href="News">News</a></li>
<li id="menu-item-n-Events"><a href="Events">Events</a></li>
<li id="menu-item-n-Help"><a href="Help">Help</a></li>
</ul>
			</div>
		</div>

		<div id="mw-js-message"></div>
		
		<div id="main" role="main">

			<div id="bodyContent">
				<div style="font-size: large; border: 1px solid black; padding: 1em; margin-bottom: 1em; text-align: center; background-color: #fda;">
					This is a read-only version of imagej.net, available during the transition to the new website, which you can preview <a href="https://imagej.github.io/">here</a>.
					<br>Please direct any questions or issues to <a href="https://forum.image.sc/t/imagej-wiki-is-down/39672">this Image.sc Forum thread</a>.
					<br>Thank you for your patience as we improve the website!
				</div>

				<h1>Invasion assay</h1>
				
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><table class="infobox" cellspacing="5" style="max-width: 31em; font-size: 90%; text-align: left; float: right; border: 1px solid #a0a0a0;">
<tr>
<th colspan="2" style="text-align: center; font-size: 130%;"> <div style="float: left"></div>Selective Plane Illumination Microscopy Invasion assay (Fiji)<div style="clear: left;"></div>
</th></tr>
<tr>
<th> Author
</th>
<td> Svenja Rühland, David Hörl, Hartmann Harz
</td></tr>




<tr>
<th> Maintainer
</th>
<td> David Hörl
</td></tr>



<tr>
<th> Initial release
</th>
<td> Decembre 2014
</td></tr>
<tr>
<th> Latest version
</th>
<td> Decembre 2014
</td></tr>

<tr>
<th> Category
</th>
<td> <a href="./Category:Registration" title="Category:Registration">Registration</a>
</td></tr>

</table>
<p><br />
</p><p>SPIM allows for three-dimensional imaging of thick specimens. Among other approaches this can be exploited to analyse invasion of different cell types deep into tissues. Due to their potential role in cancer treatment the invasion of mesenchymal stem cells (MSC) into tumors is a medically relevant issue.
</p><p>We developed an <i>in-vitro</i> screening tool to analyse the invasion potential of MSC under different conditions. Therefore, tumor model spheroids with invaded MSC are imaged and their invasion depths are quantified. 
We present here the computational approach to cope with the amount of data our screening invasion assay produces.
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="Invasion_assay.html#Image_processing"><span class="tocnumber">1</span> <span class="toctext">Image processing</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="Invasion_assay.html#Preparation"><span class="tocnumber">1.1</span> <span class="toctext">Preparation</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="Invasion_assay.html#Data_organisation"><span class="tocnumber">1.2</span> <span class="toctext">Data organisation</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="Invasion_assay.html#Usage"><span class="tocnumber">1.3</span> <span class="toctext">Usage</span></a>
<ul>
<li class="toclevel-3 tocsection-5"><a href="Invasion_assay.html#Producer_shell_scripts"><span class="tocnumber">1.3.1</span> <span class="toctext">Producer shell scripts</span></a></li>
<li class="toclevel-3 tocsection-6"><a href="Invasion_assay.html#Executer_shell_scripts"><span class="tocnumber">1.3.2</span> <span class="toctext">Executer shell scripts</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-7"><a href="Invasion_assay.html#Detailed_description_and_source_code_of_the_shell_scripts"><span class="tocnumber">1.4</span> <span class="toctext">Detailed description and source code of the shell scripts</span></a>
<ul>
<li class="toclevel-3 tocsection-8"><a href="Invasion_assay.html#1generate_convert_dir"><span class="tocnumber">1.4.1</span> <span class="toctext">1generate_convert_dir</span></a></li>
<li class="toclevel-3 tocsection-9"><a href="Invasion_assay.html#2convert_TIFFF_TIF_js"><span class="tocnumber">1.4.2</span> <span class="toctext">2convert_TIFFF_TIF_js</span></a></li>
<li class="toclevel-3 tocsection-10"><a href="Invasion_assay.html#3execute_convert_macro_js"><span class="tocnumber">1.4.3</span> <span class="toctext">3execute_convert_macro_js</span></a></li>
<li class="toclevel-3 tocsection-11"><a href="Invasion_assay.html#4generate_register_macros"><span class="tocnumber">1.4.4</span> <span class="toctext">4generate_register_macros</span></a></li>
<li class="toclevel-3 tocsection-12"><a href="Invasion_assay.html#5execute_register_macros"><span class="tocnumber">1.4.5</span> <span class="toctext">5execute_register_macros</span></a></li>
<li class="toclevel-3 tocsection-13"><a href="Invasion_assay.html#6generate_fusion_macros"><span class="tocnumber">1.4.6</span> <span class="toctext">6generate_fusion_macros</span></a></li>
<li class="toclevel-3 tocsection-14"><a href="Invasion_assay.html#7execute_fuse_macros"><span class="tocnumber">1.4.7</span> <span class="toctext">7execute_fuse_macros</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-15"><a href="Invasion_assay.html#Analysis_of_Invasion"><span class="tocnumber">2</span> <span class="toctext">Analysis of Invasion</span></a>
<ul>
<li class="toclevel-2 tocsection-16"><a href="Invasion_assay.html#8bitconversion_macro"><span class="tocnumber">2.1</span> <span class="toctext">8bitconversion_macro</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="Invasion_assay.html#InvasionAnalysis_macro"><span class="tocnumber">2.2</span> <span class="toctext">InvasionAnalysis_macro</span></a></li>
</ul>
</li>
</ul>
</div>

<h1><span class="mw-headline" id="Image_processing">Image processing</span></h1>
<p>Using light sheet microscopy for high-throughput screening results in a significant number of data sets with each data set requiring image processing that consists of a sequence of computational steps. Each of these steps is time consuming making the analysis of many data sets by hand ineffective.
Inspired by the tutorial from Pavel Tomancak (<a rel="nofollow" class="external text" href="https://fiji.sc/SPIM_Registration_on_cluster">Registration on cluster</a>) we developed a collection of linux shell scripts for (semi)automation of the analysis. These scripts are not meant to analyse time lapse data. Please keep in mind that these scripts are written in a quick and dirty fashion and do therefore not contain any protection against incorrect entries or a data organisation that differs from the following description. Feel free to adapt these scripts to your needs. Please keep in mind that there is no guarantee for error free function of these scripts and macros generated thereby.
</p>
<h2><span class="mw-headline" id="Preparation">Preparation</span></h2>
<p>The shell scripts were tested on a linux server (not a cluster) with a fiji installation containing the spim registration plugin. It is assumed that analysis of open spim data by hand works fine. The linux shell scripts must be stored on your linux server in a folder containing a subfolder called macros. In this macro folder the subfolders „converter“, „fuse“ and „register“ have to be present. Later you can find the respective generated fiji macros in these sub folders. Take care to delete macros that are no longer useful in order not to mix them up with newly generated macros. Generation and naming of the macros is done automatically. Therefore names may be identical and macros overwrite one another.
</p>
<pre class="brush:bash"> 
# Basic commands:
# change directory 
cd /path/to/folder
# show content of current directory
ls
# create subfolders: */
mkdir converter fuse register
# delete all data within current directory 
rm *
</pre>
<p><br />
</p>
<h2><span class="mw-headline" id="Data_organisation">Data organisation</span></h2>
<p>A prerequisite for effectively using these scripts is the following data organisation:
Parent folder (e.g. one folder for each measuring day) containing several subfolders each containing original spim data of only one measurement (e.g. control1, condition1, …). These subfolders should be all on the same level (not further nested). In order not to mix original data with computed ones one has to start a shell script first that creates for each measurement a subfolder named „convert” (see below). This folder is located below the folder of the original spim data.
</p><p><br />	
</p>
<h2><span class="mw-headline" id="Usage">Usage</span></h2>
<p>Beside the script generating the convert folder there are two other types of shell scripts: Ones that produce a list of fiji macros and others executing this list one after the other automatically.
</p>
<h3><span class="mw-headline" id="Producer_shell_scripts">Producer shell scripts</span></h3>
<p>Scripts generating macros require two command line parameters: first the complete path and name of the parent data folder and as a second parameter a whole number (integer). The producer scripts will generate one fiji macro per data set named with an ascending order of numbers. This order of numbers start with the second parameter that has been added during the start sequence of the shell script. This allows to generate a list of macros containing more than the macros of only one parent directory. For the second parent directory one should use an integer as command line parameter that is greater than the integer naming the last macro of the first parent directory. All macros are stored in one of the folder „converter“, „fuse“ or „register“ (cf. Preparation).
</p>
<pre class="brush:bash"> 
#Example commands:
./1generate_convert_dir /path/to/data	

./2convert_TIFFF_TIF_js /path/to/data 1
</pre>	
<p>generates:
</p>
<pre>--- macros
| --- converter
 | --- ...1.js
 | --- ...2.js
 | --- …		
</pre>
<p><br />
</p>
<h3><span class="mw-headline" id="Executer_shell_scripts">Executer shell scripts</span></h3>
<p>In order to keep control over data processing the macros generated by the producer scripts are not executed automatically making a pre-check possible.  Executer scripts will start fiji in a headless mode and execute the macros one by one. Therefore executer macros do not require any parameter, they execute all macros stored in the respective folder „converter“, „fuse“ or „register“ (cf. Preparation).
</p><p><br />	
</p>
<pre class="brush:bash"> 
#Example command:
./3execute_convert_macro_js
</pre>	
<p><br />
</p>
<h2><span class="mw-headline" id="Detailed_description_and_source_code_of_the_shell_scripts">Detailed description and source code of the shell scripts</span></h2>
<p>The scripts build on one another meaning that the output of one script is the input or a prerequisite for the next one. Therefore the scripts are marked with ascending numbers to simplify usage.
</p>
<h3><span class="mw-headline" id="1generate_convert_dir">1generate_convert_dir</span></h3>
<p>In order not to mix original data with computed ones we create for each measurement a subfolder named „convert“. This folder will be located in the subfolder containing the original spim data. 1generate_convert_dir automatically generates the „convert“ folders in all folders below the parent folder given as a command line parameter.  Specify complete path and name of the parent directory, but not a second parameter.
</p>
<pre class="brush:bash"> 
#.................................................................................
#generates a directory 'convert' in all subdirectories below the directroy given as the 
#first parameter
#................................................................................

#!/bin/bash


echo "Start Macro"
Path="${1}"
echo ${Path}

ls -d ${Path}/*  &gt; dir

while read line
do
    mkdir $line/convert
    echo generated $line/convert
done &lt; dir





#--------------------------------------------------------------------------------------
#executes the macros one after the other
# fiji --headless -macro /opt/Fiji.app/plugins/Macros/OpenSPIM_OME_TIFF_TIF_converter.ijm
# fiji --headless -macro /opt/Fiji.app/plugins/Macros/OpenSPIM_OME_TIFF_TIF_converter.ijm
# fiji --headless -macro /opt/Fiji.app/plugins/Macros/OpenSPIM_OME_TIFF_TIF_converter.ijm
#-------------------------------------------------------------------------------------
echo "End Macro"
</pre>
<p><br />
</p>
<h3><span class="mw-headline" id="2convert_TIFFF_TIF_js">2convert_TIFFF_TIF_js</span></h3>
<p>Shell script generates fiji macros doing the <a rel="nofollow" class="external text" href="http://openspim.org/Pre-processing">pre-processing</a> of spim data. Specify complete path to data and an integer for each data directory as second parameter (cf. Usage). These macros are stored in the folder „./macros/converter“.
</p>
<pre class="brush:bash"> 
#!/bin/bash
echo "Start Macro"
Path="${1}"
resultmacro_number="${2}"
echo ${Path}
resultmacro=./macros/converter/
ls -d ${Path}/*  &gt; dirlist

while read line
do
    echo 'importClass(Packages.ij.IJ);'                                             &gt; $resultmacro${resultmacro_number}.js  
    echo 'for (var a=0;a&lt;=4;a++)'                                                  &gt;&gt; $resultmacro${resultmacro_number}.js
    echo '{'                                                                       &gt;&gt; $resultmacro${resultmacro_number}.js
    echo 'var imp = IJ.openImage("'${line}'/spim_TL01_Angle" + a + ".ome.tiff");'  &gt;&gt; $resultmacro${resultmacro_number}.js
    echo 'imp.show();'                                                             &gt;&gt; $resultmacro${resultmacro_number}.js
    echo 'IJ.saveAs("'Tiff'", "'${line}'/convert/spim_TL01_Angle" + a + ".tif");'  &gt;&gt; $resultmacro${resultmacro_number}.js
    echo 'imp.close();'                                                            &gt;&gt; $resultmacro${resultmacro_number}.js
    echo '}'                                                                       &gt;&gt; $resultmacro${resultmacro_number}.js
    echo $resultmacro_number
    let resultmacro_number=$resultmacro_number+1         
done &lt; dirlist



#.................................................................................
#generates a directory 'convert' in all subdirectories below the directroy given as the 
#first parameter
#................................................................................


echo "End Macro"

</pre>
<h3><span class="mw-headline" id="3execute_convert_macro_js">3execute_convert_macro_js</span></h3>
<p>Executes the macros generated by the 2convert_TIFFF_TIF_js script. Processed data will be stored in the „convert“ subfolder located under the original data folder.
</p>
<pre class="brush:bash"> 
#!/bin/bash
clear
echo "Start Macro"
ls -d ./macros/converter/*  &gt; macrolist

while read line
do
    echo "start converting $line"    
    fiji $line
    echo "end converting $line"
done &lt; macrolist







#--------------------------------------------------------------------------------------
#executes the macros one after the other
# fiji /home/hh/programs/macros/converter/1.js
#            .
#            .
#            .
# fiji /home/hh/programs/macros/converter/n.js
#-------------------------------------------------------------------------------------
echo "End Macro"

</pre>
<h3><span class="mw-headline" id="4generate_register_macros">4generate_register_macros</span></h3>
<p>Shell script that generates fiji macros doing <a rel="nofollow" class="external text" href="http://openspim.org/Registration">registration</a> of spim data. Before using this script you have to adopt the registration parameters to the needs of the respective experiment. Specify complete path to data and an integer for each data directory as second parameter (cf. Usage). These macros are stored in the folder „./macros/register“.
</p>
<pre class="brush:bash"> 
#!/bin/bash
echo "Start Macro"
Path="${1}"
resultmacro_number="${2}"
echo ${Path}
resultmacro=./macros/register/
ls -d ${Path}/*  &gt; dirlist


while read line
do
    echo $resultmacro_number
#generation of JavaScript macros starts here
    echo "importClass (Packages.ij.IJ);"                                                               &gt; $resultmacro${resultmacro_number}.js
    echo "importClass (Packages.ij.ImagePlus);"                                                       &gt;&gt; $resultmacro${resultmacro_number}.js
    echo "IJ.run('Bead-based registration', 'select_type_of_registration=Single-channel' + ' ' +"     &gt;&gt; $resultmacro${resultmacro_number}.js
    echo "'select_type_of_detection=[Difference-of-Mean (Integral image based)] ' + ' ' +"            &gt;&gt; $resultmacro${resultmacro_number}.js
    echo "'spim_data_directory=' +'"$line"'+'/convert/' + ' ' +"                                      &gt;&gt; $resultmacro${resultmacro_number}.js
    echo "'pattern_of_spim=spim_TL0{t}_Angle{a}.tif' + ' ' +"                                         &gt;&gt; $resultmacro${resultmacro_number}.js
    echo "'timepoints_to_process=' + '1' + ' ' +"                                                     &gt;&gt; $resultmacro${resultmacro_number}.js
    echo "'angles_to_process=' + '0-4' + ' ' +"                                                       &gt;&gt; $resultmacro${resultmacro_number}.js
    echo "'bead_brightness=[Advanced ...]' + ' ' +"                                                   &gt;&gt; $resultmacro${resultmacro_number}.js
    echo "'subpixel_localization=[3-dimensional quadratic fit (all detections)]' + ' ' +"             &gt;&gt; $resultmacro${resultmacro_number}.js
    echo "'specify_calibration_manually xy_resolution=0.658 z_resolution=6.0' + ' ' +"                &gt;&gt; $resultmacro${resultmacro_number}.js
    echo "'transformation_model=Affine' + ' ' +"                                                      &gt;&gt; $resultmacro${resultmacro_number}.js
    echo "'channel_0_radius_1=2' + ' ' +"                                                             &gt;&gt; $resultmacro${resultmacro_number}.js
    echo "'channel_0_radius_2=3' + ' ' +"                                                             &gt;&gt; $resultmacro${resultmacro_number}.js
    echo "'channel_0_threshold=0.004'"                                                                &gt;&gt; $resultmacro${resultmacro_number}.js
    echo ");"                                                                                         &gt;&gt; $resultmacro${resultmacro_number}.js
#generation of JavaScript macro ends here
    let resultmacro_number=$resultmacro_number+1
done &lt; dirlist



#.................................................................................
#To run SPIM_registration type 'SPIM_registration Path_of_SPIM_Data'
#outpus are one Java Script macro pro subdirectory in 'Path_of_SPIM_Data' with name convention 'i.js' This macro register spim data in the rescpective directory
#start macros by typing fiji i.js
#................................................................................

</pre>
<h3><span class="mw-headline" id="5execute_register_macros">5execute_register_macros</span></h3>
<p>Executes the macros generated by the 4generate_register_macros.
</p>
<pre class="brush:bash"> 
#!/bin/bash
clear
echo "Start Macro"
ls -d ./macros/register/*  &gt; macrolist


while read line
do
    echo start converting $line    
    fiji $line
    echo end converting $line
done &lt; macrolist





#--------------------------------------------------------------------------------------
#executes the register macros one after the other
#-------------------------------------------------------------------------------------
echo "End Macro"

</pre>
<h3><span class="mw-headline" id="6generate_fusion_macros">6generate_fusion_macros</span></h3>
<p>Shell script that generates fiji macros doing <a rel="nofollow" class="external text" href="http://openspim.org/Fusion">fusion</a> of spim data. Before using this script you have to adopt the fusion parameters to the needs of the respective experiment. Specify complete path to data and an integer for each data directory as second parameter (cf. Usage). These macros are stored in the folder „./macros/fuse“.
</p>
<pre class="brush:bash"> 
#!/bin/bash
echo "Start Macro"
Path="${1}"
resultmacro_number="${2}"
echo ${Path}
resultmacro=./macros/fuse/
ls -d ${Path}/*  &gt; dirlist


while read line
do
    echo $resultmacro_number
#generation of JavaScript macros starts here

echo "importClass (Packages.ij.IJ);"                                                          &gt; $resultmacro${resultmacro_number}.js
echo "importClass (Packages.ij.ImagePlus);"                                                  &gt;&gt; $resultmacro${resultmacro_number}.js

echo "IJ.run('Multi-view fusion', 'select_channel=Single-channel' + ' ' +"                   &gt;&gt; $resultmacro${resultmacro_number}.js
echo "'spim_data_directory=' +'"$line"'+'/convert/' + ' ' +"                                 &gt;&gt; $resultmacro${resultmacro_number}.js     
echo "'pattern_of_spim=spim_TL0{t}_Angle{a}.tif timepoints_to_process=' + '1' + ' ' +"       &gt;&gt; $resultmacro${resultmacro_number}.js
echo "'pattern_of_spim=spim_TL0{t}_Angle{a}.tif' + ' ' +"                                    &gt;&gt; $resultmacro${resultmacro_number}.js
echo "'angles=' + '0-4' + ' ' +"                                                             &gt;&gt; $resultmacro${resultmacro_number}.js
echo "'fusion_method=[Fuse into a single image]' + ' ' +"                                    &gt;&gt; $resultmacro${resultmacro_number}.js
echo "'process_views_in_paralell=All' + ' ' +"                                               &gt;&gt; $resultmacro${resultmacro_number}.js
echo "'blending' + ' ' +"                                                                    &gt;&gt; $resultmacro${resultmacro_number}.js
echo "'content_based_weights_(fast,' + ' ' +"                                                &gt;&gt; $resultmacro${resultmacro_number}.js
echo "'downsample_output=1' + ' ' +"                                                         &gt;&gt; $resultmacro${resultmacro_number}.js
echo "'registration=[Individual registration of channel 0]' + ' ' +"                         &gt;&gt; $resultmacro${resultmacro_number}.js
echo "'crop_output_image_offset_x=' + '0' + ' ' +"                                           &gt;&gt; $resultmacro${resultmacro_number}.js
echo "'crop_output_image_offset_y=' + '0' + ' ' +"                                           &gt;&gt; $resultmacro${resultmacro_number}.js
echo "'crop_output_image_offset_z=' + '0' + ' ' +"                                           &gt;&gt; $resultmacro${resultmacro_number}.js
echo "'crop_output_image_size_x=' + '0' + ' ' +"                                             &gt;&gt; $resultmacro${resultmacro_number}.js
echo "'crop_output_image_size_y=' + '0' + ' ' +"                                             &gt;&gt; $resultmacro${resultmacro_number}.js
echo "'crop_output_image_size_z=' + '0' + ' ' +"                                             &gt;&gt; $resultmacro${resultmacro_number}.js
echo "'fused_image_output=[Save 2d-slices, all in one directory]');"                         &gt;&gt; $resultmacro${resultmacro_number}.js


#generation of JavaScript macro ends here
    let resultmacro_number=$resultmacro_number+1
done &lt; dirlist



#.................................................................................
#To run SPIM_registration type 'SPIM_registration Path_of_SPIM_Data'
#outpus are one Java Script macro pro subdirectory in 'Path_of_SPIM_Data' with name convention 'i.js' This macro register spim data in the rescpective directory
#start macros by typing fiji i.js
#................................................................................

</pre>
<h3><span class="mw-headline" id="7execute_fuse_macros">7execute_fuse_macros</span></h3>
<p>Executes the macros generated by the 7execute_fuse_macros.
</p>
<pre class="brush:bash"> 
#!/bin/bash
clear
echo "Start Macro"


ls -d ./macros/fuse/*  &gt; macrolist


while read line
do
    echo "start fusing $line"    
    fiji $line
    echo "end fusing $line"
done &lt; macrolist





#--------------------------------------------------------------------------------------
#executes the register macros one after the other
#-------------------------------------------------------------------------------------
echo "End Macro"

</pre>
<h1><span class="mw-headline" id="Analysis_of_Invasion">Analysis of Invasion</span></h1>
<p>The strategy implemented here involves segmentation, i.e. three-dimensional localisation, of both spheroids and invaded cells and measuring invasion depths.
In contrast to the prior image processing steps the following macros are conducted directly within the fiji user interface. This allows firsthand control on the analysis.
</p>
<h3><span class="mw-headline" id="8bitconversion_macro">8bitconversion_macro</span></h3>
<p>Fiji macro converting fused spim data to 8-bit files required for further analysis. The macro imports image sequences out of each “convert” folder and stores 8-bit files into a new output directory. Before using this script you have to adopt the scale parameters to the needs of the respective experiment.
</p><p><br />
</p>
<pre class="brush:java">
input = "path\\to\\data\\"
output = "path\\to\\converted\\data\\"

function convert(input, output, filename) {
	run("Image Sequence...", 
	"open=" + input + filename + "\\convert\\output\\img_tl1_ch0_z000.tif sort");
// set properties	
        run("Properties...", 
	"channels=1 frames=1 unit=um pixel_width=2.632 pixel_height=2.632 voxel_depth=2.632");

// set conversion scale
	run("Brightness/Contrast...");
	setMinAndMax(0, 30000);
	call("ij.ImagePlus.setDefault16bitRange", 8);
	run("8-bit");

// save .tif
  	index = lastIndexOf(filename, "/");
  	if (index!=-1) filename = substring(filename, 0, index);
	saveAs("Tiff", output + filename );
	close();
}

list = getFileList(input);
for (i = 0; i &lt; list.length; i++)
        convert(input, output, list[i]);

</pre>
<h3><span class="mw-headline" id="InvasionAnalysis_macro">InvasionAnalysis_macro</span></h3>
<p>Fiji macro doing analysis of cell invasion depths. Both spheroids and invaded cells are segmented and the shortest distance of each invaded cell to the surface of the spheroid is displayed. Analysis is based on the 3D object counter and 3D manager fiji plugins. Before using this script you have to adopt the threshold parameters for segmentation to the needs of the respective experiment.
</p><p><br />
</p>
<pre class="brush:java">
input = "path\\to\\data\\";
output = "path\\to\\results\\";
// Thresholds for segmentation:
// spheroidThreshold =&#160;;
// mscThreshold =&#160;;

function distances(input, output, filename) {
// segmentation
	open (input + filename);
	run("3D Objects Counter", "threshold=spheroidThreshold slice=100 min.=80000 max.=45925560 surfaces");
	selectWindow(filename);
	run("3D Objects Counter", "threshold=mscThreshold slice=100 min.=400 max.=45925560 objects"); 


// distances
	Objects = "Objects map of " + filename&#160;;
	Sphero = "Surface map of " + filename&#160;;
	run("3D Manager");
	selectWindow(Sphero);
	Ext.Manager3D_AddImage();
	selectWindow(Objects);
	Ext.Manager3D_AddImage();
	Ext.Manager3D_Count(nb_obj);
	for (i = 2; i &lt; nb_obj-1; i++) {
        	Ext.Manager3D_Dist2(0,i,"c2b1",dist); 
        	index = lastIndexOf(filename, ".tif");
  		if (index!=-1) filename = substring(filename, 0, index);
		setResult(filename,i-2,dist);
	}

// save results
	run("Set Measurements...", "  mean limit redirect=None decimal=0");
	saveAs ("Results", output + filename + ".txt");
	Ext.Manager3D_Close();
	close(filename);
	close(Sphero);
	close(Objects);
}

list = getFileList(input);
for (i = 0; i &lt; list.length; i++)
        distances(input, output, list[i]);

</pre>

<!-- 
NewPP limit report
Cached time: 20200713072739
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.020 seconds
Real time usage: 0.023 seconds
Preprocessor visited node count: 231/1000000
Preprocessor generated node count: 823/1000000
Post‐expand include size: 748/2097152 bytes
Template argument size: 285/2097152 bytes
Highest expansion depth: 3/40
Expensive parser function count: 0/3
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%    5.249      1 - Template:Infobox
100.00%    5.249      1 - -total
-->
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="index.php?title=Invasion_assay&amp;oldid=41269">http://imagej.net/index.php?title=Invasion_assay&amp;oldid=41269</a>"</div>
							</div>

			<div id="footer">
				<p> This page was last modified on 24 January 2020, at 11:54.</p><ul><li><a href="./ImageJ:Privacy_policy" title="ImageJ:Privacy policy">Privacy policy</a></li><li><a href="./ImageJ:About" class="mw-redirect" title="ImageJ:About">About ImageJ</a></li><li><a href="Imprint" title="Imprint">Imprint</a></li></ul>			</div>

			<div id="catlinks" class="catlinks catlinks-allhidden" data-mw="interface"></div>		</div>

		<div id="bottom-wrap">
			<div id="footer-wrap-inner">
				<div id="ternary" class="footer">
					<ul>
						<li class="widget">
							<img id="logo" src="skins/imagej-128.png" alt="">
						</li>
					</ul>
				</div>
			</div>
		</div>
		<script>(window.RLQ=window.RLQ||[]).push(function(){mw.loader.load(["ext.fancytree","ext.suckerfish","mediawiki.toc","mediawiki.action.view.postEdit","site","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest","ext.SimpleTooltip"]);});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":245});});</script>
		</body>
		</html>
		