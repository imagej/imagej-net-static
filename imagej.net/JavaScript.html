<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8"/>
<title>JavaScript Scripting - ImageJ</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"JavaScript_Scripting","wgTitle":"JavaScript Scripting","wgCurRevisionId":41271,"wgRevisionId":41271,"wgArticleId":20,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Scripting"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"JavaScript_Scripting","wgRelevantArticleId":20,"wgRequestId":"83916e3025590ab928a21ee2","wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgPreferredVariant":"en","fancytree_path":"/extensions/TreeAndMenu/fancytree"});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user.cssprefs":"ready","user":"ready","user.options":"loading","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","skins.erudite":"ready"});mw.loader.implement("user.options@0j3lz3q",function($,jQuery,require,module){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens@1ku9xth",function ( $, jQuery, require, module ) {
mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});/*@nomin*/;

});mw.loader.load(["mediawiki.page.startup"]);});</script>
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%252Cshared%257Cmediawiki.sectionAnchor%257Cskins.erudite&amp;only=styles&amp;skin=erudite.css"/>
<script async="" src="load.php%3Fdebug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=erudite"></script>
<link rel="stylesheet" href="extensions/TreeAndMenu/fancytree/fancytree.css"/><link rel="stylesheet" href="extensions/TreeAndMenu/suckerfish/suckerfish.css"/>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=erudite.css"/>
<meta name="generator" content="MediaWiki 1.28.0"/>
<meta name="description" content="JavaScript is a high-level, dynamic, untyped programming language, supporting multiple paradigms including object-oriented, imperative and functional programming styles. Although there are similarities between JavaScript and Java, including language name and syntax, the two are distinct languages and differ greatly in their design."/>
<link rel="shortcut icon" href="skins/ij2.ico"/>

<script type="text/javascript" src="extensions/SyntaxHighlighter/syntaxhighlighter/scripts/shCore.js"></script>
<script type="text/javascript" src="extensions/SyntaxHighlighter/syntaxhighlighter/scripts/shBrushJScript.js"></script>
<script type="text/javascript">
SyntaxHighlighter.all();
</script>
<link rel="stylesheet" type="text/css" media="screen" href="extensions/SyntaxHighlighter/syntaxhighlighter/styles/shCoreMinit.css" />

	<meta property="og:type" content="article"/>

	<meta property="og:site_name" content="ImageJ"/>

	<meta property="og:title" content="JavaScript Scripting"/>

	<meta property="og:description" content="JavaScript is a high-level, dynamic, untyped programming language, supporting multiple paradigms including object-oriented, imperative and functional programming styles. Although there are similarities between JavaScript and Java, including language name and syntax, the two are distinct languages and differ greatly in their design."/>


<meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-JavaScript_Scripting rootpage-JavaScript_Scripting skin-erudite action-view">
		<div class="mw-jump">
			<a href="JavaScript.html#bodyContent">Skip to content</a>, 			<a href="JavaScript.html#search">Skip to search</a>
		</div>

		<div id="top-wrap" role="banner">
			<h1><a href="Welcome" title="ImageJ" rel="home">ImageJ</a></h1>
			<div id="tagline">From ImageJ</div>

			<a id="menubutton" href="JavaScript.html#menu">Menu</a>
			<div id="nav" role="navigation">
			<ul id='menu'>
<li id="menu-item-n-About"><a href="ImageJ">About</a></li>
<li id="menu-item-n-Downloads"><a href="Downloads">Downloads</a></li>
<li id="menu-item-n-Learn"><a href="Learn">Learn</a></li>
<li id="menu-item-n-Develop"><a href="Development">Develop</a></li>
<li id="menu-item-n-News"><a href="News">News</a></li>
<li id="menu-item-n-Events"><a href="Events">Events</a></li>
<li id="menu-item-n-Help"><a href="Help">Help</a></li>
</ul>
			</div>
		</div>

		<div id="mw-js-message"></div>
		
		<div id="main" role="main">
			<div id="nav-meta">
			<span id="ca-nstab-main" class="selected"><a href="JavaScript.html" title="View the content page [c]" accesskey="c">Page</a></span><span class="meta-sep">|</span><span id="ca-talk" class="new"><a href="index.php?title=Talk:JavaScript_Scripting&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page [t]" accesskey="t">Discussion</a></span><span class="meta-sep">|</span><span id="ca-viewsource"><a href="index.php?title=JavaScript_Scripting&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span><span class="meta-sep">|</span><span id="ca-history"><a href="index.php?title=JavaScript_Scripting&amp;action=history" title="Past revisions of this page [h]" accesskey="h">History</a></span><span class="meta-sep">|</span>			</div>

			<div id="bodyContent">
				<h1>JavaScript Scripting</h1>
				
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><table class="infobox" cellspacing="5" style="text-align: left; float: right; border: 1px solid #a0a0a0; font-size: 80%;">
<tr>
<th colspan="2" style="font-size: 130%;">  Learn
</th></tr>
<tr>
<td>
</td></tr>
<tr>
<td>
<table class="infobox mw-collapsible mw-collapsed" cellspacing="5" data-collapsetext="-" data-expandtext="+" style="width: 100%; text-align: left; border-top: 1px solid #336699; border-right: none; border-left: none; border-bottom: none;">
<tr>
<th>  Topics
</th></tr>


<tr>
<td>  <a href="Introduction" title="Introduction">Introduction</a>
</td></tr>
<tr>
<td>  <a href="Getting_Started" title="Getting Started">Getting Started</a>
</td></tr>
<tr>
<td>  <a href="User_Guides" title="User Guides">User Guides</a>
</td></tr>
<tr>
<td>  <a href="Category:Tutorials" title="Category:Tutorials">Tutorials</a>
</td></tr>
<tr>
<td>  <a href="Tips_and_Tricks" title="Tips and Tricks">Tips and Tricks</a>
</td></tr>
<tr>
<td>  <a href="Presentations" title="Presentations">Presentations</a>
</td></tr>
<tr>
<td>  <a href="Plugins" title="Plugins">Plugins</a>
</td></tr></table>
</td></tr>
<tr>
<td>
<table class="infobox mw-collapsible mw-collapsed" cellspacing="5" data-collapsetext="-" data-expandtext="+" style="width: 100%; text-align: left; border-top: 1px solid #336699; border-right: none; border-left: none; border-bottom: none;">
<tr>
<th>  Techniques
</th></tr>


<tr>
<td>  <a href="Category:Techniques" title="Category:Techniques">All Techniques</a>
</td></tr>
<tr>
<td>  <a href="Colocalization_Analysis" title="Colocalization Analysis"> Colocalization</a>
</td></tr>
<tr>
<td>  <a href="Deconvolution" title="Deconvolution">Deconvolution</a>
</td></tr>
<tr>
<td>  <a href="Registration" title="Registration">Registration</a>
</td></tr>
<tr>
<td>  <a href="Segmentation" title="Segmentation">Segmentation</a>
</td></tr>
<tr>
<td>  <a href="Image_Stitching" title="Image Stitching"> Stitching</a>
</td></tr>
<tr>
<td>  <a href="Tracking" title="Tracking">Tracking</a>
</td></tr>
<tr>
<td>  <a href="Visualization" title="Visualization">Visualization</a>
</td></tr></table>
</td></tr>
<tr>
<td>
<table class="infobox mw-collapsible mw-collapsed" cellspacing="5" data-collapsetext="-" data-expandtext="+" style="width: 100%; text-align: left; border-top: 1px solid #336699; border-right: none; border-left: none; border-bottom: none;">
<tr>
<th>  Scripting
</th></tr>


<tr>
<td>  <a href="Scripting" title="Scripting">Overview</a>
</td></tr>
<tr>
<td>  <a href="User_input" title="User input">User input</a>
</td></tr>
<tr>
<td>  <a href="Scripting_basics" title="Scripting basics">Basics of script writing</a>
</td></tr>
<tr>
<td>  <a href="How_to_use_the_Javadoc" title="How to use the Javadoc">How to use the Javadoc</a>
</td></tr>
<tr>
<td>  <a href="Batch_Processing" title="Batch Processing">Batch processing</a>
</td></tr>
<tr>
<td>  <a href="Using_the_Script_Editor" title="Using the Script Editor">Script Editor</a>
</td></tr>
<tr>
<td>  <a href="Script_Editor_Auto_Import" title="Script Editor Auto Import">Auto Imports</a>
</td></tr>
<tr>
<td>  <a href="Script_Templates" title="Script Templates">Templates</a>
</td></tr>
<tr>
<td>  <a href="Scripting_Headless" title="Scripting Headless">Running headlessly</a>
</td></tr>
<tr>
<td>  <a href="Scripting_comparisons" title="Scripting comparisons">Comparisons</a>
</td></tr>
<tr>
<td>  <a href="Scripting_toolbox" title="Scripting toolbox">Toolbox</a>
</td></tr>
<tr>
<td>  <a href="Multithreaded_Image_Processing_in_Clojure" title="Multithreaded Image Processing in Clojure">Multithreading in Clojure</a>
</td></tr>
<tr>
<td>  <a href="Multithreaded_Image_Processing_in_JavaScript" title="Multithreaded Image Processing in JavaScript">Multithreading in JavaScript</a>
</td></tr>
<tr>
<td>  <a href="Chess" title="Chess">Chess</a> in Jython
</td></tr></table>
</td></tr>
<tr>
<td>
<table class="infobox mw-collapsible" cellspacing="5" data-collapsetext="-" data-expandtext="+" style="width: 100%; text-align: left; border-top: 1px solid #336699; border-right: none; border-left: none; border-bottom: none;">
<tr>
<th>  Languages
</th></tr>


<tr>
<td>  <a href="BeanShell_Scripting" title="BeanShell Scripting">BeanShell</a>
</td></tr>
<tr>
<td>  <a href="Groovy_Scripting" title="Groovy Scripting">Groovy</a>
</td></tr>
<tr>
<td>  <a href="Introduction_into_Macro_Programming" title="Introduction into Macro Programming">ImageJ Macro</a>
</td></tr>
<tr>
<td>  <strong class="selflink">JavaScript</strong>
</td></tr>
<tr>
<td>  <a href="Clojure_Scripting" title="Clojure Scripting">Lisp (Clojure)</a>
</td></tr>
<tr>
<td>  <a href="MATLAB_Scripting" title="MATLAB Scripting">MATLAB</a>
</td></tr>
<tr>
<td>  <a href="Jython_Scripting" title="Jython Scripting">Python (Jython)</a>
</td></tr>
<tr>
<td>  <a href="Renjin_Scripting" title="Renjin Scripting">R (Renjin)</a>
</td></tr>
<tr>
<td>  <a href="JRuby_Scripting" title="JRuby Scripting">Ruby (JRuby)</a>
</td></tr>
<tr>
<td>  <a href="Scala_Scripting" title="Scala Scripting">Scala</a>
</td></tr></table>
</td></tr></table>
<p><a href="http://en.wikipedia.org/wiki/JavaScript" class="extiw" title="wikipedia:JavaScript">JavaScript</a> is a high-level, dynamic, untyped programming language, supporting multiple paradigms including object-oriented, imperative and functional programming styles. Although there are similarities between JavaScript and <a href="Java" class="mw-redirect" title="Java">Java</a>, including language name and syntax, the two are distinct languages and differ greatly in their design.
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="JavaScript.html#A_note_about_JavaScript_engines"><span class="tocnumber">1</span> <span class="toctext">A note about JavaScript engines</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="JavaScript.html#JavaScript_tutorial_for_ImageJ"><span class="tocnumber">2</span> <span class="toctext">JavaScript tutorial for ImageJ</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="JavaScript.html#Language_basics"><span class="tocnumber">2.1</span> <span class="toctext">Language basics</span></a>
<ul>
<li class="toclevel-3 tocsection-4"><a href="JavaScript.html#Importing_classes"><span class="tocnumber">2.1.1</span> <span class="toctext">Importing classes</span></a>
<ul>
<li class="toclevel-4 tocsection-5"><a href="JavaScript.html#Using_the_full_name_of_a_class"><span class="tocnumber">2.1.1.1</span> <span class="toctext">Using the full name of a class</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-6"><a href="JavaScript.html#Variables"><span class="tocnumber">2.1.2</span> <span class="toctext">Variables</span></a></li>
<li class="toclevel-3 tocsection-7"><a href="JavaScript.html#Arrays"><span class="tocnumber">2.1.3</span> <span class="toctext">Arrays</span></a>
<ul>
<li class="toclevel-4 tocsection-8"><a href="JavaScript.html#Javascript_arrays"><span class="tocnumber">2.1.3.1</span> <span class="toctext">Javascript arrays</span></a></li>
<li class="toclevel-4 tocsection-9"><a href="JavaScript.html#Native_Java_arrays"><span class="tocnumber">2.1.3.2</span> <span class="toctext">Native Java arrays</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-10"><a href="JavaScript.html#Functions"><span class="tocnumber">2.1.4</span> <span class="toctext">Functions</span></a>
<ul>
<li class="toclevel-4 tocsection-11"><a href="JavaScript.html#Functions_as_Objects"><span class="tocnumber">2.1.4.1</span> <span class="toctext">Functions as Objects</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-12"><a href="JavaScript.html#Creating_import_namespaces"><span class="tocnumber">2.1.5</span> <span class="toctext">Creating import namespaces</span></a></li>
<li class="toclevel-3 tocsection-13"><a href="JavaScript.html#Inspecting_fields_and_methods_of_an_object"><span class="tocnumber">2.1.6</span> <span class="toctext">Inspecting fields and methods of an object</span></a></li>
<li class="toclevel-3 tocsection-14"><a href="JavaScript.html#Math"><span class="tocnumber">2.1.7</span> <span class="toctext">Math</span></a></li>
<li class="toclevel-3 tocsection-15"><a href="JavaScript.html#Functional_programming"><span class="tocnumber">2.1.8</span> <span class="toctext">Functional programming</span></a></li>
<li class="toclevel-3 tocsection-16"><a href="JavaScript.html#Using_other_.js_files_as_libraries"><span class="tocnumber">2.1.9</span> <span class="toctext">Using other <i>.js</i> files as libraries</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-17"><a href="JavaScript.html#ImageJ_interaction"><span class="tocnumber">2.2</span> <span class="toctext">ImageJ interaction</span></a>
<ul>
<li class="toclevel-3 tocsection-18"><a href="JavaScript.html#Opening_and_creating_ImageJ_images"><span class="tocnumber">2.2.1</span> <span class="toctext">Opening and creating ImageJ images</span></a></li>
<li class="toclevel-3 tocsection-19"><a href="JavaScript.html#Using_GenericDialog"><span class="tocnumber">2.2.2</span> <span class="toctext">Using GenericDialog</span></a></li>
<li class="toclevel-3 tocsection-20"><a href="JavaScript.html#Running_ImageJ_commands"><span class="tocnumber">2.2.3</span> <span class="toctext">Running ImageJ commands</span></a></li>
<li class="toclevel-3 tocsection-21"><a href="JavaScript.html#Inspect_java_methods_and_fields_in_an_object"><span class="tocnumber">2.2.4</span> <span class="toctext">Inspect java methods and fields in an object</span></a></li>
<li class="toclevel-3 tocsection-22"><a href="JavaScript.html#Creating_a_script_for_ImageJ"><span class="tocnumber">2.2.5</span> <span class="toctext">Creating a script for ImageJ</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-23"><a href="JavaScript.html#Interfaces_and_anonymous_classes"><span class="tocnumber">2.3</span> <span class="toctext">Interfaces and anonymous classes</span></a></li>
<li class="toclevel-2 tocsection-24"><a href="JavaScript.html#Multithreaded_Image_Processing_in_Javascript"><span class="tocnumber">2.4</span> <span class="toctext">Multithreaded Image Processing in Javascript</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-25"><a href="JavaScript.html#Links"><span class="tocnumber">3</span> <span class="toctext">Links</span></a></li>
</ul>
</div>

<h1><span class="mw-headline" id="A_note_about_JavaScript_engines">A note about JavaScript engines</span></h1>
<p>ImageJ supports JavaScript via Java's built-in <a href="http://en.wikipedia.org/wiki/Nashorn_(JavaScript_engine)" class="extiw" title="wikipedia:Nashorn (JavaScript engine)">Nashorn JavaScript engine</a>. Versions of Java before Java 8 instead included Mozilla's <a href="http://en.wikipedia.org/wiki/Rhino_(JavaScript_engine)" class="extiw" title="wikipedia:Rhino (JavaScript engine)">Rhino JavaScript engine</a>. The two engines are largely, but not completely, compatible—meaning that some older scripts written for older versions of ImageJ (which used Rhino) may no longer function correctly when run with current ImageJ versions (which use Nashorn).
</p>
<h1><span class="mw-headline" id="JavaScript_tutorial_for_ImageJ">JavaScript tutorial for ImageJ</span></h1>
<h2><span class="mw-headline" id="Language_basics">Language basics</span></h2>
<h3><span class="mw-headline" id="Importing_classes">Importing classes</span></h3>
<p>To reference Java classes from JavaScript you will need to import them.
</p>
<div style="overflow:hidden"><table class="metadata plainlinks ambox ambox-content">
<tr>
<td class="ambox-image">
<p><a href="File:Important-sign.png" class="image"><img alt="Important-sign.png" src="_images/f/f0/Important-sign.png" width="40" height="40" /></a>
</p>
</td>
<td> Unlike <a href="ImageJ_1.x" class="mw-redirect" title="ImageJ 1.x">ImageJ 1.x</a>, <a href="ImageJ2" title="ImageJ2">ImageJ2</a> (and therefore <a href="Fiji" title="Fiji">Fiji</a>) does not automatically import any classes. Consequently, scripts written for <a href="ImageJ_1.x" class="mw-redirect" title="ImageJ 1.x">ImageJ 1.x</a> will not run in <a href="ImageJ2" title="ImageJ2">ImageJ2</a> without adding the proper imports.
The rationale is that the auto-import feature is not safe. What if two classes of the same name live in two different packages? Or if a new class is introduced that makes formerly unique names ambiguous? All of a sudden, all of the scripts that reference the original class no longer work. In short: auto-imports are dangerously imprecise. </td>


</tr>
</table></div>
<p><br />
You can specify imports in JavaScript as follows:
</p>
<pre class="brush:javascript">
importClass(Packages.java.io.File)
</pre>
<p>Where <code>java.io.File</code> is the class to be imported.
</p><p>For the most common stuff like e.g. <i>IJ</i>, the <i>RoiManager</i> or <i>GenericDialog</i> the following lines would be required:
</p>
<pre class="brush:javascript">
importClass(Packages.ij.IJ);
importClass(Packages.ij.plugin.frame.RoiManager);
importClass(Packages.ij.gui.GenericDialog);
</pre>
<h4><span class="mw-headline" id="Using_the_full_name_of_a_class">Using the full name of a class</span></h4>
<p>Sometimes it is easier to use the full name of a class than of using an import. E.g. you can use <code>Packages.ij.gui.GenericDialog</code> to access the class GenericDialog once.
</p><p>For some packages there are build in shortcuts. You can use <code>java.io.File</code> instead of <code>Packages.java.io.File</code> as <i>java</i> is a shortcut for <i>Packages.java</i> (there are shortcuts for <i>Packages.java</i>, <i>Packages.javax</i>, <i>Packages.com</i>, <i>Packages.edu</i>, <i>Packages.javafx</i> and <i>Packages.org</i>).
</p>
<h3><span class="mw-headline" id="Variables">Variables</span></h3>
<p>There are two ways:
</p>
<ul>
<li>Direct: the variable is globally visible (dangerous! Leads to nasty bugs.)</li>
<li>With a <i>var</i> declaration: the variable is local, visible only within the innermost code block.</li>
</ul>
<p><b>Local</b> variables are also <b>faster</b>, because they can be <a rel="nofollow" class="external text" href="http://www.mozilla.org/rhino/perf.html">efficiently optimized for access</a>.
Examples:
</p>
<pre class="brush:javascript">
importClass(Packages.ij.IJ);
// global variable 'imp'
imp = IJ.getImage();

// local variable 'i', visible within the loop only:
for (var i = 0; i &lt; 10; i++ ) {
  IJ.log("i is " + i);
}
</pre>
<p>Mixing global and local variables in a sensible way:
</p>
<pre class="brush:javascript">
importClass(Packages.ij.IJ);
// global variables 'base_url' and 'names'
// and local variable 'imp', the latter visible within the loop only:

base_url = "https://imagej.net/images/";

names = ["blobs.gif", "boats.gif", "bridge.gif"];

for (var i = 0; i&lt; names.length; i++) {
  var imp = IJ.openImage( base_url + names[i] );
  // process image
  // ...
  imp.show();
}

// ERROR: variable 'imp' is not visible outside the loop
// IJ.log("The last image opened was: " + imp);
</pre>
<h3><span class="mw-headline" id="Arrays">Arrays</span></h3>
<p>There are both Javascript arrays and native java arrays.
</p>
<h4><span class="mw-headline" id="Javascript_arrays">Javascript arrays</span></h4>
<p>There are many ways to create a Javascript array. Here are a few:
</p>
<pre class="brush:javascript">
importClass(Packages.ij.IJ);
// One dimensional:
var names = ["blobs.gif", "boats.gif", "bridge.gif"];
IJ.log("We have " + names.length + " names.");

// Two dimensional:
var coords = [[10, 20, 30],   // X coords
              [15, 25, 35]];  // Y coords

IJ.log( "x0, y0 = " + coords[0][0] + ", " + coords[1][0] );
IJ.log( "All X coords: " + coords[0] );

// Uneven dimensions:
var coords = [[10, 20, 30],               // X coords
              [15, 25, 35, 45, 55, 75]];  // Y coords
IJ.log( "Number of X coords: " + coords[0].length );
IJ.log( "Number of Y coords: " + coords[1].length );
</pre>
<p>Arrays in Javascript are extremely flexible:
</p>
<pre class="brush:javascript">
importClass(Packages.ij.IJ);
// Empty arrays:
var names = new Array();
IJ.log("First name is: " + names[0]); // --&gt; prints "undefined", i.e. null.

// Creating array entries at arbitrary index positions:
names[0] = "Table";
names[5] = "Window";
IJ.log("Number of names: " + names.length); // --&gt; prints 6&#160;! All other entries are "undefined", null.

// Using the array as a dictionary:
names["one"] = 1;
IJ.log("Number of names: " + names.length); // --&gt; still prints 6! But now the array has a map in it as well.
IJ.log("The 'one' is " + names["one"]);     // --&gt; prints 1

// Array entries can contain anything, including other arrays!
names[3] = new Array();
names[3][0] = "Ok";
names[3][1] = "Good";
names[3][2] = ["Arrays", "are", "very", "flexible"]; // another array!
IJ.log(names);
</pre>
<h4><span class="mw-headline" id="Native_Java_arrays">Native Java arrays</span></h4>
<p>Native java arrays can be passed to java functions and methods directly.
For example, to create an array of pixels:
</p>
<pre class="brush:javascript">
width = 512
height = 512
pixels = java.lang.reflect.Array.newInstance(java.lang.Byte.class, width * height);
print(pixels);
print(pixels.length);
</pre>
<p>To manipulate such arrays, just do so as if they were Javascript arrays. Beware, though, that now you are limited to numerical indices only, and within the array size only!
</p>
<pre class="brush:javascript">
width = 512
height = 512
pixels = java.lang.reflect.Array.newInstance(java.lang.Byte.class, width * height);
print(pixels[10]);
java.util.Arrays.fill(pixels, new java.lang.Byte(0));
print(pixels[10]);
// Subtract 25 to each pixel:
for (var i = 0; i &lt; pixels.length; i++) {
  pixels[i] -= 25;
}
print(pixels[10]);
</pre>
<p>With the nashorn JavaScript engine of Java 8, there is an easier way to create native Java arrays. You can create a constructor function that can be reused:
</p>
<pre class="brush:javascript">
var ByteArray = Java.type("byte[]");
width = 512
height = 512
var pixels = new ByteArray(width*height);
print(pixels.length);
print(pixels[10]);
// Subtract 25 to each pixel:
for (var i = 0; i &lt; pixels.length; i++) {
  pixels[i] -= 25;
}
print(pixels[10]);
var pixels2 = new ByteArray(10);
print(pixels2.length);
</pre>
<p>Above, beware of all problems derived from manipulating signed byte[] arrays, whose values should be made unsigned first, modified, then signed back into the array.
</p>
<h3><span class="mw-headline" id="Functions">Functions</span></h3>
<p>Simple example:
</p>
<pre class="brush:javascript">
importClass(Packages.ij.IJ);

function invertImage(imp) {
  var ip = imp.getProcessor();
  ip.invert();
}

// Obtain the current image:
var imp = IJ.getImage();

// Invoke our function
invertImage(imp);

// Update screen:
imp.updateAndDraw();
</pre>
<p>The number of arguments you invoke a function with is flexible. All arguments with which a function is invoked are collected in a variable named <i>arguments</i>.
</p><p>For example:
</p>
<pre class="brush:javascript">
importClass(Packages.ij.IJ);

function createImage(width, height) {
  IJ.log( "Number of arguments: " + arguments.length);
  
  // Default image type:
  var type = "8-bit";
  
  // Check if an extra argument for the image type was provided:
  if (arguments.length &gt; 2) {
    // Check that the extra arg makes any sense:
    if ("RGB" == arguments[2]) {
      type = "RGB";
    } else {
      IJ.log("Don't know how to use " + arguments[2]);
      return null;
    }
  } 

  var imp = IJ.createImage("New image", type, width, height, 1);
  return imp; 
}

var imp = createImage(400, 400, "RGB");
imp.show();
</pre>
<p>For a complex example see the example script <a rel="nofollow" class="external text" href="https://github.com/fiji/fiji/blob/master/plugins/Examples/Multithreaded_Image_Processing_in_Javascript.js">Multithreaded Image Processing in Javascript</a>, which, beyond parallelization, illustrates how to pass functions as arguments to other functions, and how to invoke them with variable number of arguments.
</p>
<h4><span class="mw-headline" id="Functions_as_Objects">Functions as Objects</span></h4>
<p>Any number of variables may be created on the fly on the body of a function, on its own <i>this</i> self reference pointer.
</p><p>To create an object in Javascript, just declare a function first that stores the object's data:
</p>
<pre class="brush:javascript">
// Use uppercase, by convention

function Data(image, annotation) {
    this.image = image;
    this.annotation = annotation;
}
</pre>
<p>Then just create it:
</p>
<pre class="brush:javascript">
importClass(Packages.ij.IJ);

function Data(image, annotation) {
    this.image = image;
    this.annotation = annotation;
}

var data = new Data(IJ.getImage(), "The current image");

IJ.log("data contains: " + data.image + "\n" + "with annotation: " + data.annotation);
</pre>
<p>To add methods to manipulate the new Data object, create a function that takes the object as an argument:
</p>
<pre class="brush:javascript">
importClass(Packages.ij.IJ);
importClass(Packages.ij.gui.GenericDialog);

function Data(image, annotation) {
    this.image = image;
    this.annotation = annotation;
}

var data = new Data(IJ.getImage(), "The current image");

IJ.log("data contains: " + data.image + "\n" + "with annotation: " + data.annotation);

function annotate(data) {
    var gd = new GenericDialog("Annotate");
    gd.addStringField("New annotation:", data.annotation, data.annotation.length);
    gd.showDialog();
    if (gd.wasCanceled()) return;
    // assign new annotation:
    var newAnnotation = gd.getNextString();
    IJ.log("Changing the annotation from \"" + data.annotation + "\" to \"" + newAnnotation + "\"");
    data.annotation = newAnnotation;
}

// Invoke on the existing Data object:
annotate(data);
</pre>
<p>As JavaScript uses prototype based object orientation, we can transform <code>annotate</code> to a object method. By adding a function to the prototype of an object, each instance of the object will own this method.
</p>
<pre class="brush:javascript">
importClass(Packages.ij.IJ);
importClass(Packages.ij.gui.GenericDialog);
 
function Data(image, annotation) {
    this.image = image;
    this.annotation = annotation;
}
 
var data = new Data(IJ.getImage(), "The current image");
 
IJ.log("data contains: " + data.image + "\n" + "with annotation: " + data.annotation);
 
Data.prototype.annotate = function () {
    var gd = new GenericDialog("Annotate");
    gd.addStringField("New annotation:", this.annotation, this.annotation.length);
    gd.showDialog();
    if (gd.wasCanceled()) return;
    // assign new annotation:
    this.annotation = gd.getNextString();
}
 
// Invoke on the existing Data object:
data.annotate();
</pre>
<h3><span class="mw-headline" id="Creating_import_namespaces">Creating import namespaces</span></h3>
<p>With Java 8 the new JavaScript engine nashorn introduces the new <code>JavaImporter</code>. Instances of <code>JavaImporter</code> can be used by JavaScripts <code>with</code> statement. This will limit the scope of the imports to the code enclosed by the curly braces of the <code>with</code> statement.
</p><p>The next code snippet shows how to write the annotation example with using the <code>JavaImporter</code>:
</p>
<pre class="brush:javascript">
function Data(image, annotation) {
    this.image = image;
    this.annotation = annotation;
}

function annotate(data) {
	var importer = new JavaImporter(Packages.ij.gui.GenericDialog, Packages.ij.IJ);
	with (importer) {
	    var gd = new GenericDialog("Annotate");
	    gd.addStringField("New annotation:", data.annotation, data.annotation.length);
	    gd.showDialog();
	    if (gd.wasCanceled()) return;
	    // assign new annotation:
	    var newAnnotation = gd.getNextString();
	    IJ.log("Changing the annotation from \"" + data.annotation + "\" to \"" + newAnnotation + "\"");
	    data.annotation = newAnnotation;
	}
}

var importerIJ = new JavaImporter(Packages.ij.IJ);
with (importerIJ) {
	var data = new Data(IJ.getImage(), "The current image");
	IJ.log("data contains: " + data.image + "\n" + "with annotation: " + data.annotation);
	// Invoke on the existing Data object:
	annotate(data);
}
</pre>
<h3><span class="mw-headline" id="Inspecting_fields_and_methods_of_an_object">Inspecting fields and methods of an object</span></h3>
<p>So you are returned an object for a function and you don't know what is it.
</p><p>To print its class within the interpreter:
</p>
<pre class="brush:javascript">
ob = ...
ob.getClass();
</pre>
<p>or to the log window:
</p>
<pre class="brush:javascript">
ob = ...
IJ.log(ob.getClass());
</pre>
<p>To print the list of methods it has, with their return types and argument types:
</p>
<pre class="brush:javascript">
ob = ...
m = ob.getClass().getMethods();
for (var i=0; i&lt;m.length; i++) IJ.log(m[i]);
</pre>
<h3><span class="mw-headline" id="Math">Math</span></h3>
<p>All math functions available:
</p>
<pre class="brush:javascript">
Math.abs(a)     // the absolute value of a
Math.acos(a)    // arc cosine of a
Math.asin(a)    // arc sine of a
Math.atan(a)    // arc tangent of a
Math.atan2(a,b) // arc tangent of a/b
Math.ceil(a)    // integer closest to a and not less than a
Math.cos(a)     // cosine of a
Math.exp(a)     // exponent of a
Math.floor(a)   // integer closest to and not greater than a
Math.log(a)     // log of a base e
Math.max(a,b)   // the maximum of a and b
Math.min(a,b)   // the minimum of a and b
Math.pow(a,b)   // a to the power b
Math.random()   // pseudorandom number in the range 0 to 1
Math.round(a)   // integer closest to a 
Math.sin(a)     // sine of a
Math.sqrt(a)    // square root of a
Math.tan(a)     // tangent of a
</pre>
<p>Built-in constants:
</p>
<pre class="brush:javascript">
Math.E
Math.PI
</pre>
<p>Trivial example:
</p>
<pre class="brush:javascript">
var root = Math.sqrt(12);
IJ.log("The root of 12 is " + root);
</pre>
<h3><span class="mw-headline" id="Functional_programming">Functional programming</span></h3>
<p>Suppose you want to create a new image with the square values of the pixels in another image.
</p><p>First, we get a <i>source</i> image (such as the currently active image):
</p>
<pre class="brush:javascript">

var source = Packages.ij.IJ.getImage(); // the current image (an ImagePlus)
</pre>
<p>Typically, you would then loop through all pixels and apply the result of their square to the other image:
</p>
<pre class="brush:javascript">
// Return a new ImageProcessor containing the square of each pixel value in ImageProcessor ip
function square(ip) {
  var ip2 = ip.duplicate().convertToFloat();
  var pix = ip.getPixels();

  for (var i = 0; i &lt; pix.length; i++) {
    pix[i] = Math.pow(pix[i], 2);
  }

  return ip2;
}

var ip2 = square( source.getProcessor() );

// Show the result:
new Packages.ij.ImagePlus("square of " + source.title, ip2).show();
</pre>
<p>But imagine now you want to get an image with the square root instead of the square, or the logarithm. Isn't that the same?
</p><p>We would have to write similar functions named <i>sqrt</i> and <i>pow3</i>. And so on.
</p><p>Instead, we should stop and think: there is a common pattern. All we want to do is to apply a function to each pixel in one image, and set the result into the same pixel in another image. In functional programming this pattern is called a <i>map</i> operation. Since Javascript lets us pass functions as arguments, we can define our own <i>map</i> function:
</p>
<pre class="brush:javascript">
function map(fn, ip) {
  var ip2 = ip.duplicate().convertToFloat();
  var pix = ip2.getPixels();

  for (var i = 0; i &lt; pix.length; i++) {
    pix[i] = fn(pix[i]);
  }

  return ip2;
}
</pre>
<p>Now, equipped with our <i>map</i> function, we can apply any mathematical operation we want:
</p>
<pre class="brush:javascript">
var ip_sqrt = map( Math.sqrt, source.getProcessor() );
var ip_log  = map( Math.log,  source.getProcessor() );
...
</pre>
<p>But wait! We didn't pass any extra argument. How can we do a generic function for <i>pow</i> so we can apply a power of 2, or 3, etc?
</p><p>We can rewrite our <i>map</i> function like this:
</p>
<pre class="brush:javascript">
function map(fn, ip) {
  var ip2 = ip.duplicate().convertToFloat();
  var pix = ip2.getPixels();

  for (var i = 0; i &lt; pix.length; i++) {
    pix[i] = fn(pix[i], arguments[2]);
  }
  
  return ip2;
}
</pre>
<p>... where <i>arguments[2]</i> is the argument, if any, present beyond any declared arguments. This works because in javascript, functions can accept a variable number of arguments:
</p>
<pre class="brush:javascript">
var ip2 = map( Math.pow, source.getProcessor(), 2 );
var ip3 = map( Math.pow, source.getProcessor(), 3 );
</pre>
<p>Our second version of the <i>map</i> function, though, is a bit perverted: in standard functional programming techniques, the function given as arguments would be applied to each element at index <i>i</i> of every list; i.e. the function would receive as many arguments as lists we give to the <i>map</i>. But we don't need that.
</p><p>So what's the big deal? We have abstracted away a common pattern, looping, but furthermore, we have reduced the complexity of our program. So now, for example, applying an optimization to the <i>map</i> function will improve <i>all</i> the places in our code that use it!
</p><p>(The same would be true for adding a debugging message, and what not. Anything you want).
</p><p>For example, since the processing of each pixel is independent of the others, we could parallelize the processing!
</p>
<pre class="brush:javascript">
function map(fn, ip) {
  var ip2 = ip.duplicate().convertToFloat();
  var pix = ip2.getPixels();

  var n_threads = java.lang.Runtime.getRuntime().availableProcessors();
  var threads = new Array();

  var ai = new java.util.concurrent.atomic.AtomicInteger(0);
  var width = ip.getWidth();
  var height = ip.getHeight();

  var arg = arguments[2];

  for (var t = 0; t &lt; n_threads; t++) {
    threads[t] = new java.lang.Thread( function() {
        // Process one line at a time:
        for (var line = ai.getAndIncrement(); line &lt; height; line = ai.getAndIncrement()) {
           var offset = line * width;
           for (var i = 0; i &lt; width; i++) {
               // invoke function on each pixel, with the optional extra argument
               pix[offset + i] = fn(pix[offset + i], arg);
           }
        }
    });
    threads[t].start();
  }

  // Wait until all threads finish:
  for (var t = 0; t &lt; n_threads; t++) {
    threads[t].join();
  }
  
  return ip2;
}
</pre>
<p>We would call the now multithreaded <i>map</i> function just like before:
</p>
<pre class="brush:javascript">
var ip_sqrt = map( Math.sqrt, source.getProcessor() );
var ip_log  = map( Math.log, source.getProcessor() );
var ip2     = map( Math.pow, source.getProcessor(), 2 );
var ip3     = map( Math.pow, source.getProcessor(), 3 );
</pre>
<p>Above: <b>beware</b> that parallelizing a trivial function like Math.sqrt will likely result in a <b>slower</b> execution, because of multithreading overheads and the extreme contention in accessing the same pixel array from multiple threads. Perhaps you want to have <b>two versions</b> of map: the simple and the parallel one, and use the latter for complex, heavy functions.
</p><p>For further ease, we could create a <i>show</i> function that avoids further repetitions:
</p>
<pre class="brush:javascript">
function mapAndShow(imp, fn) {
  var ip1 = imp.getProcessor();
  // Map the function to each pixel, into a new ImageProcessor:
  var ip2 = map(fn, ip1, arguments[2]); // pass any extra argument as well
  // Fix LUT range for best visualization:
  ip2.findMinAndMax();
  // Open image in a new window:
  new Packages.ij.ImagePlus(fn.name + " of " + imp.title, ip2).show();
}

with (new JavaImporter(Packages.ij.IJ)) {

  mapAndShow( IJ.getImage(), Math.sqrt);

  mapAndShow( IJ.getImage(), Math.pow, 3);
}
</pre>
<p><b>Note</b>
</p><p>All the above are examples to give you an idea of what is possible with Javascript and ImageJ.
If you are interested on applying mathematical functions to images, you may be better off using internal ImageJ commands, as listed in the menu "Process - Math":
</p>
<pre class="brush:javascript">
with (new JavaImporter(Packages.ij.IJ, Packages.ij.ImagePlus)) {

  var imp = IJ.getImage();
  var imp2 = new ImagePlus("copy of " + imp.title, imp.getProcessor().duplicate().convertToFloat());

  // Set each pixel to the square of its value:
  IJ.run( imp2, "Square", "");

  imp2.show();
}
</pre>
<h3><span class="mw-headline" id="Using_other_.js_files_as_libraries">Using other <i>.js</i> files as libraries</span></h3>
<p>Programming becomes most useful when code is reused. To that end, many programmers will generalize their code into functions that can be called from other scripts as well.
</p><p>To avoid copy-pasting all the time (which invariably leads to stale and unmaintainable code), a good idea is to store such general functions in separate <i>.js</i> files and let the Javascript interpreter know about them. You can fetch the location of scripts in a system independent way using <code>IJ.getDirectory("plugins")</code>:
</p>
<pre class="brush:javascript">
load(Packages.ij.IJ.getDirectory("plugins") + "JavaScript" + java.io.File.separator + "my-library-of-useful-functions.js");
// now you can use the functions defined in above .js file
</pre>
<p>To keep your global scope clean, it is recommended to use only functions in your libraries. As JavaScript has a function scope, all variables declared inside a function are not visible in the global scope and can't overwrite variables in the script you are working with.
</p><p>Best practice is to create a single object in each library that uses the same name as the library.
</p>
<pre class="brush:javascript">
// This is the code of the library SimpleObject.js
var SimpleObject = function (x, y, val) {
  this.x = x;
  this.y = y;
  this.val = val;
}

// Each new object that is created from SimpleObject owns this function
SimpleObject.prototype.print = function () {
  with (new JavaImporter(Packages.ij.IJ)) {
    IJ.log("x: " + this.x);
    IJ.log("y: " + this.y);
    IJ.log("val: " + this.val);
  }
}
</pre>
<p>The following code demonstrates how to use the library, if it's saved as <i>SimpleObject.js</i> in <i>Plugins/JavaScript/</i>.
</p>
<pre class="brush:javascript">
load(Packages.ij.IJ.getDirectory("plugins") + "JavaScript" + java.io.File.separator + "SimpleObject.js");
var obj = new SimpleObject(10, 10, 100);
obj.print();
</pre>
<h2><span class="mw-headline" id="ImageJ_interaction">ImageJ interaction</span></h2>
<h3><span class="mw-headline" id="Opening_and_creating_ImageJ_images">Opening and creating ImageJ images</span></h3>
<pre class="brush:javascript">
imp = new Opener().openImage("/path/to/image.jpg");
// do some processing
// ...
imp.show();
</pre>
<p>Or easier:
</p>
<pre class="brush:javascript">
imp = IJ.openImage("/path/to/image.jpg");
imp.show();
</pre>
<p>Also URLs (in this case, we call directly <i>show()</i>, not keeping the returned image pointer into any variable):
</p>
<pre class="brush:javascript">
IJ.openImage("https://imagej.net/images/blobs.gif").show();
</pre>
<p>Create an image from scratch, including LUT:
</p>
<pre class="brush:javascript">
// From scratch:
width = 512
height = 512
pixels = new java.lang.reflect.Array.newInstance(java.lang.Byte.TYPE, width * height);
// process the pixels
// ...
// Create LUT:
channel = new java.lang.reflect.Array.newInstance(java.lang.Byte.TYPE, 256);
for (i=0; i&lt;channel.length; i++)
    channel[i] = Integer(i).byteValue();
cm = new LUT(channel, channel, channel);

// Create the image as 8-bit with the LUT we just created:
imp = new ImagePlus("the title", new ByteProcessor(width, height, pixels, cm));
imp.show();
</pre>
<p>A more convenient way to create images, with a default grayscale LUT:
</p>
<pre class="brush:javascript">
imp = ImagePlus("the title", new ByteProcessor(512, 512));
pixels = imp.getProcessor().getPixels();
// do some processing ...
// ...
imp.show();
</pre>
<p><br />
</p>
<h3><span class="mw-headline" id="Using_GenericDialog">Using GenericDialog</span></h3>
<p>This example shows how to get 2 of the open images and a checkbox using GenericDialog.
</p>
<pre class="brush:javascript">
// get 2 images and a checkbox
var createWindow = true;  //default checkbox value
var imp = null; // default chosen images

var data = getTwoImages( createWindow ); // call the function

if (data) {
  // there was data returned
  imp = [data[0], data[1]];
  createWindow = data[2];

  // show the choices in the log window
  IJ.log(imp[0]); // first image
  IJ.log(imp[1]); // second image
  IJ.log(createWindow); // the status of the checkbox
  // the rest of your code goes here
}



function getTwoImages( createWindow ) {
  var wList = WindowManager.getIDList();

  if (null == wList || wList.length&lt;2){ //there are less than 2 images or no images
    IJ.showMessage("Error", "There must be at least two windows open");
    return;
  }
 
  //get all the image titles so they can be shown in the dialog 
  var titles = new Array();

  for (var i=0, k=0; i&lt;wList.length; i++) {
    var limp = WindowManager.getImage(wList[i]);
    if (limp)
      titles[k++] = limp.getTitle();
  }

  //construct the dialog
  gd = new GenericDialog("Options");
  gd.addMessage("Binary Reconstruction v 2");
  gd.addChoice("mask i1:", titles, titles[0]);
  gd.addChoice("seed i2:", titles, titles[1]);
  gd.addCheckbox("Create New Window", createWindow);
  gd.showDialog(); //show it

  if (gd.wasCanceled())
    return;

  var i1Index = gd.getNextChoiceIndex();
  var i2Index = gd.getNextChoiceIndex();
  var create_window = gd.getNextBoolean();

  return [WindowManager.getImage(wList[i1Index]),
          WindowManager.getImage(wList[i2Index]),
          create_window];
}
</pre>
<p><br />
</p>
<h3><span class="mw-headline" id="Running_ImageJ_commands">Running ImageJ commands</span></h3>
<p>To launch a command:
</p>
<pre class="brush:javascript">
// in a separate thread:
IJ.doCommand("FFT");

// instead, waiting until it finishes:
IJ.run("FFT");
</pre>
<p>To run commands on a specific image:
</p>
<pre class="brush:javascript">
// Obtain an image to work on:
var imp = IJ.getImage();

// Call the command to add noise to the current image
// which is here the one provided as argument:
IJ.run(imp, "Add Noise", "");

// Subtract 25 to each pixel value:
IJ.run(imp, "Subtract...", "value=25");
</pre>
<p>Above, you can see what arguments to add to a command by opening the Plugins - Macro Recorder, and then running the command manually. The macro string will print on the recorder window.
</p>
<h3><span class="mw-headline" id="Inspect_java_methods_and_fields_in_an_object">Inspect java methods and fields in an object</span></h3>
<p>To print the static fields and methods of ImagePlus class:
</p>
<pre class="brush:javascript">
s = "";
for (a in ImagePlus) { s += " " + a; }
</pre>
<p>... which prints INTEGRATED_DENSITY AREA_FRACTION etc.
</p><p>To print the fields and methods of an instance of ImagePlus (i.e. an image that already exists):
</p>
<pre class="brush:javascript">
// get the current image
imp = IJ.getImage();
// print fields and methods
s = ""; for (a in imp) { s += " " + a; }
</pre>
<p>... which prints all method names such as getStatistics isHyperStack etc. and fields like width and height (because there are public 'get' methods for it such as getWidth() and getHeight() .)
</p><p><br />
</p>
<h3><span class="mw-headline" id="Creating_a_script_for_ImageJ">Creating a script for ImageJ</span></h3>
<p>Save your javascript script in a text file:
</p>
<ol>
<li> with extension .js</li>
<li> and with an underscore '_' in its name: my_first_script.js</li>
</ol>
<p>...and just drop it in ImageJ's plugins folder or a subfolder.
</p><p>On startup, the script will appear in the corresponding menu.
</p><p>If you add the script after ImageJ was started, just call "Help - Update menus" and it will be picked up.
</p><p>You can continue modifying and saving the script file. Every time you run it from the menu, it will be read from the file system.
</p>
<h2><span class="mw-headline" id="Interfaces_and_anonymous_classes">Interfaces and anonymous classes</span></h2>
<p>To create an ImageListener without declaring a new class that implements such java interface, simply use a function that will be mapped to all its methods (as long as they have the same signature, which they do in this case):
</p>
<pre class="brush:javascript">
ImagePlus.addImageListener( function (imp, name) {
       if (name == "imageOpened") {
              IJ.log("Opened image: " + imp);
      } else if (name == "imageClosed") {
              IJ.log("Closed image: " + imp);
      } else if (name == "imageUpdated") {
              IJ.log("Updated image: " + imp);
      }
});
</pre>
<p>Alternatively, one can create an object with declared functions inside to assign then to an anonymous class created on the fly from an interface:
</p>
<pre class="brush:javascript">
body = {
  run: function () {
    IJ.log("Running!");
  }
}
// Runnable is an interface
runnable = new Runnable(body);
new Thread(runnable).start();
</pre>
<p>Simplified:
</p>
<pre class="brush:javascript">
new Thread( function () { IJ.log("Running!"); } ).start();
</pre>
<p>What the code above did: to look for an interface that could take a method with no arguments, represented by the function, and instantiate an anonymous class that implements such interface with the function mapped to its method.
</p><p>See also an <a href="Scripting_comparisons#In_Javascript" title="Scripting comparisons">example plugin</a> for ImageJ written in javascript.
</p>
<h2><span class="mw-headline" id="Multithreaded_Image_Processing_in_Javascript">Multithreaded Image Processing in Javascript</span></h2>
<p>The following example shows how to create a generic function, named <i>multithreader</i>, that accepts another function as argument and executes it in parallel a number of times. As a very simple example, a <i>printer</i> function is passed to the <i>multithreader</i>, and a list of numbers is printed without repeating anyone, and not preserving the order of course.
</p><p>The <i>multithreader</i> scales up to as many CPU cores as the computer has to offer.
</p><p>Always remember: only <b>completely</b> independent tasks can be parallelized effectively!
</p><p>A good strategy for multithreading involves carefully considering the task to parallelize: how small can the chunks be? For an image, a chunk could be a pixel or a line, but often those are too small to overcome the overhead of parallelization.
</p><p>Despite the simple example below, the <i>multithreader</i> framework function allows variable amount of arguments to be passed, as illustrated in the complete plugin <a rel="nofollow" class="external text" href="https://github.com/fiji/fiji/blob/master/plugins/Examples/Multithreaded_Image_Processing_in_Javascript.js">Multithreaded_Image_Processing_in_Javascript.js</a>. The script shows how to generate an image with random pixel values in a multithreaded manner, and how the choice of chunks to process in parallel is made for reasonable effectiveness.
</p>
<pre class="brush:javascript">
// Import all classes that are used more than once:
importClass(Packages.ij.IJ);
importClass(Packages.java.lang.Thread);

function multithreader(fun, start, end) {
        var threads = java.lang.reflect.Array.newInstance(Thread.class, java.lang.Runtime.getRuntime().availableProcessors());
        var ai = new java.util.concurrent.atomic.AtomicInteger(start);
        // Prepare arguments: all other arguments passed to this function
        // beyond the mandatory arguments fun, start and end:
        var args = new Array();
        var b = 0;
        IJ.log("Multithreading function \"" + fun.name + "\" with arguments:\n  argument 0 is index from " + start + " to " + end);
        for (var a = 3; a &lt; arguments.length; a++) {
                args[b] = arguments[a];
                IJ.log("  argument " + (b+1) + " is " + args[b]);
                b++;
        }
        var body = {
                run: function() {
                        for (var i = ai.getAndIncrement(); i &lt;= end; i = ai.getAndIncrement()) {
                                // Execute the function given as argument,
                                // passing to it all optional arguments:
                                fun(i, args);
                                Thread.sleep(100); // NOT NEEDED, just to pretend we are doing something!
                        }
                }
        }
        // start all threads
        for (var i = 0; i &lt; threads.length; i++) {
                threads[i] = new Thread(new java.lang.Runnable(body)); // automatically as Runnable
                threads[i].start();
        }
        // wait until all threads finish
        for (var i = 0; i &lt; threads.length; i++) {
                threads[i].join();
        }
}

// The actual desired effect: the printer
function printer(i) {
        IJ.log("i is " + i);
}
 
 // Execute:
 multithreader(printer, 0, 10);
</pre>
<p><br />
See the complete file here: <a rel="nofollow" class="external text" href="https://github.com/fiji/fiji/blob/master/plugins/Examples/Multithreaded_Image_Processing_in_Javascript.js">Multithreaded_Image_Processing_in_Javascript.js</a>
</p>
<h1><span class="mw-headline" id="Links">Links</span></h1>
<ul><li> <a rel="nofollow" class="external text" href="http://www.mozilla.org/rhino/tutorial.html">Tutorial</a> at Mozilla Rhino webpages (Java 6).</li>
<li> <a rel="nofollow" class="external text" href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/Rhino/Scripting_Java">Scripting Java with JavaScript</a> (Java 6).</li>
<li> <a rel="nofollow" class="external text" href="http://www.mozilla.org/rhino/perf.html">Performance tips</a> (Java 6).</li>
<li> <a rel="nofollow" class="external text" href="http://winterbe.com/posts/2014/04/05/java8-nashorn-tutorial/">Tutorial</a> on Oracle Nashorn (Java 8).</li></ul>
<p>See also the <a href="Scripting_comparisons" title="Scripting comparisons">Scripting comparisons</a>.
</p>
<!-- 
NewPP limit report
Cached time: 20200713072753
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.068 seconds
Real time usage: 0.071 seconds
Preprocessor visited node count: 962/1000000
Preprocessor generated node count: 2416/1000000
Post‐expand include size: 13099/2097152 bytes
Template argument size: 7218/2097152 bytes
Highest expansion depth: 8/40
Expensive parser function count: 0/3
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%   23.519      1 - -total
 62.99%   14.814      1 - Template:Learn
 55.66%   13.092      1 - Template:Menu
 49.70%   11.688      4 - Template:Submenu
 25.66%    6.034     39 - Template:MenuItem
 15.12%    3.555      1 - Template:ImportingClasses
 10.65%    2.505      1 - Template:Warning
  9.82%    2.309      3 - Template:GitHub
  7.10%    1.670      1 - Template:Ambox
-->
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="index.php?title=JavaScript_Scripting&amp;oldid=41271">http://imagej.net/index.php?title=JavaScript_Scripting&amp;oldid=41271</a>"</div>
							</div>

			<div id="footer">
				<p> This page was last modified on 24 January 2020, at 11:54.</p><ul><li><a href="ImageJ:Privacy_policy" title="ImageJ:Privacy policy">Privacy policy</a></li><li><a href="ImageJ:About" class="mw-redirect" title="ImageJ:About">About ImageJ</a></li><li><a href="Imprint" title="Imprint">Imprint</a></li><li><a href="index.php?title=JavaScript_Scripting&amp;mobileaction=toggle_view_mobile" class="noprint stopMobileRedirectToggle">Mobile view</a></li></ul>			</div>

			<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="Special:Categories" title="Special:Categories">Category</a>: <ul><li><a href="Category:Scripting" title="Category:Scripting">Scripting</a></li></ul></div></div>		</div>

		<div id="bottom-wrap">
		</div>
		<script>(window.RLQ=window.RLQ||[]).push(function(){mw.loader.load(["ext.fancytree","ext.suckerfish","mediawiki.toc","mediawiki.action.view.postEdit","site","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest","ext.SimpleTooltip"]);});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":217});});</script>
		</body>
		</html>
		