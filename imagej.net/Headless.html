<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8"/>
<title>Headless - ImageJ</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Headless","wgTitle":"Headless","wgCurRevisionId":40213,"wgRevisionId":40213,"wgArticleId":1510,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Headless","wgRelevantArticleId":1510,"wgRequestId":"1451608932ecf48c3507902c","wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgPreferredVariant":"en","fancytree_path":"/extensions/TreeAndMenu/fancytree"});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user.cssprefs":"ready","user":"ready","user.options":"loading","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","skins.erudite":"ready"});mw.loader.implement("user.options@0j3lz3q",function($,jQuery,require,module){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens@1ku9xth",function ( $, jQuery, require, module ) {
mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});/*@nomin*/;

});mw.loader.load(["mediawiki.page.startup"]);});</script>
<link rel="stylesheet" href="erudite14.css"/>
<link rel="stylesheet" href="extensions/TreeAndMenu/fancytree/fancytree.css"/><link rel="stylesheet" href="extensions/TreeAndMenu/suckerfish/suckerfish.css"/>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="erudite15.css"/>
<meta name="generator" content="MediaWiki 1.28.0"/>
<meta name="description" content="ImageJ 1.x was never meant as anything else than a desktop application with one user in front of one screen attached to one computer."/>
<link rel="shortcut icon" href="skins/ij2.ico"/>

<script type="text/javascript" src="extensions/SyntaxHighlighter/syntaxhighlighter/scripts/shCore.js"></script>
<script type="text/javascript" src="extensions/SyntaxHighlighter/syntaxhighlighter/scripts/shBrushPlain.js"></script>
<script type="text/javascript" src="extensions/SyntaxHighlighter/syntaxhighlighter/scripts/shBrushBash.js"></script>
<script type="text/javascript">
SyntaxHighlighter.all();
</script>
<link rel="stylesheet" type="text/css" media="screen" href="extensions/SyntaxHighlighter/syntaxhighlighter/styles/shCoreMinit.css" />

	<meta property="og:type" content="article"/>

	<meta property="og:site_name" content="ImageJ"/>

	<meta property="og:title" content="Headless"/>

	<meta property="og:description" content="ImageJ 1.x was never meant as anything else than a desktop application with one user in front of one screen attached to one computer."/>


<meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Headless rootpage-Headless skin-erudite action-view">
		<div class="mw-jump">
			<a href="Headless.html#bodyContent">Skip to content</a>, 			<a href="Headless.html#search">Skip to search</a>
		</div>

		<div id="top-wrap" role="banner">
			<h1><a href="Welcome" title="ImageJ" rel="home">ImageJ</a></h1>
			<div id="tagline">From ImageJ</div>

			<a id="menubutton" href="Headless.html#menu">Menu</a>
			<div id="nav" role="navigation">
			<ul id='menu'>
<li id="menu-item-n-About"><a href="ImageJ">About</a></li>
<li id="menu-item-n-Downloads"><a href="Downloads">Downloads</a></li>
<li id="menu-item-n-Learn"><a href="Learn">Learn</a></li>
<li id="menu-item-n-Develop"><a href="Development">Develop</a></li>
<li id="menu-item-n-News"><a href="News">News</a></li>
<li id="menu-item-n-Events"><a href="Events">Events</a></li>
<li id="menu-item-n-Help"><a href="Help">Help</a></li>
</ul>
			</div>
		</div>

		<div id="mw-js-message"></div>
		
		<div id="main" role="main">

			<div id="bodyContent">
				<div style="font-size: large; border: 1px solid black; padding: 1em; margin-bottom: 1em; text-align: center; background-color: #fda;">
					This is a read-only version of imagej.net, available during the transition to a new site.
					<br>Please direct any questions or issues to <a href="https://forum.image.sc/t/imagej-wiki-is-down/39672">this Image.sc Forum thread</a>.
					<br>Thank you for your patience as we improve the website!
				</div>

				<h1>Headless</h1>
				
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><p><a href="ImageJ1" title="ImageJ1">ImageJ 1.x</a> was never meant as anything else than a desktop application with one user in front of one screen attached to one computer.
</p><p>However, it acquired <a href="Macro" class="mw-redirect" title="Macro">macro</a> capabilities, a <a href="Batch_mode" class="mw-redirect" title="Batch mode">batch mode</a> for such macros, and even <a href="Scripting" title="Scripting">scripting</a> support.
</p><p>Naturally, users want to execute such <a href="Macros" class="mw-redirect" title="Macros">macros</a> or <a href="Scripts" class="mw-redirect" title="Scripts">scripts</a> in environments such as clusters where there is no graphical user interface available.
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="Headless.html#The_problem"><span class="tocnumber">1</span> <span class="toctext">The problem</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="Headless.html#Possible_solutions"><span class="tocnumber">2</span> <span class="toctext">Possible solutions</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="Headless.html#The_--headless_mode"><span class="tocnumber">2.1</span> <span class="toctext">The --headless mode</span></a>
<ul>
<li class="toclevel-3 tocsection-4"><a href="Headless.html#Running_scripts_in_headless_mode"><span class="tocnumber">2.1.1</span> <span class="toctext">Running scripts in headless mode</span></a></li>
<li class="toclevel-3 tocsection-5"><a href="Headless.html#Running_macros_in_headless_mode"><span class="tocnumber">2.1.2</span> <span class="toctext">Running macros in headless mode</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-6"><a href="Headless.html#Xvfb"><span class="tocnumber">2.2</span> <span class="toctext">Xvfb</span></a>
<ul>
<li class="toclevel-3 tocsection-7"><a href="Headless.html#Examples"><span class="tocnumber">2.2.1</span> <span class="toctext">Examples</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-8"><a href="Headless.html#Rewriting_as_scripts_or_plugins"><span class="tocnumber">2.3</span> <span class="toctext">Rewriting as scripts or plugins</span></a></li>
</ul>
</li>
</ul>
</div>

<h1><span class="mw-headline" id="The_problem">The problem</span></h1>
<p>Java <i>does</i> support a headless mode via the <code>java.awt.headless</code> property; setting this property to <code>true</code> enables it.
</p><p>Unfortunately, with X11-based Java (such as on Linux, which is the most prevalent platform for running clusters), headless mode does not allow to instantiate any GUI components that would want to display text. The reason is that the font-metrics on X11 are provided by the X11 server (and are indeed different between servers) and therefore the dimensions of such elements simply cannot be calculated without a graphical desktop.
</p><p>Since ImageJ 1.x was devised as a desktop application, everything -- including macros -- works through the GUI. For example, a simple <code>run("Open...");</code> will look for the action in the menu.
</p><p>On MacOSX, there is no problem: Aqua provides GUI-independent text rendering (mapping to the actual display using anti-aliasing). There, running in headless mode allows instantiating GUI elements such as the menu bar.
</p>
<h1><span class="mw-headline" id="Possible_solutions">Possible solutions</span></h1>
<h2><span class="mw-headline" id="The_--headless_mode">The <code>--headless</code> mode</span></h2>
<div style="float:right; width: 300px; border: 1px solid #ccc; padding: 15px !important; margin-top: 1em; margin-bottom: 2em; background-color: #ffefbe; -moz-border-radius: .75em; -webkit-border-radius: .75em; border-radius: .75em;-moz-box-shadow: 4px 4px 4px #CCC; -webkit-box-shadow: 4px 4px 4px #CCC; box-shadow: 4px 4px 4px #CCC;">
<p style="font-size: large; font-weight: bold; margin-top: 0; padding-top: 0">Historical note</p> Headless support was originally a branch in <a href="ImageJA" title="ImageJA">ImageJA</a>; it worked by putting rewritten versions of three core ImageJ classes into a file called <i>headless.jar</i>, which was put into the class path <i>before</i> <code>ij.jar</code> so they would override ImageJ's versions.
Nowadays, we use <a href="Javassist" title="Javassist">Javassist</a> for run-time patching, through the <a rel="nofollow" class="external text" href="https://github.com/imagej/ij1-patcher/">ImageJ 1.x patcher</a> project. <span style="color: red">You do not need to do anything special to take advantage of this feature, except pass the <code>--headless</code> flag when launching ImageJ from the command line.</span></div>
<p><a href="ImageJ2" title="ImageJ2">ImageJ2</a> provides the capability to execute ImageJ plugins, macros and scripts in headless mode. This feature uses bytecode manipulation to patch ImageJ 1.x's behavior at runtime, making it possible to start ImageJ in batch mode without instantiating GUI components.
</p><p><b>Shortcoming:</b> There are plugins which are even more bound to a GUI than ImageJ 1.x is. Naturally, these plugins will still try to instantiate GUI elements when being called in headless mode, failing.
</p>
<h3><span class="mw-headline" id="Running_scripts_in_headless_mode">Running scripts in headless mode</span></h3>
<p>Please see the <a href="Scripting_Headless" title="Scripting Headless">headless scripting guide</a>.
</p>
<h3><span class="mw-headline" id="Running_macros_in_headless_mode">Running macros in headless mode</span></h3>
<p>To run a <i>macro</i> in headless mode, use the <code>-macro</code> command line argument along with the <code>--headless</code> option, as follows:
</p>
<pre> ImageJ --headless -macro path-to-Macro.ijm
</pre>
<p>If the macro resides in ImageJ's macro directory, it is possible to specify the macro name instead of the actual file path. The file extension is always very recommended but for backwards compatibility, it is not strictly required <i>only</i> when specifying the macro name instead of a path.
</p><p>You can even pass parameters to the macro; e.g.:
</p>
<pre> ./ImageJ-win64.exe --headless --console -macro ./RunBatch.ijm 'folder=../folder1 parameters=a.properties output=../samples/Output'
</pre>
<p>In that case, the RunBatch.ijm file should be something like:
</p>
<pre class="brush:plain">
arg = getArgument()
print("Running batch analysis with arguments:")
print(arg)
run("Batch process", arg )
print("Done.")
eval("script", "System.exit(0);");
</pre>
<p>the <code>getArgument()</code> is used to grab the parameter string itself, and it is then passed to an IJ command.
</p>
<div style="overflow:hidden"><table class="metadata plainlinks ambox ambox-content">
<tr>
<td class="ambox-image">
<p><a href="./File:Important-sign.png" class="image"><img alt="Important-sign.png" src="_images/f/f0/Important-sign.png" width="40" height="40" /></a>
</p>
</td>
<td> Please note that you will not be able to use <a href="Script_parameters" class="mw-redirect" title="Script parameters">script parameters</a> with <code>-macro</code>. Follow instructions in <a href="Scripting_Headless" title="Scripting Headless">Scripting Headless</a> instead. </td>
<p><br />
</p>
</tr>
</table></div>
<p><br />
</p>
<h2><span class="mw-headline" id="Xvfb">Xvfb</span></h2>
<p>Another method is to have a virtual desktop, e.g. <a href="http://en.wikipedia.org/wiki/Xvfb" class="extiw" title="wikipedia:Xvfb">Xvfb</a>. This will allow ImageJ to start with a virtualised graphical desktop.
</p><p><b>Advantage:</b> No run-time patching is required.
</p><p><b>Shortcomings:</b> It is slower than it needs to be because of the overhead of starting the GUI, it is harder to configure, and plugins might get stuck because they wait for user input which never comes.
</p>
<h3><span class="mw-headline" id="Examples">Examples</span></h3>
<p>Here are a couple of simple examples.
</p><p>Passing direct arguments:
</p>
<pre class="brush:bash">
$ cat hello.js
importClass(Packages.ij.IJ);
IJ.log("hello " + arguments[0]);
$ xvfb-run -a $IMAGEJ_DIR/ImageJ-linux64 hello.js Emerson
hello Emerson
</pre>
<p>With <a href="Script_Parameters" title="Script Parameters">SciJava script parameters</a>:
</p>
<pre class="brush:bash">
$ cat hello-with-params.js
// @String name
importClass(Packages.ij.IJ);
IJ.log("hello " + name);
$ xvfb-run -a $IMAGEJ_DIR/ImageJ-linux64 --ij2 --headless --run hello-with-params.js 'name="Emerson"'
hello Emerson
</pre>
<p>A more complex shell script that wraps a macro for use with Xvfb (thanks to Nestor Milyaev):
</p>
<pre class="brush:bash">
export DISPLAY=:1
Xvfb $DISPLAY -auth /dev/null &amp;
(
# the '(' starts a new sub shell. In this sub shell we start the worker processes:

script=$scriptDir"lsmrotate2nrrd.ijm \"dir="$1"&amp;angle-x=$2&amp;angle-y=
$3&amp;angle-z=$4&amp;reverse=$5\" -batch"
$imagejBin -macro $script # running the actual ijm script

wait # waits until all 'program' processes are finished
# this wait sees only the 'program' processes, not the Xvfb process
)

</pre>
<p>See also <a rel="nofollow" class="external text" href="https://list.nih.gov/cgi-bin/wa.exe?A2=IMAGEJ;5ace1ed0.1508">this post on the ImageJ mailing list</a>.
</p>
<h2><span class="mw-headline" id="Rewriting_as_scripts_or_plugins">Rewriting as scripts or plugins</span></h2>
<p>The most robust method is to rewrite macros as scripts that do not require interaction with the GUI to begin with. Unfortunately, this is the most involved solution, too, since it usually takes some time to convert macros.
</p>
<!-- 
NewPP limit report
Cached time: 20200713072433
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.036 seconds
Real time usage: 0.038 seconds
Preprocessor visited node count: 187/1000000
Preprocessor generated node count: 1057/1000000
Post‐expand include size: 2302/2097152 bytes
Template argument size: 1034/2097152 bytes
Highest expansion depth: 9/40
Expensive parser function count: 0/3
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%    9.979      1 - -total
 73.00%    7.285      1 - Template:Box
 25.34%    2.529      1 - Template:Warning
 16.93%    1.689      1 - Template:GitHub
 16.88%    1.685      1 - Template:Ambox
 12.11%    1.208      1 - Template:Box-shadow
  8.66%    0.864      1 - Template:Border-radius
-->
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="index.php?title=Headless&amp;oldid=40213">http://imagej.net/index.php?title=Headless&amp;oldid=40213</a>"</div>
							</div>

			<div id="footer">
				<p> This page was last modified on 5 July 2019, at 03:07.</p><ul><li><a href="./ImageJ:Privacy_policy" title="ImageJ:Privacy policy">Privacy policy</a></li><li><a href="./ImageJ:About" class="mw-redirect" title="ImageJ:About">About ImageJ</a></li><li><a href="Imprint" title="Imprint">Imprint</a></li></ul>			</div>

			<div id="catlinks" class="catlinks catlinks-allhidden" data-mw="interface"></div>		</div>

		<div id="bottom-wrap">
			<div id="footer-wrap-inner">
				<div id="ternary" class="footer">
					<ul>
						<li class="widget">
							<img id="logo" src="skins/imagej-128.png" alt="">
						</li>
					</ul>
				</div>
			</div>
		</div>
		<script>(window.RLQ=window.RLQ||[]).push(function(){mw.loader.load(["ext.fancytree","ext.suckerfish","mediawiki.toc","mediawiki.action.view.postEdit","site","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest","ext.SimpleTooltip"]);});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":246});});</script>
		</body>
		</html>
		