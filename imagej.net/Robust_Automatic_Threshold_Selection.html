<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8"/>
<title>RATS: Robust Automatic Threshold Selection - ImageJ</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"RATS:_Robust_Automatic_Threshold_Selection","wgTitle":"RATS: Robust Automatic Threshold Selection","wgCurRevisionId":32579,"wgRevisionId":32579,"wgArticleId":727,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Plugins","Segmentation","Tutorials"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"RATS:_Robust_Automatic_Threshold_Selection","wgRelevantArticleId":727,"wgRequestId":"cfabbbdfbbce0a05cc21892b","wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgPreferredVariant":"en","fancytree_path":"/extensions/TreeAndMenu/fancytree"});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user.cssprefs":"ready","user":"ready","user.options":"loading","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","skins.erudite":"ready"});mw.loader.implement("user.options@0j3lz3q",function($,jQuery,require,module){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens@1ku9xth",function ( $, jQuery, require, module ) {
mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});/*@nomin*/;

});mw.loader.load(["mediawiki.page.startup"]);});</script>
<link rel="stylesheet" href="erudite14.css"/>
<link rel="stylesheet" href="extensions/TreeAndMenu/fancytree/fancytree.css"/><link rel="stylesheet" href="extensions/TreeAndMenu/suckerfish/suckerfish.css"/>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="erudite15.css"/>
<meta name="generator" content="MediaWiki 1.28.0"/>
<meta name="description" content="Robust Automatic Threshold Selection (RATS) computes a threshold map for a 2d image based upon the value of pixels and their gradients."/>
<link rel="shortcut icon" href="skins/ij2.ico"/>
	<meta property="og:type" content="article"/>

	<meta property="og:site_name" content="ImageJ"/>

	<meta property="og:title" content="RATS: Robust Automatic Threshold Selection"/>

	<meta property="og:description" content="Robust Automatic Threshold Selection (RATS) computes a threshold map for a 2d image based upon the value of pixels and their gradients."/>


<meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-RATS_Robust_Automatic_Threshold_Selection rootpage-RATS_Robust_Automatic_Threshold_Selection skin-erudite action-view">
		<div id="top-wrap" role="banner">
			<h1><a href="Welcome" title="ImageJ" rel="home">ImageJ</a></h1>
			<div id="tagline">From ImageJ</div>

			<a id="menubutton" href="Robust_Automatic_Threshold_Selection.html#menu">Menu</a>
			<div id="nav" role="navigation">
			<ul id='menu'>
<li id="menu-item-n-About"><a href="ImageJ">About</a></li>
<li id="menu-item-n-Downloads"><a href="Downloads">Downloads</a></li>
<li id="menu-item-n-Learn"><a href="Learn">Learn</a></li>
<li id="menu-item-n-Develop"><a href="Development">Develop</a></li>
<li id="menu-item-n-News"><a href="News">News</a></li>
<li id="menu-item-n-Events"><a href="Events">Events</a></li>
<li id="menu-item-n-Help"><a href="Help">Help</a></li>
</ul>
			</div>
		</div>

		<div id="mw-js-message"></div>
		
		<div id="main" role="main">

			<div id="bodyContent">
				<div style="font-size: large; border: 1px solid black; padding: 1em; margin-bottom: 1em; text-align: center; background-color: #fda;">
					This is a read-only version of imagej.net, available during the transition to the new website, which you can preview <a href="https://imagej.github.io/">here</a>.
					<br>Please direct any questions or issues to <a href="https://forum.image.sc/t/imagej-wiki-is-down/39672">this Image.sc Forum thread</a>.
					<br>Thank you for your patience as we improve the website!
				</div>

				<h1>RATS: Robust Automatic Threshold Selection</h1>
				
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><table class="infobox" cellspacing="5" style="max-width: 30em; font-size: 80%; text-align: left; float: right; border: 1px solid #a0a0a0;">
<tr>
<th colspan="2" style="text-align: center; font-size: 130%;"> <div style="float: left"></div>RATS<div style="clear: left;"></div>
</th></tr>
<tr>
<th> Project
</th>
<td> Fiji
</td></tr>
<tr>
<th> URL
</th>
<td> <a rel="nofollow" class="external free" href="RATS">https://imagej.net/RATS</a>
</td></tr>
<tr>
<th> Source
</th>
<td> <a rel="nofollow" class="external text" href="https://github.com/fiji/RATS/releases/tag/RATS_-2.0.1">on GitHub</a>
</td></tr>
<tr>
<th> License
</th>
<td> <a href="GPLv3" class="mw-redirect" title="GPLv3">GPLv3</a>
</td></tr>
<tr>
<th> Release
</th>
<td> <a rel="nofollow" class="external text" href="http://maven.imagej.net/index.html#nexus-search;gav~sc.fiji~RATS_~2.0.1~~~kw,versionexpand">2.0.1</a>
</td></tr>
<tr>
<th> Date
</th>
<td> Sat Apr 29 23:00:06 CDT 2017
</td></tr>
<tr>
<th> <a href="Development_status" class="mw-redirect" title="Development status">Development status</a>
</th>
<td> Stable
</td></tr>
<tr>
<th> <a href="Support_status" class="mw-redirect" title="Support status">Support status</a>
</th>
<td> None
</td></tr>
<tr>
<th colspan="2" style="background: lightgray; font-variant: small-caps; text-align: center"> <a href="Team" class="mw-redirect" title="Team">Team</a>
</th></tr>
<tr>
<th> <a href="Team" class="mw-redirect" title="Team">Founders</a>
</th>
<td> <a href="./User:Tupper" title="User:Tupper">Ben Tupper</a>
</td></tr>
<tr>
<th> <a href="Team" class="mw-redirect" title="Team">Leads</a>
</th>
<td> -
</td></tr>
<tr>
<th> <a href="Team" class="mw-redirect" title="Team">Developers</a>
</th>
<td> -
</td></tr>
<tr>
<th> <a href="Team" class="mw-redirect" title="Team">Debuggers</a>
</th>
<td> -
</td></tr>
<tr>
<th> <a href="Team" class="mw-redirect" title="Team">Reviewers</a>
</th>
<td> -
</td></tr>
<tr>
<th> <a href="Team" class="mw-redirect" title="Team">Support</a>
</th>
<td> -
</td></tr>
<tr>
<th> <a href="Team" class="mw-redirect" title="Team">Maintainers</a>
</th>
<td> <a href="./User:Rueden" title="User:Rueden">Curtis Rueden</a>
</td></tr>

<tr>
<th> <a href="Team" class="mw-redirect" title="Team">Contributors</a>
</th>
<td> <a href="./User:Tupper" title="User:Tupper">Ben Tupper</a>, <a href="./User:Schindelin" title="User:Schindelin">Johannes Schindelin</a>, <a href="./User:Hinerm" title="User:Hinerm">Mark Hiner</a>
</td></tr>
</table><div class="project-info">
<span class="project-logo"><a href="Fiji" title="Fiji"><img class="simple-tooltip simple-tooltip-img" data-simple-tooltip="This page describes content which is part of the Fiji distribution of ImageJ. Click the logo for details." src="_images/a/ae/Fiji-icon.png"></img></a></span></div>
<p>Robust Automatic Threshold Selection (RATS) computes a threshold map for a 2d image based upon the value of pixels and their gradients. 
</p>
<h2><span class="mw-headline" id="Background">Background</span></h2>
<p>The RATS algorithm is applied across regions of the image making it suitable for thresholding noisy images with variable background. The plugin is based upon the description in
</p>
<ul><li>Wilkinson MHF (1998) <i>Segmentation techniques in image analysis of microbes</i>. Chapter 6 in: Wilkinson MHF, Schut F (eds.) <b>Digital Image Analysis of Microbes: Imaging, Morphometry, Fluorometry and Motility Techniques and Applications</b>, Vol. John Wiley &amp; Sons, New York. </li></ul>
<p>In this implementation the input gradient of the input image is computed using the Sobel kernels.  Traditionally the Sobel gradient is computed using 
</p>
<div class="center"><div class="floatnone"><div class="MediaTransformError" style="width: 130px; height: 0px; display:inline-block;">Error creating thumbnail: Unable to save thumbnail to destination</div></div></div> 
<p>The kernel operators are detailed in many sources including <a href="http://en.wikipedia.org/wiki/Sobel_operator" class="extiw" title="wikipedia:Sobel operator">here</a>.  However, Wilkinson shows that eliminating the square root yields suitable results with out the added cost of a final scan across the image to compute the root.  In the plugin the gradient is left simply as the sum of the squares of the kernel operations.
</p>
<div class="center"><div class="floatnone"><div class="MediaTransformError" style="width: 165px; height: 0px; display:inline-block;">Error creating thumbnail: Unable to save thumbnail to destination</div></div></div>
Pixels with gradients that fall below a user specified threshold, <div class="MediaTransformError" style="width: 20px; height: 0px; display:inline-block;">Error creating thumbnail: Unable to save thumbnail to destination</div> , are rejected.  The threshold is defined by an estimate of the noise (<div class="MediaTransformError" style="width: 11px; height: 0px; display:inline-block;">Error creating thumbnail: Unable to save thumbnail to destination</div> ,the standard deviation of the expected background is a good starting point) and a scaling factor (<div class="MediaTransformError" style="width: 10px; height: 0px; display:inline-block;">Error creating thumbnail: Unable to save thumbnail to destination</div>, 3 is a good starting point).  Estimate the noise by selecting a "background" portion of the image and using ImageJ to determine the standard deviation of gray values. 
The input image is then subdivided into a quadtree architecture (for more info see <a href="http://en.wikipedia.org/wiki/Quadtree" class="extiw" title="wikipedia:Quadtree">Wikipedia:Quadtree</a>).  Within each of the smallest subregions, a regional threshold, <div class="MediaTransformError" style="width: 24px; height: 0px; display:inline-block;">Error creating thumbnail: Unable to save thumbnail to destination</div> , is computed as the gradient weighted sum of the pixels, P.    
<div class="center"><div class="floatnone"><div class="MediaTransformError" style="width: 128px; height: 0px; display:inline-block;">Error creating thumbnail: Unable to save thumbnail to destination</div></div></div>
<p>Occasionally, the regional threshold fails if the sum of the weights (the denominator) falls to the level of background containing only noise.  In such cases, the regional threshold is replaced by the threshold of its parent quadtree (if the parent's threshold doesn't fail).  It is possible that thresholds fail all the way up the quadtree heirarchy, in which case a same threshold is applied to all regions which is identical to applying a global threshold.   In our experience, regional threshold failures are rare.  Once the regional thresholds are computed, they are interpolated (bilinear interpolation) across the entire image yielding a threshold map.
</p><p>The user also controls the size of the smallest quadtree region (aka leaflet).  As with the noise estimate and scaling factor, determining the appropriate minimum quadtree leaflet size is best done with experiment.  However, a good guide is to match the size of the smallest leaflet to something just larger than the size of the smallest object expected.  There is little performance loss by decreasing the size of the smallest leaflet. 
</p><p><br />
</p>
<h2><span class="mw-headline" id="Plugin_Usage">Plugin Usage</span></h2>
<div class="center"><div class="floatnone"><div class="MediaTransformError" style="width: 553px; height: 0px; display:inline-block;">Error creating thumbnail: Unable to save thumbnail to destination</div></div></div>
<p>Load an single channel image (8-bit, 16-bit or 32-bit).  Note that the plugin expects bright objects on dark background, so you might want to call <span><em><span style="border-bottom:1px dotted #ccc;"> Edit </span>&#160;&#8250; <span style="border-bottom:1px dotted #ccc;"> Invert</span></em></span>  if your input image has dark objects.  Select the RATS plugin from the Plugins menu.  The following dialog will appear:
</p><p>1. NOISE THRESHOLD: An estimate of the noise. Estimate the noise by selecting a "background" portion of the image and using ImageJ to determine the standard deviation of gray values. Oddly, lower values yield smaller particles in general. (see reference, defaults to 25).
</p><p>2. LAMBDA FACTOR: A scaling factor. Higher values yield larger particles. (see reference, defaults to 3)
</p><p>3. MIN LEAF SIZE (pixels): The smallest allowed leaflet (defaults to attempts to create up to 5 levels of quadtrees that fit in the input image dimensions)
</p><p>4. VERBOSE If set then output informational messages in the log window (default is false).
</p><p><br />
That's it!  A bilevel image is produced with the name "-mask" appended to the original image name.
</p>
<div class="center"><div class="floatnone"><div class="MediaTransformError" style="width: 442px; height: 0px; display:inline-block;">Error creating thumbnail: Unable to save thumbnail to destination</div></div></div>
<h2><span class="mw-headline" id="Macro_Usage">Macro Usage</span></h2>
<p>The plugin is recordable and can be called from a macro ....
</p><p><code>run("RATS ", "noise=25 lambda=3 min=81 verbose")</code>
</p>
<!-- 
NewPP limit report
Cached time: 20200713073231
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.088 seconds
Real time usage: 0.091 seconds
Preprocessor visited node count: 1363/1000000
Preprocessor generated node count: 5127/1000000
Post‐expand include size: 4453/2097152 bytes
Template argument size: 994/2097152 bytes
Highest expansion depth: 12/40
Expensive parser function count: 0/3
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%   50.705      1 - -total
 93.43%   47.373      1 - Template:ComponentStats:sc.fiji:RATS
 91.29%   46.290      1 - Template:Component
 64.96%   32.938      5 - Template:Person
  6.33%    3.210      1 - Template:Bc
  3.66%    1.858      1 - Template:GitHub
  2.96%    1.502      1 - Template:Project
  2.40%    1.219      1 - Template:Maven
  2.30%    1.164      1 - Template:SupportStatus
  2.00%    1.012      1 - Template:DevStatus
-->
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="index.php?title=RATS:_Robust_Automatic_Threshold_Selection&amp;oldid=32579">http://imagej.net/index.php?title=RATS:_Robust_Automatic_Threshold_Selection&amp;oldid=32579</a>"</div>
							</div>

			<div id="footer">
				<p> This page was last modified on 3 June 2017, at 18:42.</p><ul><li><a href="./ImageJ:Privacy_policy" title="ImageJ:Privacy policy">Privacy policy</a></li><li><a href="./ImageJ:About" class="mw-redirect" title="ImageJ:About">About ImageJ</a></li><li><a href="Imprint" title="Imprint">Imprint</a></li></ul>			</div>

			<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="./Special:Categories" title="Special:Categories">Categories</a>: <ul><li><a href="./Category:Plugins" title="Category:Plugins">Plugins</a></li><li><a href="./Category:Segmentation" title="Category:Segmentation">Segmentation</a></li><li><a href="./Category:Tutorials" title="Category:Tutorials">Tutorials</a></li></ul></div></div>		</div>

		<div id="bottom-wrap">
			<div id="footer-wrap-inner">
				<div id="ternary" class="footer">
					<ul>
						<li class="widget">
							<img id="logo" src="skins/imagej-128.png" alt="">
						</li>
					</ul>
				</div>
			</div>
		</div>
		<script>(window.RLQ=window.RLQ||[]).push(function(){mw.loader.load(["ext.fancytree","ext.suckerfish","mediawiki.action.view.postEdit","site","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest","ext.SimpleTooltip"]);});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":298});});</script>
		</body>
		</html>
		