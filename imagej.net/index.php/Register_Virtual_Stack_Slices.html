<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8"/>
<title>Register Virtual Stack Slices - ImageJ</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Register_Virtual_Stack_Slices","wgTitle":"Register Virtual Stack Slices","wgCurRevisionId":41314,"wgRevisionId":41314,"wgArticleId":19,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Plugins","Registration","TrakEM2"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Register_Virtual_Stack_Slices","wgRelevantArticleId":19,"wgRequestId":"195a5f58b541c2ca574e8d94","wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgPreferredVariant":"en","fancytree_path":"/extensions/TreeAndMenu/fancytree"});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user.cssprefs":"ready","user":"ready","user.options":"loading","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","skins.erudite":"ready"});mw.loader.implement("user.options@0j3lz3q",function($,jQuery,require,module){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens@1ku9xth",function ( $, jQuery, require, module ) {
mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});/*@nomin*/;

});mw.loader.load(["mediawiki.page.startup"]);});</script>
<link rel="stylesheet" href="../load.php%3Fdebug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%252Cshared%257Cmediawiki.sectionAnchor%257Cskins.erudite&amp;only=styles&amp;skin=erudite.css"/>
<script async="" src="../load.php%3Fdebug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=erudite"></script>
<link rel="stylesheet" href="../extensions/TreeAndMenu/fancytree/fancytree.css"/><link rel="stylesheet" href="../extensions/TreeAndMenu/suckerfish/suckerfish.css"/>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="../load.php%3Fdebug=false&amp;lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=erudite.css"/>
<meta name="generator" content="MediaWiki 1.28.0"/>
<meta name="description" content="This plugin takes a sequence of image slices stored in a folder, and delivers a list of registered image slices (with enlarged canvas). One of the images in the sequence can be selected by the user as reference and it will remain intact."/>
<link rel="shortcut icon" href="../skins/ij2.ico"/>
<link rel="search" type="application/opensearchdescription+xml" href="http://imagej.net/opensearch_desc.php" title="ImageJ (en)"/>
<link rel="EditURI" type="application/rsd+xml" href="http://imagej.net/api.php?action=rsd"/>
<link rel="alternate" type="application/atom+xml" title="ImageJ Atom feed" href="http://imagej.net/index.php?title=Special:RecentChanges&amp;feed=atom"/>

<script type="text/javascript" src="../extensions/SyntaxHighlighter/syntaxhighlighter/scripts/shCore.js"></script>
<script type="text/javascript" src="../extensions/SyntaxHighlighter/syntaxhighlighter/scripts/shBrushPython.js"></script>
<script type="text/javascript">
SyntaxHighlighter.all();
</script>
<link rel="stylesheet" type="text/css" media="screen" href="../extensions/SyntaxHighlighter/syntaxhighlighter/styles/shCoreMinit.css" />

	<meta property="og:type" content="article"/>

	<meta property="og:site_name" content="ImageJ"/>

	<meta property="og:title" content="Register Virtual Stack Slices"/>

	<meta property="og:description" content="This plugin takes a sequence of image slices stored in a folder, and delivers a list of registered image slices (with enlarged canvas). One of the images in the sequence can be selected by the user as reference and it will remain intact."/>

	<meta property="og:url" content="http://imagej.net/Register_Virtual_Stack_Slices"/>

<meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Register_Virtual_Stack_Slices rootpage-Register_Virtual_Stack_Slices skin-erudite action-view">
		<div class="mw-jump">
			<a href="Register_Virtual_Stack_Slices.html#bodyContent">Skip to content</a>, 			<a href="Register_Virtual_Stack_Slices.html#search">Skip to search</a>
		</div>

		<div id="top-wrap" role="banner">
			<h1><a href="http://imagej.net/Welcome" title="ImageJ" rel="home">ImageJ</a></h1>
			<div id="tagline">From ImageJ</div>

			<a id="menubutton" href="Register_Virtual_Stack_Slices.html#menu">Menu</a>
			<div id="nav" role="navigation">
			<ul id='menu'>
<li id="menu-item-n-About"><a href="http://imagej.net/ImageJ">About</a></li>
<li id="menu-item-n-Downloads"><a href="http://imagej.net/Downloads">Downloads</a></li>
<li id="menu-item-n-Learn"><a href="http://imagej.net/Learn">Learn</a></li>
<li id="menu-item-n-Develop"><a href="http://imagej.net/Development">Develop</a></li>
<li id="menu-item-n-News"><a href="http://imagej.net/News">News</a></li>
<li id="menu-item-n-Events"><a href="http://imagej.net/Events">Events</a></li>
<li id="menu-item-n-Help"><a href="http://imagej.net/Help">Help</a></li>
</ul>
			</div>
		</div>

		<div id="mw-js-message"></div>
		
		<div id="main" role="main">
			<div id="nav-meta">
			<span id="ca-nstab-main" class="selected"><a href="http://imagej.net/Register_Virtual_Stack_Slices" title="View the content page [c]" accesskey="c">Page</a></span><span class="meta-sep">|</span><span id="ca-talk" class="new"><a href="http://imagej.net/index.php?title=Talk:Register_Virtual_Stack_Slices&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page [t]" accesskey="t">Discussion</a></span><span class="meta-sep">|</span><span id="ca-viewsource"><a href="http://imagej.net/index.php?title=Register_Virtual_Stack_Slices&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span><span class="meta-sep">|</span><span id="ca-history"><a href="http://imagej.net/index.php?title=Register_Virtual_Stack_Slices&amp;action=history" title="Past revisions of this page [h]" accesskey="h">History</a></span><span class="meta-sep">|</span>			</div>

			<div id="bodyContent">
				<h1>Register Virtual Stack Slices</h1>
				
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><table class="infobox" cellspacing="5" style="max-width: 30em; font-size: 80%; text-align: left; float: right; border: 1px solid #a0a0a0;">
<tr>
<th colspan="2" style="text-align: center; font-size: 130%;"> <div style="float: left"></div>Register Virtual Stack Slices<div style="clear: left;"></div>
</th></tr>
<tr>
<th> Project
</th>
<td> Fiji
</td></tr>
<tr>
<th> URL
</th>
<td> <a rel="nofollow" class="external free" href="https://imagej.net/Register_Virtual_Stack_Slices">https://imagej.net/Register_Virtual_Stack_Slices</a>
</td></tr>
<tr>
<th> Source
</th>
<td> <a rel="nofollow" class="external text" href="https://github.com/fiji/register_virtual_stack_slices/releases/tag/register_virtual_stack_slices-3.0.3">on GitHub</a>
</td></tr>
<tr>
<th> License
</th>
<td> <a href="http://imagej.net/GPLv3" class="mw-redirect" title="GPLv3">GPLv3</a>
</td></tr>
<tr>
<th> Release
</th>
<td> <a rel="nofollow" class="external text" href="http://maven.imagej.net/index.html#nexus-search;gav~sc.fiji~register_virtual_stack_slices~3.0.3~~~kw,versionexpand">3.0.3</a>
</td></tr>
<tr>
<th> Date
</th>
<td> Thu May 25 13:05:40 CDT 2017
</td></tr>
<tr>
<th> <a href="http://imagej.net/Development_status" class="mw-redirect" title="Development status">Development status</a>
</th>
<td> Active
</td></tr>
<tr>
<th> <a href="http://imagej.net/Support_status" class="mw-redirect" title="Support status">Support status</a>
</th>
<td> Active
</td></tr>
<tr>
<th colspan="2" style="background: lightgray; font-variant: small-caps; text-align: center"> <a href="http://imagej.net/Team" class="mw-redirect" title="Team">Team</a>
</th></tr>
<tr>
<th> <a href="http://imagej.net/Team" class="mw-redirect" title="Team">Founders</a>
</th>
<td> <a href="http://imagej.net/User:Albertcardona" title="User:Albertcardona">Albert Cardona</a>
</td></tr>
<tr>
<th> <a href="http://imagej.net/Team" class="mw-redirect" title="Team">Leads</a>
</th>
<td> <a href="http://imagej.net/User:Iarganda" title="User:Iarganda">Ignacio Arganda-Carreras</a>
</td></tr>
<tr>
<th> <a href="http://imagej.net/Team" class="mw-redirect" title="Team">Developers</a>
</th>
<td> <a href="http://imagej.net/User:Iarganda" title="User:Iarganda">Ignacio Arganda-Carreras</a>
</td></tr>
<tr>
<th> <a href="http://imagej.net/Team" class="mw-redirect" title="Team">Debuggers</a>
</th>
<td> <a href="http://imagej.net/User:Iarganda" title="User:Iarganda">Ignacio Arganda-Carreras</a>
</td></tr>
<tr>
<th> <a href="http://imagej.net/Team" class="mw-redirect" title="Team">Reviewers</a>
</th>
<td> <a href="http://imagej.net/User:Iarganda" title="User:Iarganda">Ignacio Arganda-Carreras</a>
</td></tr>
<tr>
<th> <a href="http://imagej.net/Team" class="mw-redirect" title="Team">Support</a>
</th>
<td> <a href="http://imagej.net/User:Iarganda" title="User:Iarganda">Ignacio Arganda-Carreras</a>
</td></tr>
<tr>
<th> <a href="http://imagej.net/Team" class="mw-redirect" title="Team">Maintainers</a>
</th>
<td> <a href="http://imagej.net/User:Iarganda" title="User:Iarganda">Ignacio Arganda-Carreras</a>, <a href="http://imagej.net/User:Rueden" title="User:Rueden">Curtis Rueden</a>
</td></tr>

<tr>
<th> <a href="http://imagej.net/Team" class="mw-redirect" title="Team">Contributors</a>
</th>
<td> <a href="http://imagej.net/User:Albertcardona" title="User:Albertcardona">Albert Cardona</a>, <a href="http://imagej.net/User:Schindelin" title="User:Schindelin">Johannes Schindelin</a>, <a href="http://imagej.net/User:Eglinger" title="User:Eglinger">Jan Eglinger</a>, <a href="http://imagej.net/User:Saalfeld" class="mw-redirect" title="User:Saalfeld">Stephan Saalfeld</a>
</td></tr>
</table><div class="project-info">
<span class="project-logo"><a href="http://imagej.net/Fiji" title="Fiji"><img class="simple-tooltip simple-tooltip-img" data-simple-tooltip="This page describes content which is part of the Fiji distribution of ImageJ. Click the logo for details." src="../_images/a/ae/Fiji-icon.png"></img></a></span></div>
<table>
<tr>
<td style="vertical-align:top"><a href="http://imagej.net/File:Rvs_scheme.png" class="image" title="Register Virtual Stack scheme - All images are transformed to match the reference"><img alt="Register Virtual Stack scheme - All images are transformed to match the reference" src="../_images/6/66/Rvs_scheme.png" width="380" height="139" /></a>
</td></tr></table>
<p>This plugin takes a sequence of image slices stored in a folder, and delivers a list of registered image slices (with enlarged canvas). One of the images in the sequence can be selected by the user as <b>reference</b> and it will remain intact.
</p><p>The plugin can perform<b> 6 types of image registration techniques</b>:
</p>
<ul><li> Translation</li>
<li> Rigid (translation + rotation)</li>
<li> Similarity (translation + rotation + isotropic scaling)</li>
<li> Affine</li>
<li> Elastic (via <a href="http://imagej.net/BUnwarpJ" title="BUnwarpJ"> bUnwarpJ</a> with cubic B-splines) </li>
<li> Moving least squares  </li></ul>
<p>All models are aided by automatically extracted <a href="http://imagej.net/Feature_Extraction" title="Feature Extraction"> SIFT features</a>.
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="Register_Virtual_Stack_Slices.html#User_Manual"><span class="tocnumber">1</span> <span class="toctext">User Manual</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="Register_Virtual_Stack_Slices.html#Shrinkage_constrain"><span class="tocnumber">1.1</span> <span class="toctext">Shrinkage constrain</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="Register_Virtual_Stack_Slices.html#Save_Transforms"><span class="tocnumber">1.2</span> <span class="toctext">Save Transforms</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="Register_Virtual_Stack_Slices.html#Notes"><span class="tocnumber">1.3</span> <span class="toctext">Notes</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-5"><a href="Register_Virtual_Stack_Slices.html#Examples"><span class="tocnumber">2</span> <span class="toctext">Examples</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="Register_Virtual_Stack_Slices.html#API_documentation"><span class="tocnumber">3</span> <span class="toctext">API documentation</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="Register_Virtual_Stack_Slices.html#Scripting_.2F_PlugIn"><span class="tocnumber">4</span> <span class="toctext">Scripting / PlugIn</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="Register_Virtual_Stack_Slices.html#See_also"><span class="tocnumber">5</span> <span class="toctext">See also</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="Register_Virtual_Stack_Slices.html#References"><span class="tocnumber">6</span> <span class="toctext">References</span></a></li>
<li class="toclevel-1 tocsection-10"><a href="Register_Virtual_Stack_Slices.html#License"><span class="tocnumber">7</span> <span class="toctext">License</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="User_Manual">User Manual</span></h2>
<p><b>Premises</b>:<br />
<ul>
<ul><li><b>Source folder</b>: You have a folder with an ordered list of image files in it that ImageJ can open.</li>
<li>Each image represents a slice in a sequence.</li>
<li><b>Output folder</b>: You have or create a folder to store the resulting virtual stack with the aligned images.</li></ul>
</ul>
</p>
<p>Images may have different dimensions and be of different type.</p>
<p><b>Step 1</b>: launch the "Plugins - Registration - Register Virtual Stack Slices" plugin.</p>
<div class="thumb tright"><div class="thumbinner" style="width:402px;"><a href="http://imagej.net/File:Rvs_main_window.png" class="image"><img alt="" src="../_images/8/8b/Rvs_main_window.png" width="400" height="181" class="thumbimage" /></a>  <div class="thumbcaption"><div class="magnify"><a href="http://imagej.net/File:Rvs_main_window.png" class="internal" title="Enlarge"></a></div>Register Virtual Stack main window</div></div></div>
<p><b>Step 2</b>: choose the appropriate options:<br />
<ul>
<ul><li><b>Select a source folder</b> containing the slices, at one slice per image file.</li>
<li><b>Select the output folder</b> where resulting registered slices are automatically stored as TIFF files.</li>
<li><b>Feature extraction model</b>. The expected transformation model finding inliers (i.e. correspondences or landmarks between images) in the feature extraction: translation, rigid, similarity or affine.</li>
<li><b>Registration model</b>. The image transformation model: translation, rigid, similarity, affine, elastic or moving least squares.</li>
<li><b>Advanced setup</b>. The advanced checkbox: whether to see the <a href="http://imagej.net/Feature_Extraction#Parameters" title="Feature Extraction"> feature extraction parameters</a> setup dialog, and if elastic, the <a href="http://imagej.net/BUnwarpJ" title="BUnwarpJ"> bUnwarpJ</a> dialog. Otherwise the plugin operates on reasonable, default parameters.</li>
<li><b>Shrinkage constrain</b>. Option to regularize the registration in order to avoid section shrinking.</li>
<li><b>Save transforms</b>. Option to save the resulting transforms into files, that can be loaded using <a href="http://imagej.net/Transform_Virtual_Stack_Slices" title="Transform Virtual Stack Slices">Transform Virtual Stack Slices</a>.</li></ul>
</ul>   
</p>
<p><b>Step 3</b>: choose the <b>reference</b> image (only if the "Shrinkage constraint" checkbox was not marked):<br />
<ul>
<ul><li>Select one of the images from the source folder as the reference image.</li></ul>
</ul>   
</p>
<p>On success, a virtual stack will open showing all the registered images contained in the target folder. The virtual stack can be closed with no ill effect: images are saved in the target folder.</p>
<h3><span class="mw-headline" id="Shrinkage_constrain">Shrinkage constrain</span></h3>
<div class="thumb tright"><div class="thumbinner" style="width:402px;"><a href="http://imagej.net/File:RVS_shrink_option.png" class="image"><img alt="" src="../_images/6/62/RVS_shrink_option.png" width="400" height="168" class="thumbimage" /></a>  <div class="thumbcaption"><div class="magnify"><a href="http://imagej.net/File:RVS_shrink_option.png" class="internal" title="Enlarge"></a></div>Shrinkage constrain checkbox</div></div></div>
<p>Since the 09/13/2009 version and thanks to <a rel="nofollow" class="external text" href="http://hebb.mit.edu/">Daniel Berger</a>, Register Virtual Stack Slices has the option of constraining the registration to avoid section shrinking for large sets of images.
</p><p>If this option is used, <b>no reference image needs to be selected</b>. All images will be transformed into the same common space by initializing first the system with a rigid transformation and then relaxing it based on the desired registration model.
</p><p>To do so, in the main dialog, you have to check the "Shrinkage constrain" option (see attached window). 
</p><p>If you check as well the "Advance setup" checkbox from the same dialog, then a new window will appear to select the corresponding parameters to regularize the section shrinkage based on the properties of the transformation. If we choose "affine" as registration model, then we will be able to regularize:
</p>
<div class="thumb tright"><div class="thumbinner" style="width:202px;"><a href="http://imagej.net/File:RVS_regularization_params.png" class="image"><img alt="" src="../_images/d/d0/RVS_regularization_params.png" width="200" height="210" class="thumbimage" /></a>  <div class="thumbcaption"><div class="magnify"><a href="http://imagej.net/File:RVS_regularization_params.png" class="internal" title="Enlarge"></a></div>Shrinkage regularization parameters</div></div></div>
<ul><li> the <a href="http://en.wikipedia.org/wiki/Shear_mapping" class="extiw" title="wikipedia:Shear mapping">shear</a>,</li>
<li> the <a href="http://en.wikipedia.org/wiki/Scaling_(geometry)" class="extiw" title="wikipedia:Scaling (geometry)">scaling</a>,</li>
<li> and the <a href="http://en.wikipedia.org/wiki/Isotropy" class="extiw" title="wikipedia:Isotropy">isotropy</a> or aspect ratio.</li></ul>
<p>For the registration models "translation" and "rigid", no regularization is needed since these linear transformations don't apply. In the case of the "similarity" registration model, only the shearing and scaling will be regularized.
</p><p><b>TODO</b>: the "elastic" and "moving least squares" registration models do not have a proper shrinkage regularization implementation yet. 
</p><p>In the case of the "elastic" model, only a rigid registration will be performed. If you need to regularize the elastic transformation between the sections, you better do it through the bUnwarpJ paramters (see <a href="http://imagej.net/Register_Virtual_Stack_Slices#Notes" title="Register Virtual Stack Slices"> Notes</a> below).
</p><p>For the "moving least squares" model, the maximal warping will still take place with no regularization.
</p><p>We can visualize the relaxation of the system into the desired registration model by checking the option "Display relaxation graph". In this graph the average mean squared error (MSE) between the correspondences of the whole sequence of slices is displayed for each relaxation iteration.
</p>
<h3><span class="mw-headline" id="Save_Transforms">Save Transforms</span></h3>
<p>Since the 09/24/2009 version, the plugin has the option to store the resulting transforms into files. This way, the results can be reproduce later on the same images or on a difference sequence by using the plugin <a href="http://imagej.net/Transform_Virtual_Stack_Slices" title="Transform Virtual Stack Slices">Transform Virtual Stack Slices</a>.
</p><p>To save the transforms, you just have to click on the "Save transforms" check-box of the main dialog. Then, after selecting the source and output directories, a new dialog will pop up to select the folder to store the transforms in.
</p><p>The transforms are saved as <b>.XML</b> files, following <a href="http://imagej.net/TrakEM2" title="TrakEM2">TrakEM2</a> format.
</p>
<h3><span class="mw-headline" id="Notes">Notes</span></h3>
<ol>
<li>The plugin is multithreaded: more CPU cores means faster execution.</li>
<li>The two most relevant parameters in the <a href="http://imagej.net/Feature_Extraction" title="Feature Extraction"> SIFT feature extraction</a> are:<br />
<ul>
<li><b>maximum image size</b>, which limits the low-end size of the features (i.e. decrease maximum image size to increase the size of the smallest features to extract.)</li>
<li><b>inlier ratio</b>, which determines when to reject the intersection set of feature correspondences between two images (ratio between correspondent features vs. all extracted features.)</li>
</ul></li>
<li>All types of images are accepted (8-bit, 16-bit, 32-bit and RGB) but only in  .tif, .jpg, .png, .gif, .tiff, .jpeg, .bmp, .pgm, or .ima format. Output images are saved as TIFF.</li>
<li>If you selected the "Advanced setup" and "Elastic" as registration model, another window to adjust the elastic registration parameters will be shown.</li>
<div class="thumb tright"><div class="thumbinner" style="width:282px;"><a href="http://imagej.net/File:Rvs_elastic_options_351x446.png" class="image"><img alt="" src="../_images/7/78/Rvs_elastic_options_351x446.png" width="280" height="356" class="thumbimage" /></a>  <div class="thumbcaption"><div class="magnify"><a href="http://imagej.net/File:Rvs_elastic_options_351x446.png" class="internal" title="Enlarge"></a></div>Elastic registration options</div></div></div>
<p>This is actually a reduced version of the <a href="http://imagej.net/BUnwarpJ" title="BUnwarpJ"> bUnwarpJ</a> main window. 
</p><p>Briefly, the options are:
</p>
<ul><li> <b>Registration mode</b>: "Mono", "Accurate" or "Fast". "Mono" means unidirectional registration and its actually the fastest of the three modes. "Accurate" and "Fast" perform bidirectional registration and take more time.</li>
<li> <b>Image Subsampling factor</b>: the image scaling factor from 2⁰ (1) to 2⁷ (128). We recommend to use it if the images are very large.</li>
<li> <b>Initial and Final deformations</b>: from "Very Coarse" to "Very Fine" or "Super Fine". They define the number of B-spline coefficients in the deformation grid (from 2x2 to 16x16). More coefficients mean more precision but also the possibility of over-registering.</li>
<li> <b>Divergence and curl weights</b>. They regularize the deformation to make it smooth. </li>
<li> <b>Landmark weight</b>: relevance of adjusting the correspondences found in the feature extraction.</li>
<li> <b>Image weight</b>: relevance of the similarity between source and target image in the energy function.</li>
<li> <b>Consistency weight</b>: relevance of the consistency error between the direct and inverse deformations (only for "Accurate" or "Fast" modes).</li>
<li> <b>Stop threshold</b>: difference between the last and previous algorithm iterations that makes the registration to end.</li></ul>
<p><br />
For a complete description of the elastic parameters, please visit the <a rel="nofollow" class="external text" href="http://biocomp.cnb.csic.es/~iarganda/bUnwarpJ/faq.html">FAQ of the original website</a>.
</p>
</ol>
<h2><span class="mw-headline" id="Examples">Examples</span></h2>
<p>Example of registration results using the shrinking constraint:
</p>
<table>
<tr><td><b>Raw:</b></td><td><b>Registered:</b></td></tr>
<tr><td><div class="MediaTransformError" style="width: 310px; height: 0px; display:inline-block;">Error creating thumbnail: Unable to save thumbnail to destination</div></td><td><div class="MediaTransformError" style="width: 310px; height: 0px; display:inline-block;">Error creating thumbnail: Unable to save thumbnail to destination</div></td></tr>
</table>
<p><br />
</p>
<p>Even this sequence of rather noisy transmission electron microscopy images, with considerable variations from slice to slice, got registered properly:</p>
<p><br />
</p>
<table>
<tr><td><b>Raw:</b></td><td><b>Registered:</b></td></tr>
<tr><td><div class="MediaTransformError" style="width: 286px; height: 0px; display:inline-block;">Error creating thumbnail: Unable to save thumbnail to destination</div></td><td><div class="MediaTransformError" style="width: 332px; height: 0px; display:inline-block;">Error creating thumbnail: Unable to save thumbnail to destination</div></td></tr></table>
<h2><span class="mw-headline" id="API_documentation">API documentation</span></h2>
<p>The latest documentation of the package can be found here: 
</p><p><a rel="nofollow" class="external free" href="https://fiji.sc/javadoc/register_virtual_stack/package-summary.html">https://fiji.sc/javadoc/register_virtual_stack/package-summary.html</a>
</p>
<h2><span class="mw-headline" id="Scripting_.2F_PlugIn">Scripting / PlugIn</span></h2>
<p>You can call the plugin in a non-interactive fashion from a jython script:</p>
<pre class="brush:python">
from register_virtual_stack import Register_Virtual_Stack_MT

# source directory
source_dir = "/path/to/source/"
# output directory
target_dir = "/path/to/target/"
# transforms directory
transf_dir = "/path/to/transforms/"
# reference image
reference_name = "reference_image"
# shrinkage option (false)
use_shrinking_constraint = 0

p = Register_Virtual_Stack_MT.Param()
# The "maximum image size":
p.sift.maxOctaveSize = 1024
# The "inlier ratio":
p.minInlierRatio = 0.05

Register_Virtual_Stack_MT.exec(source_dir, target_dir, transf_dir, 
reference_name, p, use_shrinking_constraint)
</pre>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul><li> <a href="http://imagej.net/Transform_Virtual_Stack_Slices" title="Transform Virtual Stack Slices">Transform Virtual Stack Slices</a>, to see how to load the saved transforms.</li>
<li> <a rel="nofollow" class="external text" href="https://fiji.sc/cgi-bin/gitweb.cgi?p=mpicbg.git;a=blob;f=mpicbg/imagefeatures/FloatArray2DSIFT.java;hb=HEAD">FloatArray2DSIFT.java</a> which contains the subclass Param which is the 'sift' member of the Register_Virtual_Stack_Slices.Param subclass.</li>
<li> <a rel="nofollow" class="external text" href="https://github.com/fiji/register_virtual_stack_slices/blob/master/src/main/java/register_virtual_stack/Register_Virtual_Stack_MT.java">Register_Virtual_Stack_MT.java</a>, including the Param subclass.</li>
<li> <a href="http://imagej.net/Elastic_Alignment_and_Montage" title="Elastic Alignment and Montage">Elastic Alignment and Montage plugin</a>, for elastic registration/montage of large datasets using spring meshes (local deformations).</li></ul>
<h2><span class="mw-headline" id="References">References</span></h2>
<p>The algorithm implemented for elastic registration (<a href="http://imagej.net/BUnwarpJ" title="BUnwarpJ">bUnwarpJ</a>) and its technical explanations are detailed on the paper: 
</p>
<ul><li>I. Arganda-Carreras, C. O. S. Sorzano, R. Marabini, J.-M. Carazo, C. Ortiz-de Solorzano, and J. Kybic, <a rel="nofollow" class="external text" href="http://biocomp.cnb.uam.es/~iarganda/bUnwarpJ/downloads/arganda_carreras_CVAMIA06.pdf">"Consistent and Elastic Registration of Histological Sections using Vector-Spline Regularization,"</a> Lecture Notes in Computer Science, Springer Berlin / Heidelberg, volume 4241/2006, CVAMIA: Computer Vision Approaches to Medical Image Analysis, pages 85-95, 2006.</li></ul>
<h2><span class="mw-headline" id="License">License</span></h2>
<p>This program is <b>free software</b>; you can redistribute it and/or modify it under the terms of the <b>GNU General Public License</b> as published by the Free Software Foundation (<a rel="nofollow" class="external free" href="http://www.gnu.org/licenses/gpl.txt">http://www.gnu.org/licenses/gpl.txt</a>).
</p><p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.  
</p>
<hr />

<!-- 
NewPP limit report
Cached time: 20200713073216
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.120 seconds
Real time usage: 0.125 seconds
Preprocessor visited node count: 3049/1000000
Preprocessor generated node count: 4788/1000000
Post‐expand include size: 6299/2097152 bytes
Template argument size: 1889/2097152 bytes
Highest expansion depth: 12/40
Expensive parser function count: 0/3
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%   82.738      1 - -total
 99.27%   82.135      1 - Template:ComponentStats:sc.fiji:register_virtual_stack_slices
 96.90%   80.176      1 - Template:Component
 80.34%   66.469     12 - Template:Person
  2.71%    2.241      2 - Template:GitHub
  1.73%    1.432      1 - Template:Project
  1.61%    1.332      1 - Template:Maven
  1.46%    1.205      1 - Template:DevStatus
  1.31%    1.086      1 - Template:SupportStatus
-->
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="http://imagej.net/index.php?title=Register_Virtual_Stack_Slices&amp;oldid=41314">http://imagej.net/index.php?title=Register_Virtual_Stack_Slices&amp;oldid=41314</a>"</div>
							</div>

			<div id="footer">
				<p> This page was last modified on 24 January 2020, at 11:55.</p><ul><li><a href="http://imagej.net/ImageJ:Privacy_policy" title="ImageJ:Privacy policy">Privacy policy</a></li><li><a href="http://imagej.net/ImageJ:About" class="mw-redirect" title="ImageJ:About">About ImageJ</a></li><li><a href="http://imagej.net/Imprint" title="Imprint">Imprint</a></li><li><a href="http://imagej.net/index.php?title=Register_Virtual_Stack_Slices&amp;mobileaction=toggle_view_mobile" class="noprint stopMobileRedirectToggle">Mobile view</a></li></ul>			</div>

			<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="http://imagej.net/Special:Categories" title="Special:Categories">Categories</a>: <ul><li><a href="http://imagej.net/Category:Plugins" title="Category:Plugins">Plugins</a></li><li><a href="http://imagej.net/Category:Registration" title="Category:Registration">Registration</a></li><li><a href="http://imagej.net/Category:TrakEM2" title="Category:TrakEM2">TrakEM2</a></li></ul></div></div>		</div>

		<div id="bottom-wrap">
		<div id="footer-wrap-inner">

		<div id="primary" class="footer">
			<ul>

			<li id="search" class="widget">
				<h3>Search</h3>
				<form action="http://imagej.net/index.php" id="searchform">
					<input type='hidden' name="title" value="Special:Search" />
					<div>
						<input name="search" placeholder="Search ImageJ" title="Search ImageJ [f]" accesskey="f" id="s"/>						<input type="submit" name="go" value="Search" title="Go to a page with this exact name if it exists" class="searchButton" id="searchsubmit"/>					</div>
				</form>
			</li>

			
						<li class="widget">
				<h3>Personal tools</h3>
				<div>
					<ul>
					<li id="pt-createaccount"><a href="http://imagej.net/index.php?title=Special:CreateAccount&amp;returnto=Register+Virtual+Stack+Slices" title="You are encouraged to create an account and log in; however, it is not mandatory">Create account</a></li><li id="pt-login"><a href="http://imagej.net/index.php?title=Special:UserLogin&amp;returnto=Register+Virtual+Stack+Slices" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>					</ul>
				</div>
			</li>
			
			<li class="widget">
							</li>

			</ul>
		</div>

		<div id="secondary" class="footer">
			<ul>

			<li id="toolbox" class="widget">
				<h3>Tools</h3>
				<ul>
				<li id="t-whatlinkshere"><a href="http://imagej.net/Special:WhatLinksHere/Register_Virtual_Stack_Slices" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li><li id="t-recentchangeslinked"><a href="http://imagej.net/Special:RecentChangesLinked/Register_Virtual_Stack_Slices" rel="nofollow" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li><li id="t-specialpages"><a href="http://imagej.net/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li><li id="t-print"><a href="http://imagej.net/index.php?title=Register_Virtual_Stack_Slices&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li><li id="t-permalink"><a href="http://imagej.net/index.php?title=Register_Virtual_Stack_Slices&amp;oldid=41314" title="Permanent link to this revision of the page">Permanent link</a></li><li id="t-info"><a href="http://imagej.net/index.php?title=Register_Virtual_Stack_Slices&amp;action=info" title="More information about this page">Page information</a></li>				</ul>
			</li>

			
			<li class="widget">
							</li>

			</ul>
		</div>

		<div id="ternary" class="footer">
			<ul>

			<li class="widget">
				<img id="logo" src="../skins/imagej-128.png" alt=""/>			</li>

			<li class="widget">
				<h3><span class="mw-headline" id="MORE_TOOLS">MORE TOOLS</span></h3>
<ul><li> <a href="http://imagej.net/Special:ChangeUploadPassword" title="Special:ChangeUploadPassword">Set/change upload password</a></li>
<li> <a href="http://imagej.net/Special:RecentChanges" title="Special:RecentChanges">Recent changes</a></li>
<li> <a href="http://imagej.net/Special:LonelyPages" title="Special:LonelyPages">Orphaned pages</a></li></ul>
			</li>

			</ul>
		</div>
		<div style="clear: both"></div>

		</div>
		</div>

		<script>(window.RLQ=window.RLQ||[]).push(function(){mw.loader.load(["ext.fancytree","ext.suckerfish","mediawiki.toc","mediawiki.action.view.postEdit","site","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest","ext.SimpleTooltip"]);});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":336});});</script>
		</body>
		</html>
		