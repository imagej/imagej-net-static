<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8"/>
<title>SPIM Bead Registration - ImageJ</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"SPIM_Bead_Registration","wgTitle":"SPIM Bead Registration","wgCurRevisionId":17137,"wgRevisionId":17137,"wgArticleId":1407,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"SPIM_Bead_Registration","wgRelevantArticleId":1407,"wgRequestId":"2f895d8c524f148b2273697c","wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgPreferredVariant":"en","fancytree_path":"/extensions/TreeAndMenu/fancytree"});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user.cssprefs":"ready","user":"ready","user.options":"loading","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","skins.erudite":"ready"});mw.loader.implement("user.options@0j3lz3q",function($,jQuery,require,module){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens@1ku9xth",function ( $, jQuery, require, module ) {
mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});/*@nomin*/;

});mw.loader.load(["mediawiki.page.startup"]);});</script>
<link rel="stylesheet" href="erudite14.css"/>
<link rel="stylesheet" href="extensions/TreeAndMenu/fancytree/fancytree.css"/><link rel="stylesheet" href="extensions/TreeAndMenu/suckerfish/suckerfish.css"/>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="erudite15.css"/>
<meta name="generator" content="MediaWiki 1.28.0"/>
<meta name="description" content="Please note that the SPIM registration plugin available through Fiji, is based on a publication. If you use it successfully for your research please be so kind to cite our work:"/>
<link rel="shortcut icon" href="skins/ij2.ico"/>

<script type="text/javascript" src="extensions/SyntaxHighlighter/syntaxhighlighter/scripts/shCore.js"></script>
<script type="text/javascript" src="extensions/SyntaxHighlighter/syntaxhighlighter/scripts/shBrushJava.js"></script>
<script type="text/javascript">
SyntaxHighlighter.all();
</script>
<link rel="stylesheet" type="text/css" media="screen" href="extensions/SyntaxHighlighter/syntaxhighlighter/styles/shCoreMinit.css" />

	<meta property="og:type" content="article"/>

	<meta property="og:site_name" content="ImageJ"/>

	<meta property="og:title" content="SPIM Bead Registration"/>

	<meta property="og:description" content="Please note that the SPIM registration plugin available through Fiji, is based on a publication. If you use it successfully for your research please be so kind to cite our work:"/>


<meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-SPIM_Bead_Registration rootpage-SPIM_Bead_Registration skin-erudite action-view">
		<div id="top-wrap" role="banner">
			<h1><a href="Welcome" title="ImageJ" rel="home">ImageJ</a></h1>
			<div id="tagline">From ImageJ</div>

			<a id="menubutton" href="SPIM_Bead_Registration.html#menu">Menu</a>
			<div id="nav" role="navigation">
			<ul id='menu'>
<li id="menu-item-n-About"><a href="ImageJ">About</a></li>
<li id="menu-item-n-Downloads"><a href="Downloads">Downloads</a></li>
<li id="menu-item-n-Learn"><a href="Learn">Learn</a></li>
<li id="menu-item-n-Develop"><a href="Development">Develop</a></li>
<li id="menu-item-n-News"><a href="News">News</a></li>
<li id="menu-item-n-Events"><a href="Events">Events</a></li>
<li id="menu-item-n-Help"><a href="Help">Help</a></li>
</ul>
			</div>
		</div>

		<div id="mw-js-message"></div>
		
		<div id="main" role="main">

			<div id="bodyContent">
				<div style="font-size: large; border: 1px solid black; padding: 1em; margin-bottom: 1em; text-align: center; background-color: #fda;">
					This is a read-only version of imagej.net, available during the transition to the new website, which you can preview <a href="https://imagej.github.io/">here</a>.
					<br>Please direct any questions or issues to <a href="https://forum.image.sc/t/imagej-wiki-is-down/39672">this Image.sc Forum thread</a>.
					<br>Thank you for your patience as we improve the website!
				</div>

				<h1>SPIM Bead Registration</h1>
				
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><table class="infobox" cellspacing="5" style="max-width: 31em; font-size: 90%; text-align: left; float: right; border: 1px solid #a0a0a0;">
<tr>
<th colspan="2" style="text-align: center; font-size: 130%;"> <div style="float: left"></div>Selective Plane Illumination Microscopy Bead-based Registration (ImageJ)<div style="clear: left;"></div>
</th></tr>
<tr>
<th> Author
</th>
<td> Stephan Preibisch, Stephan Saalfeld, Johannes Schindelin, Pavel Tomancak
</td></tr>




<tr>
<th> Maintainer
</th>
<td> Stephan Preibisch
</td></tr>

<tr>
<th> File
</th>
<td> SPIM_Registration.jar
</td></tr>

<tr>
<th> Initial release
</th>
<td> February 2010
</td></tr>
<tr>
<th> Latest version
</th>
<td> October 2011
</td></tr>

<tr>
<th> Category
</th>
<td> <a href="./Category:Registration" title="Category:Registration">SPIM Registration</a>
</td></tr>
<tr>
<th> Website
</th>
<td> <a rel="nofollow" class="external text" href="http://fly.mpi-cbg.de/~preibisch">Stephan Preibisch's homepage</a>
</td></tr>
</table>
<p><br />
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="SPIM_Bead_Registration.html#Citation"><span class="tocnumber">1</span> <span class="toctext">Citation</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="SPIM_Bead_Registration.html#Introduction"><span class="tocnumber">2</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="SPIM_Bead_Registration.html#Overview_of_the_SPIM_bead-based_registration_plugin"><span class="tocnumber">3</span> <span class="toctext">Overview of the SPIM bead-based registration plugin</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="SPIM_Bead_Registration.html#How_to_use_the_plugin"><span class="tocnumber">4</span> <span class="toctext">How to use the plugin</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="SPIM_Bead_Registration.html#How_timelapse_registration_works"><span class="tocnumber">5</span> <span class="toctext">How timelapse registration works</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="SPIM_Bead_Registration.html#Multichannel_registration"><span class="tocnumber">6</span> <span class="toctext">Multichannel registration</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="SPIM_Bead_Registration.html#How_do_I_..._Problems.2C_known_issues_and_solutions"><span class="tocnumber">7</span> <span class="toctext">How do I ... Problems, known issues and solutions</span></a>
<ul>
<li class="toclevel-2 tocsection-8"><a href="SPIM_Bead_Registration.html#How_to_set_the_min_and_max_intensity_for_each_view"><span class="tocnumber">7.1</span> <span class="toctext">How to set the min and max intensity for each view</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="Citation">Citation</span></h2>
<p>Please note that the SPIM registration plugin available through Fiji, is based on a publication. If you use it successfully for your research please be so kind to cite our work:
</p>
<ul><li> S. Preibisch, S. Saalfeld, J. Schindelin and P. Tomancak (2010) "Software for bead-based registration of selective plane illumination microscopy data", <i>Nature Methods</i>, <b>7</b>(6):418-419. <a rel="nofollow" class="external text" href="http://www.nature.com/nmeth/journal/v7/n6/full/nmeth0610-418.html">Webpage</a> <a href="_images/2/29/Nmeth0610-418.pdf" class="internal" title="Nmeth0610-418.pdf">PDF</a> <a href="_images/3/32/Nmeth0610-418-S1.pdf" class="internal" title="Nmeth0610-418-S1.pdf">Supplement</a></li></ul>
<p>For technical details about the registration method and SPIM imaging see <a href="SPIM_Registration_Method" title="SPIM Registration Method">SPIM Registration Method</a>.
</p>
<h2><span class="mw-headline" id="Introduction">Introduction</span></h2>
<p>Selective Plane Illumination Microscopy (SPIM, <a rel="nofollow" class="external text" href="http://www.sciencemag.org/content/305/5686/1007"><i>Science</i>, <b>305</b>(5686):1007-9</a>) allows <i>in toto</i> imaging of large specimens by acquiring image stacks from multiple angles. We developed an algorithm for registration of multi-angle SPIM acquisitions using fluorescent beads in rigid mounting medium as fiduciary markers. The beads are matched by invariant, local geometric point descriptors and their displacement is minimized for globally optimal, sample-independent registration. The matching is computed very efficiently using a variation of geometric hashing reducing the matching problem to logarithmic complexity; the computation of the registration for a time point on a single computer takes less time than it takes to acquire the images making it suitable for real-time use. The framework can also be applied to register time-points to each other thus providing optimal alignment of time series.
</p><p>The developed bead-based registration framework is able to reconstruct long-term, time-lapse, multi-view acquisitions of developing samples with yet unattainable temporal and spatial resolution allowing new insights into the development of biological specimen.
</p>
<h2><span class="mw-headline" id="Overview_of_the_SPIM_bead-based_registration_plugin">Overview of the SPIM bead-based registration plugin</span></h2>
<p><i><b>Please note:</b></i> <i>the bead-based registration has been rewritten and now replaces the "old" plugin collection (Registration, Advanced Registration, MultiChannel Registration) which has been moved to the deprecated folder. For information regarding these outdated plugins please refer to this <a href="SPIM_Bead_Registration_(deprecated)" title="SPIM Bead Registration (deprecated)">page</a>.</i>
</p><p>The bead-registration plugins offers two registration options:
</p>
<ul><li> Single-channel</li>
<li> Multi-channel (same beads are visible in different channels)</li></ul>
<p>The typical option is single-channel registration, even if you want to process a multi-channel acquisitions. You can apply the registration of one channel later to other channels in the <a href="Multi-View_Fusion" title="Multi-View Fusion">multi-view fusion plugin</a>. Multi-channel registration is only required if the <b>same beads</b> are visible in several channels. 
</p><p>Both options work in the exactly same way and have very similar options. The additional options of multi-channel registration are explained in the last section.
</p><p><i><b>Important note:</b> the output of the plugin are not images, but only registration matrices that serve as basis for either the <a href="Multi-View_Fusion" title="Multi-View Fusion">multi-view fusion plugin</a> or the <a href="index.php?title=Multi-view_deconvolution_plugin&amp;action=edit&amp;redlink=1" class="new" title="Multi-view deconvolution plugin (page does not exist)">multi-view deconvolution plugin</a>. An overview of the complete registration and fusion process can be found <a href="SPIM_Registration" title="SPIM Registration">here</a>.</i>
</p>
<h2><span class="mw-headline" id="How_to_use_the_plugin">How to use the plugin</span></h2>
<div class="thumb tright"><div class="thumbinner" style="width:262px;"><a href="./File:Spim_beads_singlechannel.jpg" class="image"><img alt="" src="_images/c/c6/Spim_beads_singlechannel.jpg" width="260" height="309" class="thumbimage" /></a>  <div class="thumbcaption"><div class="magnify"><a href="./File:Spim_beads_singlechannel.jpg" class="internal" title="Enlarge"></a></div>Shows the dialog for the bead-based registration</div></div></div>
<ul><li> <b>SPIM data directory</b>: Fill in the directory name that contains all the image files (or directories with equally sized 2d image planes). You can either drag&amp;drop the directory, browse for it or type the name directly.</li></ul>
<ul><li> <b>Pattern of SPIM files</b>: Define the naming convention of the input files by explaining how the angle and the timepoint is encoded into the filename. For example the file names are named in following way <br /><i>spim_tl1_angle0.lsm</i>, <i>spim_tl1_angle45.lsm</i> ... <i>spim_tl1_angle270.lsm</i><br /><i>spim_tl2_angle0.lsm</i>, ... <i>spim_tl2_angle270.lsm</i><br /><i>spim_tl100_angle0.lsm</i>, ... <i>spim_tl100_angle270.lsm</i>.<br /> That means the pattern of the file names corresponds to <b>spim_tl{t}_angle{a}.lsm</b>, where <b>{t}</b> is replaced with the current timepoint and <b>{a}</b> with the current angle. If the numbers contain leading zeros (e.g. 000, 045, 090, 135 instead of 0, 45, 90, 135), this can be encoded by simply adding more letters to the placeholder, in this case <b>{aaa}</b>.</li></ul>
<ul><li> <b>Timepoints to process</b>: Define the timepoint(s) that should be processed. You can give single numbers (e.g. 18), enumerate (e.g. 1, 18, 19, 100), define ranges (e.g. 1-18) or combine all of them in any combination wanted (e.g. 1,2,10,20-50).</li></ul>
<ul><li> <b>Angles to process</b>: Define the angles (at least 2) that should be processed (for each timepoint if applicable). You can enumerate angles (e.g. 0, 90, 180, 270), define ranges in steps (e.g. 0-270:45 which means use angle 0 to 270 in steps of 45, i.e. 0, 45, 90, 135, 180, 225, 270) or combine all of them in any combination wanted (e.g. 0, 45, 180-270:45).</li></ul>
<ul><li> <b>Re-use segmented beads</b>: If beads of all input stacks have been segmented in a previous run, they can be loaded here.</li></ul>
<ul><li> <b>Bead brightness</b>: If the beads are not loaded, define their approximate brightness, you have the following options:
<ul><li> <i>Very weak</i>: the beads are hardly or not visible relative to the intensity of the imaged specimen</li>
<li> <i>Weak</i>: the beads are visible, but not as bright as the sample</li>
<li> <i>Comparable to sample</i>: the beads are as bright or slightly brighter than the sample</li>
<li> <i>Strong</i>: the beads are significantly brighter than the sample (you should consider using differently colored beads)</li>
<li> <i>Advanced...</i>: you know the parameters for the difference-of-gaussian detector, most likely from a previous run of the interactive tool. Note that a new window will pop up to query the parameters</li>
<li> <i>Interactive...</i>: an interactive tool will allow you to set the approximate parameters for your dataset</li></ul></li></ul>
<ul><li> <b>Override file dimensions</b>: If you know the calibration of your dataset you can enter it here and prevent the plugin from opening the file to determine the calibration that is stored (and which might be incorrect)</li></ul>
<ul><li> <b>Transformation model</b>: Choose the transformation model that will be used to align the datasets to each other, you have three choices:
<ul><li> <i>Translation</i>: correct for three-dimensional shift</li>
<li> <i>Rigid</i>: correct for three-dimensional shift and rotation, this option will additionally output an estimate of the rotation axis and rotation angle for each view</li>
<li> <i>Affine</i>: correct for three-dimensional shift, rotation, shearing and anisotropic scaling, this transformation model best describes the degrees of freedom of SPIM registration</li></ul></li></ul>
<ul><li> <b>Re-use per timepoint registration</b>: Loads the registration for each individual timepoint. This is basically only interesting if you perform a timelapse registration (see below).</li></ul>
<ul><li> <b>Timelapse registration</b>: Checked if a timelapse registration should be performed. In this case the <b>pre-registered</b> individual timepoints are re-registered to one reference timepoint, which results in an aligned time series.</li></ul>
<ul><li> <b>Select reference timepoint</b>: The reference timepoint can either be selected automatically based on the quality of the individual timepoint registrations or you can choose it yourself (see section timelapse registration).</li></ul>
<h2><span class="mw-headline" id="How_timelapse_registration_works">How timelapse registration works</span></h2>
<div class="thumb tright"><div class="thumbinner" style="width:452px;"><a href="./File:Spim_beads_timelapse.jpg" class="image"><img alt="" src="_images/4/47/Spim_beads_timelapse.jpg" width="450" height="225" class="thumbimage" /></a>  <div class="thumbcaption"><div class="magnify"><a href="./File:Spim_beads_timelapse.jpg" class="internal" title="Enlarge"></a></div>Shows the panel that displays the registration quality of an entire timelapse registration. The reference timepoint can be chosen manually by clicking or automatically by the plugin. The error should be as low as possible (around 1px), the correspondence ratio as high as possible (between 90-100%).</div></div></div>
<p>Processing a timelapse acquisition works in two steps. In the first step the registration for each individual timepoint will be computed and automatically stored. Based on these results, a reference timepoint will be selected either manually or automatically (see figure). Note that the panel will be also displayed when choosing automatic reference timepoint selection, but it cannot be changed. Based on the selected timepoint, all other timepoints of the series will be registered relative to it which leads to a properly aligned timeseries. 
</p><p>For fusing the data, the cropping area has to be defined in the reference timepoint. Therefore, the reference timepoint should be fused individually once, and afterwards the whole timeseries can be fused.
</p>
<h2><span class="mw-headline" id="Multichannel_registration">Multichannel registration</span></h2>
<p>The multi-channel registration will offer another field in which the channels that contain the same beads can be selected. In the file name pattern channels are coded as {c}, just as timepoints or angles. In the field <b>Channels containing beads</b> you can define the channels to process. You can give single numbers (e.g. 0), enumerate (e.g. 1, 2), define ranges (e.g. 1-3) or combine all of them in any combination wanted (e.g. 1,3-4). The bead brightness for each individual channel will be queried in individual dialogs afterwards.
</p>
<h2><span class="mw-headline" id="How_do_I_..._Problems.2C_known_issues_and_solutions">How do I ... Problems, known issues and solutions</span></h2>
<p>Some tips and tricks in the next few paragraphs require to change a static variable in the source code that changes the behavior of the plugin. This is done using the <b>script editor</b> and works as follows:
</p>
<ul><li> <span><em><span style="border-bottom:1px dotted #ccc;"> File </span>&#160;&#8250; <span style="border-bottom:1px dotted #ccc;"> New </span>&#160;&#8250; <span style="border-bottom:1px dotted #ccc;"> Script</span></em></span></li>
<li> <span><em><span style="border-bottom:1px dotted #ccc;"> Language </span>&#160;&#8250; <span style="border-bottom:1px dotted #ccc;"> Beanshell</span></em></span></li>
<li> type the command, e.g.</li></ul>
<pre class="brush:java">
System.gc();
</pre>
<ul><li> click Run</li></ul>
<p>This just cleans up the RAM, which might be useful. Note that changes that are made (not in this case though) are only valid for the <b>currently running Fiji instance</b>.
</p>
<h3><span class="mw-headline" id="How_to_set_the_min_and_max_intensity_for_each_view">How to set the min and max intensity for each view</span></h3>
<p>The min and max intensity for each view is determined by looking through all the pixels of the stack and finding the lowest and highest intensity. All intensities are then normalized to [0...1] depending on those intensities. If there is a huge difference between different views (maybe because of a piece of dirt only visible in some views), it can be set manually.
</p>
<pre class="brush:java">
mpicbg.spim.registration.ViewDataBeads.minmaxset = new float[]{ 0, 65535 };
</pre>
<p>This command sets the min and max of all views to 0 and 65535.
</p>
<!-- 
NewPP limit report
Cached time: 20200713073259
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.048 seconds
Real time usage: 0.048 seconds
Preprocessor visited node count: 236/1000000
Preprocessor generated node count: 1201/1000000
Post‐expand include size: 1844/2097152 bytes
Template argument size: 618/2097152 bytes
Highest expansion depth: 6/40
Expensive parser function count: 0/3
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%    9.097      1 - -total
 53.22%    4.841      2 - Template:Bc
 43.46%    3.954      1 - Template:Infobox
 16.85%    1.533      3 - Template:Arrow
-->
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="index.php?title=SPIM_Bead_Registration&amp;oldid=17137">http://imagej.net/index.php?title=SPIM_Bead_Registration&amp;oldid=17137</a>"</div>
							</div>

			<div id="footer">
				<p> This page was last modified on 22 September 2015, at 21:53.</p><ul><li><a href="./ImageJ:Privacy_policy" title="ImageJ:Privacy policy">Privacy policy</a></li><li><a href="./ImageJ:About" class="mw-redirect" title="ImageJ:About">About ImageJ</a></li><li><a href="Imprint" title="Imprint">Imprint</a></li></ul>			</div>

			<div id="catlinks" class="catlinks catlinks-allhidden" data-mw="interface"></div>		</div>

		<div id="bottom-wrap">
			<div id="footer-wrap-inner">
				<div id="ternary" class="footer">
					<ul>
						<li class="widget">
							<img id="logo" src="skins/imagej-128.png" alt="">
						</li>
					</ul>
				</div>
			</div>
		</div>
		<script>(window.RLQ=window.RLQ||[]).push(function(){mw.loader.load(["ext.fancytree","ext.suckerfish","mediawiki.toc","mediawiki.action.view.postEdit","site","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest","ext.SimpleTooltip"]);});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":286});});</script>
		</body>
		</html>
		