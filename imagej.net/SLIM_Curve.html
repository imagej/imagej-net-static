<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8"/>
<title>SLIM Curve - ImageJ</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"SLIM_Curve","wgTitle":"SLIM Curve","wgCurRevisionId":41321,"wgRevisionId":41321,"wgArticleId":2119,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Plugins"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"SLIM_Curve","wgRelevantArticleId":2119,"wgRequestId":"0cee7ac297afb921eee57811","wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgPreferredVariant":"en","fancytree_path":"/extensions/TreeAndMenu/fancytree"});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user.cssprefs":"ready","user":"ready","user.options":"loading","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","skins.erudite":"ready"});mw.loader.implement("user.options@0j3lz3q",function($,jQuery,require,module){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens@1ku9xth",function ( $, jQuery, require, module ) {
mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});/*@nomin*/;

});mw.loader.load(["mediawiki.page.startup"]);});</script>
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%252Cshared%257Cmediawiki.sectionAnchor%257Cskins.erudite&amp;only=styles&amp;skin=erudite.css"/>
<script async="" src="load.php%3Fdebug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=erudite"></script>
<link rel="stylesheet" href="extensions/TreeAndMenu/fancytree/fancytree.css"/><link rel="stylesheet" href="extensions/TreeAndMenu/suckerfish/suckerfish.css"/>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=erudite.css"/>
<meta name="generator" content="MediaWiki 1.28.0"/>
<meta name="description" content="SLIM Curve is an exponential curve fitting library used for Fluorescent Lifetime Imaging (FLIM) and Spectral Lifetime Imaging (SLIM). It is developed by Paul Barber and the Advanced Technology Group at the Cancer Research UK and Medical Research Council Oxford Institute for Radiation Oncology, as well as the Laboratory for Optical and Computational Instrumentation at the University of Wisconsin-Madison. SLIM Curve is used for FLIM functionality in the Advanced Technology Group's Time Resolved Imaging (TRI2) software, as well as in the SLIM Curve plugin for ImageJ."/>
<link rel="shortcut icon" href="skins/ij2.ico"/>

<script type="text/javascript" src="extensions/SyntaxHighlighter/syntaxhighlighter/scripts/shCore.js"></script>
<script type="text/javascript" src="extensions/SyntaxHighlighter/syntaxhighlighter/scripts/shBrushJava.js"></script>
<script type="text/javascript">
SyntaxHighlighter.all();
</script>
<link rel="stylesheet" type="text/css" media="screen" href="extensions/SyntaxHighlighter/syntaxhighlighter/styles/shCoreMinit.css" />

	<meta property="og:type" content="article"/>

	<meta property="og:site_name" content="ImageJ"/>

	<meta property="og:title" content="SLIM Curve"/>

	<meta property="og:description" content="SLIM Curve is an exponential curve fitting library used for Fluorescent Lifetime Imaging (FLIM) and Spectral Lifetime Imaging (SLIM). It is developed by Paul Barber and the Advanced Technology Group at the Cancer Research UK and Medical Research Council Oxford Institute for Radiation Oncology, as well as the Laboratory for Optical and Computational Instrumentation at the University of Wisconsin-Madison. SLIM Curve is used for FLIM functionality in the Advanced Technology Group's Time Resolved Imaging (TRI2) software, as well as in the SLIM Curve plugin for ImageJ."/>


<meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-SLIM_Curve rootpage-SLIM_Curve skin-erudite action-view">
		<div class="mw-jump">
			<a href="SLIM_Curve.html#bodyContent">Skip to content</a>, 			<a href="SLIM_Curve.html#search">Skip to search</a>
		</div>

		<div id="top-wrap" role="banner">
			<h1><a href="Welcome" title="ImageJ" rel="home">ImageJ</a></h1>
			<div id="tagline">From ImageJ</div>

			<a id="menubutton" href="SLIM_Curve.html#menu">Menu</a>
			<div id="nav" role="navigation">
			<ul id='menu'>
<li id="menu-item-n-About"><a href="ImageJ">About</a></li>
<li id="menu-item-n-Downloads"><a href="Downloads">Downloads</a></li>
<li id="menu-item-n-Learn"><a href="Learn">Learn</a></li>
<li id="menu-item-n-Develop"><a href="Development">Develop</a></li>
<li id="menu-item-n-News"><a href="News">News</a></li>
<li id="menu-item-n-Events"><a href="Events">Events</a></li>
<li id="menu-item-n-Help"><a href="Help">Help</a></li>
</ul>
			</div>
		</div>

		<div id="mw-js-message"></div>
		
		<div id="main" role="main">

			<div id="bodyContent">
				<h1>SLIM Curve</h1>
				
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div style="overflow:hidden"><table class="metadata plainlinks ambox ambox-content">
<tr>
<td class="ambox-image">
<p><a href="./File:Important-sign.png" class="image"><img alt="Important-sign.png" src="_images/f/f0/Important-sign.png" width="40" height="40" /></a>
</p>
</td>
<td> The SLIM Curve plugin for ImageJ has been discontinued in favor of <a href="FLIMJ" title="FLIMJ">FLIMJ</a>. </td>
<p><br />
</p>
</tr>
</table></div>
<p><br />
</p>
<table class="infobox" cellspacing="5" style="max-width: 31em; font-size: 90%; text-align: left; float: right; border: 1px solid #a0a0a0;">
<tr>
<th colspan="2" style="text-align: center; font-size: 130%;"> <div style="float: left"><div class="MediaTransformError" style="width: 64px; height: 0px; display:inline-block;">Error creating thumbnail: Unable to save thumbnail to destination</div></div>SLIM Curve plugin (ImageJ)<div style="clear: left;"></div>
</th></tr>
<tr>
<th> Author
</th>
<td> <a rel="nofollow" class="external text" href="http://www.rob.ox.ac.uk/">CRUK/MRC at University of Oxford</a><br /><a rel="nofollow" class="external text" href="http://loci.wisc.edu/">UW-Madison LOCI</a>
</td></tr>




<tr>
<th> Maintainer
</th>
<td> <a href="./User:Rueden" title="User:Rueden">Curtis Rueden</a>
</td></tr>

<tr>
<th> File
</th>
<td> slim_plugin-2.0.0-SNAPSHOT.jar
</td></tr>
<tr>
<th> Source
</th>
<td> <a rel="nofollow" class="external text" href="https://github.com/slim-curve/slim-plugin/">on GitHub</a>
</td></tr>

<tr>
<th> Latest version
</th>
<td> 2.0.0-SNAPSHOT
</td></tr>
<tr>
<th> Development status
</th>
<td> discontinued in favor of <a href="FLIMJ" title="FLIMJ">FLIMJ</a>
</td></tr>
<tr>
<th> Category
</th>
<td> <a href="./Category:Analysis" title="Category:Analysis">Category:Analysis</a>
</td></tr>
<tr>
<th> Website
</th>
<td> <a rel="nofollow" class="external free" href="https://slim-curve.github.io/">https://slim-curve.github.io/</a>
</td></tr>
</table>
<p><br />
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="SLIM_Curve.html#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="SLIM_Curve.html#Installation"><span class="tocnumber">2</span> <span class="toctext">Installation</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="SLIM_Curve.html#Usage"><span class="tocnumber">3</span> <span class="toctext">Usage</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="SLIM_Curve.html#Save.2FLoad_default_excitation"><span class="tocnumber">3.1</span> <span class="toctext">Save/Load default excitation</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="SLIM_Curve.html#Macro_language_support"><span class="tocnumber">3.2</span> <span class="toctext">Macro language support</span></a>
<ul>
<li class="toclevel-3 tocsection-6"><a href="SLIM_Curve.html#Complete_Macro_Example"><span class="tocnumber">3.2.1</span> <span class="toctext">Complete Macro Example</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-7"><a href="SLIM_Curve.html#Batch_mode"><span class="tocnumber">3.3</span> <span class="toctext">Batch mode</span></a>
<ul>
<li class="toclevel-3 tocsection-8"><a href="SLIM_Curve.html#Example_macro"><span class="tocnumber">3.3.1</span> <span class="toctext">Example macro</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-9"><a href="SLIM_Curve.html#Segmentation_using_classification"><span class="tocnumber">3.4</span> <span class="toctext">Segmentation using classification</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="SLIM_Curve.html#Result_comparison"><span class="tocnumber">3.5</span> <span class="toctext">Result comparison</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-11"><a href="SLIM_Curve.html#Getting_help"><span class="tocnumber">4</span> <span class="toctext">Getting help</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Introduction">Introduction</span></h2>
<div class="floatright"><a href="./File:SLIM-screenshot.png" class="image"><img alt="SLIM-screenshot.png" src="_images/0/02/SLIM-screenshot.png" width="357" height="326" /></a></div>
<p><a rel="nofollow" class="external text" href="https://slim-curve.github.io/">SLIM Curve</a> is an exponential curve fitting library used for Fluorescent Lifetime Imaging (FLIM) and Spectral Lifetime Imaging (SLIM). It is developed by Paul Barber and the Advanced Technology Group at the <a rel="nofollow" class="external text" href="http://www.rob.ox.ac.uk/">Cancer Research UK and Medical Research Council Oxford Institute for Radiation Oncology</a>, as well as the <a rel="nofollow" class="external text" href="http://loci.wisc.edu/">Laboratory for Optical and Computational Instrumentation</a> at the University of Wisconsin-Madison. SLIM Curve is used for FLIM functionality in the Advanced Technology Group's <a rel="nofollow" class="external text" href="https://www.assembla.com/spaces/ATD_TRI/wiki">Time Resolved Imaging</a> (TRI2) software, as well as in the SLIM Curve plugin for ImageJ.
</p><p>There are two algorithms used for curve fitting within SLIM Curve:
</p>
<ol><li> The first is a triple integral method that does a very fast estimate of a single exponential lifetime component.</li>
<li> The second is a Levenberg-Marquardt algorithm or LMA that uses an iterative, least-squares-minimization approach to generate a fit. This works with single, double and triple exponential models, as well as stretched exponential.</li></ol>
<p>The SLIM Curve library code is written in C89 compatible C and is thread-safe for fitting multiple pixels concurrently. Several files are provided as wrappers to call the library from Java code: <i>EcfWrapper.c</i> and <i>.h</i> provide a subset of function calls used by the SLIM Curve plugin for ImageJ, these may be invoked directly from Java using JNA. In addition there is a Java CurveFitter project that provides a wrapper to the SLIM Curve code. This invokes the C code using JNI, with loci_curvefitter_<i>SLIMCurveFitter.c</i> and <i>.h</i>.
</p>
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p>The SLIM Curve plugin is available from the "SLIM Curve" <a href="Update_site" class="mw-redirect" title="Update site">update site</a>.
</p><p>Once you have installed the SLIM Curve plugin it becomes available on the menu under <span><em><span style="border-bottom:1px dotted #ccc;"> Analyze </span>&#160;&#8250; <span style="border-bottom:1px dotted #ccc;"> Lifetime </span>&#160;&#8250; <span style="border-bottom:1px dotted #ccc;"> SLIM Curve</span></em></span>.
</p>
<h2><span class="mw-headline" id="Usage">Usage</span></h2>
<p>When you run the plugin you will first be prompted to load a lifetime data file. (This should have a .sdt or .ics suffix.) Once the file loads a grayscale version of the lifetime image pops up, produced by summing the photon counts for all time bins for each pixel:
</p>
<div class="MediaTransformError" style="width: 343px; height: 0px; display:inline-block;">Error creating thumbnail: Unable to save thumbnail to destination</div>
<p>Here the red color signifies pixels that have a low photon count and will be excluded from any fitted images that are produced. The threshold value for this is adjustable in the user interface. When fitted images are created, yellow pixels signify fitting errors. During analysis of fitted images, blue pixels indicate outliers.
</p><p>The crosshair cursor shows the current fitted pixel. This starts out as the brightest pixel in the image. Clicking around the grayscale image fits other pixels.
</p><p>The fitted decay graph pops up showing the results of the pixel fit:
</p>
<div class="MediaTransformError" style="width: 510px; height: 0px; display:inline-block;">Error creating thumbnail: Unable to save thumbnail to destination</div>
<p>Here the graph shows black squares for the observed photon counts over time and a red line for the fitted curve. There are also vertical blue, green, and red lines or cursors that mark the region of the decay being fitted. Below the decay graph is a graph showing the Residuals, the difference between the observed and fitted values. For a good fit the residuals should have a low value range and exhibit a random pattern.
</p><p>The user interface panel also pops up, allowing you to control the settings of the fit. On the initial tab of the user interface panel entitled <i>Fit</i> you can choose what kind of fit and analysis you want to perform:
</p>
<div class="MediaTransformError" style="width: 397px; height: 0px; display:inline-block;">Error creating thumbnail: Unable to save thumbnail to destination</div>
<ul><li> <i>Region</i> allows you to fit the entire image, a single pixel, the sum of all pixels, or the sum of each ROI defined on the grayscale image.</li>
<li> <i>Algorithm</i> selects the fit algorithm.  <i>SLIMCurve RLD+LMA</i> is recommended.  This uses a rapid lifetime determination (also known as a triple integral fit) to quickly estimate the fitted parameters.  Then a Levenberg-Marquardt least-squares fit is done to refine those estimates.</li>
<li> <i>Function</i> lets you choose between single, double, and triple exponential fitted components.  The stretched exponential fit can be used to characterize the distribution of multiple exponential lifetime components.</li>
<li> <i>Noise Model</i> compensates for the noise in the fitted data.  The recommendation here is to use the <i>Maximum Likelihood Estimation</i> noise model.  This compensates for low photon counts.</li>
<li> <i>Fitted Images</i> selects what output images are produced when you fit the entire image.  These output images are colorized using a special lifetime LUT (lookup table or palette).  You may select <i>A</i> the intensity, <i>Tau</i> the lifetime, <i>Z</i> the background, and/or the <i>ChiSquare</i> for each pixel of the fit.  When you are fitting multiple exponential components you may also select <i>f</i> the fractional contribution and <i>F</i> the fractional intensity, as well as <i>Tm</i> the mean of the fitted taus.  For stretched exponential fits you may select <i>H</i> which characterizes the distribution of the multiple lifetimes.</li>
<li> <i>Colorize grayscale</i> is an option to combine the LUT colors indicating the parameter values for each pixel with the grayscale image.</li>
<li> <i>Analysis</i> lets you optionally specify further analysis of the fitted results:  <i>Export to Text</i> produces a text file of the fitted values.  <i>VisAD</i> sends the fitted data to a VisAD plugin for further analysis.  <i>Display Fit Results</i> produces a single image containing all the output images.</li>
<li> The <i>Fit all channels</i> checkbox selects whether to fit all channels or just the current channel when the source image has multiple channels.</li></ul>
<p>The next tab is entitled <i>Cursors</i>:
</p>
<div class="MediaTransformError" style="width: 396px; height: 0px; display:inline-block;">Error creating thumbnail: Unable to save thumbnail to destination</div>
<p>Here the positions of the fit cursors are listed. There are two kinds of cursors:
</p><p>The transient cursors bracket which region of the decay to fit. <i>Transient Start</i> corresponds to the blue vertical line at the left of the <i>Fitted Decay Graph</i>. <i>Data Start</i> is the green line in the middle. <i>Transient End</i> is the red line at the right. Dragging these cursor lines on the <i>Fitted Decay Graph</i> will also change the values on the <i>Cursors</i> tab of the UI and cause a refit of the current pixel.
</p><p>The excitation cursors bracket which region of the excitation or instrument response function decay to use in the fit. If an excitation is loaded the decay is shown in an Instrument Response Function graph with cursor lines similar to the <i>Fitted Decay Graph:</i>
</p>
<div class="MediaTransformError" style="width: 524px; height: 0px; display:inline-block;">Error creating thumbnail: Unable to save thumbnail to destination</div>
<p>The horizontal green line controls the <i>Excitation Baseline</i>, the minimum photon count to be included in the excitation. The vertical blue and green cursor lines define the start and end of the excitation. The <i>Excitation Delay</i> is the offset between the <i>Transient Start</i> and the start of the excitation. <i>Excitation Width</i> is the end of the excitation minus the start.
</p><p>The cursor values are represented as time values (except for <i>Excitation Baseline</i> which is a photon count) for compatibility with TRI2, but the checkbox lets you see the corresponding exact indices into the decay histogram.
</p><p>The <i>Estimate Cursors</i> button resets the cursors, estimated for the current pixel transient and excitation. They can also be tweaked by dragging the cursors or entering new values. If the tweaking doesn't optimize the fit you can return to the original settings with the <i>Estimate Cursors</i> button. If you load a new image none of the settings change, so you may want to use <i>Estimate Cursors</i> to find cursors more appropriate for the new image.
</p><p>The <i>Excitation</i> dropdown is used to create, load, or cancel an excitation. Using an excitation is optional but makes for a better fit. Typically the experimenter will create a separate excitation image with the same setup but only imaging some non-fluorescent material such as beads.
</p><p>To create an excitation is currently a two step process. Run SLIM Curve with the excitation lifetime image, then find a suitable pixel to use, perhaps the default, brightest one. From this tab of the UI under <i>Excitation</i> select <i>Use Current X Y</i>. The program will prompt for a name and place to save the excitation file. For the second step use the <i>New Image/Batch</i> button to load the lifetime image you want to analyze. Now select <i>Load from File</i> in the Excitation dropdown and enter the file name you saved. When an excitation is loaded the cursors are estimated.
</p><p>If an excitation is loaded it is also shown on the fitted decay graph in light gray:
</p>
<div class="MediaTransformError" style="width: 455px; height: 0px; display:inline-block;">Error creating thumbnail: Unable to save thumbnail to destination</div>
<p>In the next tab of the UI panel titled <i>Control</i> you can fine tune some aspects of the fit:
</p>
<div class="MediaTransformError" style="width: 398px; height: 0px; display:inline-block;">Error creating thumbnail: Unable to save thumbnail to destination</div>
<ul><li> <i>X</i> and <i>Y</i> specify the location of the last single fitted pixel.  (You can fit a single pixel by setting Region to Single Pixel and clicking the Fit Pixel button or by just clicking on the grayscale image.)</li>
<li> <i>Start</i> and <i>Stop</i> select the starting and ending time bins to be fitted.</li>
<li> <i>Threshold</i> determines the minimum number of photons in the decay curve for a given pixel that are needed in order to fit that pixel.</li>
<li> <i>ChiSquare target</i> controls the value of chi square at which the iterative LMA fitting process will stop.  (Fitting also stops after a maximum number of iterations.)</li>
<li> <i>Bin</i> can compensate for lower photon counts at the expense of some spatial resolution by binning the photons from adjacent pixels.</li></ul>
<p>The final tab of the user interface panel is a section entitled <i>Parameters</i> which displays and lets you constrain the fitted parameters. The actual contents of this subpanel will depend upon the Function selected.
</p>
<div class="MediaTransformError" style="width: 397px; height: 0px; display:inline-block;">Error creating thumbnail: Unable to save thumbnail to destination</div>
<p>For each parameter:
</p>
<ul><li> A label, such as <i>A1</i> or <i>Tau2</i> identifies the parameter.</li>
<li> A textfield shows the current value of that parameter.</li>
<li> A checkbox labelled <i>Fix</i> lets you fix the value of that parameter during the fit.</li>
<li> Both the <i>reduced chisquare</i> and the <i>AIC</i> are measures of the goodness of fit.  <i>AIC</i> stands for the Akaike Information Criterion.  Unlike <i>chisquare</i> <i>AIC</i> has no absolute meaning, but can be used to compare single, double, and triple exponential fits to determine which model has the best fit.</li></ul>
<p>After fitting a single pixel or all of the pixels summed the fitted parameters can be viewed in this user interface panel <i>Params</i> section.
</p><p>SLIM Curve starts up with the <i>Region</i> under the <i>Fit</i> tab of the UI set to Image. Pressing the <i>Fit Image</i> button will cause the images selected in the <i>Fitted Images</i> drop down menu item to be generated. The list of images in the <i>Fitted Images</i> drop down menu varies with the fitting <i>Function</i> selected, i.e. single or multiple exponential. It includes combinations of the fitted params that show up in the <i>Params</i> tab of the UI, as well as fractional contribution, fractional intensity, and tau mean for multi-exponential fits.
</p><p>When a fitted image is created a histogram tool panel also pops up. This panel shows the range of values encountered in the fitted image and the LUT used to display those values, as well as a histogram of the distribution of those values in the image.
</p>
<div class="MediaTransformError" style="width: 554px; height: 0px; display:inline-block;">Error creating thumbnail: Unable to save thumbnail to destination</div>
<p>By default the histogram tool comes up in automatic mode, the start and end of the LUT range automatically adjust to the minimum and maximum values in the image, so you can see the distribution all of the fitted values. Here the dashed gray lines indicate the quartiles of the distribution. If you uncheck this <i>Adjust range to min/max values</i> checkbox the histogram will zoom in based on the quartile range. (This uses Tukey's Outlier Rule: If Q1 is the first quartile value and Q3 the third, let the interquartile range IQR equal Q3 - Q1. Then values less than Q1 - 1.5 * IQR or greater than Q3 + 1.5 * IQR are considered outliers and are discarded.) You can also either enter new start and end values (this is useful to impose a uniform LUT range so you can compare different lifetime images) or just drag markers at the start and end of the histogram.
</p><p>Outlier pixels will display as black pixels. If you put the cursor over them in the fitted image the fitted value will show up in the ImageJ toolbar. The <i>Hide pixels outside range</i> checkbox discards these outliers, they are excluded from all fitted images and histograms, they display as black, and the fitted value becomes Double.NaN. This special value is excluded from any subsequent statistical measurements on the fitted image. They also show up on the grayscale image in blue.
</p><p>For images that have more than one channel, there will also be a checkbox to <i>Display all channels</i>. When you display all channels the histogram displays values for all channels combined. Lastly the <i>Logarithmic</i> checkbox shows the histogram graph as logarithmic values. Note that this histogram tool is enhanced to always show at least a one pixel bar graph in non-logarithmic mode if the value is non-zero so that outliers can be seen. Similarly in logarithmic mode it shows a proportionate bar graph if the histogram bin count is one so that bin counts of 1 and 0 can be distinguished.
</p>
<h3><span class="mw-headline" id="Save.2FLoad_default_excitation">Save/Load default excitation</span></h3>
<div class="thumb tright"><div class="thumbinner" style="width:295px;"><div class="MediaTransformError" style="width: 293px; height: 0px; display:inline-block;">Error creating thumbnail: Unable to save thumbnail to destination</div>  <div class="thumbcaption"><div class="magnify"><a href="./File:Excitation.png" class="internal" title="Enlarge"></a></div>Controlling the default excitation</div></div></div>
<p>As loading/saving  excitation file is something user need to do every time, the process has been simplified. Whatever macro user wants to set as default excitation, user should load the sdt file normally, set transient start/end time and save the file as *irf file. Then from the drop down user should select "Set as default". This way, the excitation with the transient start/end  time is saved as default excitation. Later, when needed to load the default excitation, selecting "Use default excitation" will load the default one.
</p>
<h3><span class="mw-headline" id="Macro_language_support">Macro language support</span></h3>
<p>All the operations in SLIM Plugin operation are completely compatible with the popular <a rel="nofollow" class="external text" href="developer/macro/macros.html">ImageJ macro language</a>. Each of the button, selection, choice of algorithm, binning, noise model, default excitation selection with custom start-end time is completely macro record-able. Below is a typical macro recording for a typical usage where the user sets the algorithm, noise model, changes transient time, loads default excitation, sets the chi2 target, fixes A value for fitting and then starts fitting. 
</p>
<div class="thumb tright"><div class="thumbinner" style="width:502px;"><a href="./File:Screenshot_slim_final.png" class="image"><img alt="" src="_images/2/21/Screenshot_slim_final.png" width="500" height="410" class="thumbimage" /></a>  <div class="thumbcaption"><div class="magnify"><a href="./File:Screenshot_slim_final.png" class="internal" title="Enlarge"></a></div>Example of macro recording SLIM Curve</div></div></div>
<p>The list of command are as follows
</p>
<ul><li> Start the plugin with a lifetime(*.sdt or *.ics) file:</li></ul>
<pre class="brush:java"> 
call("loci.slim.SLIMProcessor.startSLIMCurve", "true", "/Users/msagar/Downloads/", "/4t1_740_60xW_zoom4_256_1mg_1_140218_copy.sdt");
run("SLIM Curve");
</pre>
<ul><li> Change the algorithm:</li></ul>
<pre class="brush:java"> 
call("loci.slim.SLIMProcessor.setAlgorithmType", "SLIMCurve RLD");
</pre>
<ul><li> Set number of components of exponents:</li></ul>
<pre class="brush:java"> 
call("loci.slim.SLIMProcessor.setFunctionType", "Double Exponential");
</pre>
<ul><li> Change noise model:</li></ul>
<pre class="brush:java"> 
call("loci.slim.SLIMProcessor.setNoiseModel", "Poisson Data");
</pre>
<ul><li> change which parameters for fitting:</li></ul>
<pre class="brush:java"> 
call("loci.slim.SLIMProcessor.setFittedImagesType", "3");
</pre>
<ul><li> Set transient start time:</li></ul>
<pre class="brush:java"> 
call("loci.slim.SLIMProcessor.setTransientStart", "2.0");
</pre>
<ul><li> Set the binning</li></ul>
<pre class="brush:java"> 
call("loci.slim.SLIMProcessor.setBinnning", "3 x 3");
</pre>
<ul><li> Load default excitation:</li></ul>
<pre class="brush:java"> 
call("loci.slim.SLIMProcessor.loadDefaultExcitation", "true");
</pre>
<ul><li> Load default excitation:</li></ul>
<pre class="brush:java"> 
call("loci.slim.SLIMProcessor.loadDefaultExcitation", "true");
</pre>
<ul><li> Set the chi2 target value:</li></ul>
<pre class="brush:java"> 
call("loci.slim.SLIMProcessor.setChi2Target", "1.75");
</pre>
<ul><li> Fix the A value(All "fix" are recordable):</li></ul>
<pre class="brush:java"> 
call("loci.slim.SLIMProcessor.fixA1", "true");
</pre>
<p><br />
</p>
<ul><li> Start fitting</li></ul>
<pre class="brush:java"> 
call("loci.slim.SLIMProcessor.startFitting", "");
</pre>
<p><br />
</p>
<ul><li> Loading an existing excitation file</li></ul>
<pre class="brush:java"> 
call("loci.slim.SLIMProcessor.setExcitation", "/Users/msagar/Documents/qwe.irf");
</pre>
<p><br />
</p>
<ul><li> Set to double exponential(no of component =2)</li></ul>
<pre class="brush:java"> 
call("loci.slim.SLIMProcessor.setFunctionType", "Double Exponential");
</pre>
<ul><li> Fix Z for double exponential fitting </li></ul>
<pre class="brush:java"> 
call("loci.slim.SLIMProcessor.fixZ", "true");
</pre>
<p><br />
</p><p>For batch processing, the whole operation can be recorded. Macro record the name of the files needed for exporting the values. A typical batch processing macro code looks like following
</p>
<ul><li> Start fitting</li></ul>
<pre class="brush:java"> 
call("loci.slim.SLIMProcessor.batchModeSet", "true");
call("loci.slim.SLIMProcessor.exportFileSet", "pixel.tsv", "histograms.tsv", "summary.tsv");
call("loci.slim.SLIMProcessor.startBatchMacro", ""); 
</pre>
<p>When "Export Histogram to Text" or/and "Export Pixels to Text" is selected for exporting the output to a CSV or TSV file that is also recorded in macro. A typical code looks like this 
</p>
<pre class="brush:java"> 
call("loci.slim.SLIMProcessor.exportHistoFileName", "histoGram.csv", ",");
call("loci.slim.SLIMProcessor.exportPixelFileName", "pixel.csv", ",");
call("loci.slim.SLIMProcessor.setAnalysisList", "true", "2"); 
</pre>
<h4><span class="mw-headline" id="Complete_Macro_Example">Complete Macro Example</span></h4>
<p>Complete macro example with exporting histograms and pixel information to CSV file
</p>
<pre class="brush:java"> 
call("loci.slim.SLIMProcessor.startSLIMCurve", "true", "/Users/msagar/Downloads/", "/4t1_740_60xW_zoom4_256_1mg_1_140218_copy.sdt");
run("SLIM Curve");
call("loci.slim.SLIMProcessor.setFunctionType", "Double Exponential");
call("loci.slim.SLIMProcessor.loadDefaultExcitation", "true");
wait(1000);
call("loci.slim.SLIMProcessor.setWidthPrompt", "1.8359");
call("loci.slim.SLIMProcessor.setWidthPrompt", "4.8533");
call("loci.slim.SLIMProcessor.setDelayPrompt", "-0.3791");
call("loci.slim.SLIMProcessor.setBinnning", "3 x 3");
call("loci.slim.SLIMProcessor.fixZ", "true");
wait(1000);
call("loci.slim.SLIMProcessor.startFitting", "");
call("loci.slim.SLIMProcessor.exportHistoFileName", "histogram1.csv", ",");
call("loci.slim.SLIMProcessor.exportPixelFileName", "pixel1.csv", ",");
call("loci.slim.SLIMProcessor.setAnalysisList", "true", "2");
</pre>
<h3><span class="mw-headline" id="Batch_mode">Batch mode</span></h3>
<p>Once you are satisfied with the fitting settings for a source image you can use those same settings on a series of similar images. All images should have the same number of time bins. To get into batch mode merely click on the <i>New File/Batch</i> button and select a folder or a selection of images. The batch mode UI will pop up:
</p>
<div class="MediaTransformError" style="width: 296px; height: 0px; display:inline-block;">Error creating thumbnail: Unable to save thumbnail to destination</div>
<p>You can export the pixel values, histogram values and statistics, and summary histogram values and statistics to a text file. This can be the same file or separate files. The default is tab separated values but the checkbox allows comma separated values.
</p><p>Once the batch processing starts a window will pop up showing the histogram and statistics for each lifetime file, as well as a summary histogram and statistics:
</p>
<div class="MediaTransformError" style="width: 315px; height: 0px; display:inline-block;">Error creating thumbnail: Unable to save thumbnail to destination</div>
<p>Each source lifetime image has a row of histograms for each of the parameters in the <i>Fitted Images</i> dropdown of the <i>Fit</i> tab of the UI. Clicking on the row loads the source image into the plugin.
</p><p>Note that you can't start out in batch mode, you need to fit a single image first and make sure the fitting settings are appropriate.
</p>
<h4><span class="mw-headline" id="Example_macro">Example macro</span></h4>
<pre class="brush:java">
dir = getDirectory("Choose Source Directory ");
Dialog.create("Batch Processing");
Dialog.addCheckbox("Export Pixels to Text", true);
Dialog.addCheckbox("Export Histograms to Text", true);
Dialog.addCheckbox("Export Batch Histogram to Text", true);
Dialog.addString("Save as", "", 20);
Dialog.show();
pixels = Dialog.getCheckbox();
histos = Dialog.getCheckbox();
batchHisto = Dialog.getCheckbox();
output = Dialog.getString();
if (pixels || histos) {
	list = getFileList(dir);
	setBatchMode(true);
	okay = call("loci.slim.SLIM_PlugIn.startBatch");
//	if (okay) { // doesn't work
		for (i = 0; i &lt; list.length; i++) {
			showProgress(i+1, list.length);
			call("loci.slim.SLIM_PlugIn.batch", dir + list[i], output, pixels, histos);
		}
		call("loci.slim.SLIM_PlugIn.endBatch");
//	}
}
if (batchHisto) {
	list = getFileList(dir);
	setBatchMode(true);
	call("loci.slim.SLIM_PlugIn.startBatchHisto");
	for (i = 0; i &lt; list.length; ++i) {
		showProgress(i+1, list.length);
		call("loci.slim.SLIM_PlugIn.batchHisto", dir + list[i], output);
	}
	call("loci.slim.SLIM_PlugIn.endBatchHisto");
}
</pre>
<h3><span class="mw-headline" id="Segmentation_using_classification">Segmentation using classification</span></h3>
<p>For some specific applications, you might want to analyze a specific segment in the lifetime image. In particular, Fiji's <a href="Trainable_Weka_Segmentation" title="Trainable Weka Segmentation">Trainable Weka Segmentation</a> plugin is very useful for machine learning based segmentation. We can train the classifier with one image with certain training instances, then use that classifier to segment additional images. With segmented data, we can create a mask and using the ROI manager we can overlay the ROI to analyze different part of the image. The steps for segmentation using classification are:
</p>
<ol><li> Open a lifetime image using the SLIM Curve plugin.</li>
<li> <a href="Trainable_Weka_Segmentation#Train_classifier" title="Trainable Weka Segmentation">Train the classifier</a> using Trainable Weka Segmentation.</li>
<li> Create instances to train your classifier with the number of classes required.</li>
<li> Train classifier by clicking the "Train classifier" button.</li>
<li> Select “Create result” to create the segmented image (you can save the classifier to use it later).</li>
<li> Use the Thresholding tool to threshold the image to remove the region not needed.</li>
<li> Run the Create Mask and Create Selection commands to make the ROI. You can execute commands easily using the <a href="Command_Finder" class="mw-redirect" title="Command Finder">Command Finder</a> (press <kbd class="keyboard-key nowrap" style="border: 1px solid #aaa; -moz-border-radius: 0.2em; -webkit-border-radius: 0.2em; border-radius: 0.2em; -moz-box-shadow: 0.1em 0.2em 0.2em #ddd; -webkit-box-shadow: 0.1em 0.2em 0.2em #ddd; box-shadow: 0.1em 0.2em 0.2em #ddd; background-color: #f9f9f9; background-image: -moz-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: -o-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: -webkit-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: linear-gradient(&#91;&#91;:Template:Linear-gradient/legacy]], #eee, #f9f9f9, #eee); padding: 0.1em 0.3em; font-family: inherit; font-size: 0.85em;">L</kbd>).</li>
<li> Add the ROI to ROI manager by pressing <kbd class="keyboard-key nowrap" style="border: 1px solid #aaa; -moz-border-radius: 0.2em; -webkit-border-radius: 0.2em; border-radius: 0.2em; -moz-box-shadow: 0.1em 0.2em 0.2em #ddd; -webkit-box-shadow: 0.1em 0.2em 0.2em #ddd; box-shadow: 0.1em 0.2em 0.2em #ddd; background-color: #f9f9f9; background-image: -moz-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: -o-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: -webkit-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: linear-gradient(&#91;&#91;:Template:Linear-gradient/legacy]], #eee, #f9f9f9, #eee); padding: 0.1em 0.3em; font-family: inherit; font-size: 0.85em;">T</kbd>. Use it on overlay with lifetime image and start analyzing.</li></ol>
<div class="MediaTransformError" style="width: 581px; height: 0px; display:inline-block;">Error creating thumbnail: Unable to save thumbnail to destination</div>
<div class="MediaTransformError" style="width: 399px; height: 0px; display:inline-block;">Error creating thumbnail: Unable to save thumbnail to destination</div>
<h3><span class="mw-headline" id="Result_comparison">Result comparison</span></h3>
<p>The result of the SLIM Curve plugin compares reasonably with standard lifetime analysis software like SPCImage. Here is a small comparison between the lifetime obtained with SPCImage and SLIM Curve for lifetime analysis of coumarin 6 dye. The lifetime image which has been analysed can be found <a rel="nofollow" class="external text" href="https://www.dropbox.com/s/53biq6plp0z4q5v/coumarin6_740_60xW_zoom4_256_140603.sdt">here</a> and the urea image that is used to create the excitation can be found <a rel="nofollow" class="external text" href="https://www.dropbox.com/s/rg4rdb1ad8uxk61/urea_740_60xW_zoom4_256_140603.sdt">here</a>. The excitation was set between 1.5 to 5.2 ns. And the shift(Z) was fixed at 0.7. A one component fit was performed. Binning was 3x3. The results shows that the lifetime values obtained from SLIM Curve varies between 0.5%-2% from the value obtained from SPCImage for 5 points selected randomly. The lifetimes are given below for the same locations are given below. 
</p>
<table class="wikitable">

<tr>
<th> X
</th>
<th> Y
</th>
<th> SLIM  Curve(in ps)
</th>
<th> SPCImage(in ps)
</th>
<th> Difference(%)
</th></tr>
<tr>
<td> 166
</td>
<td> 113
</td>
<td> 2582
</td>
<td> 2567
</td>
<td> 0.584
</td></tr>
<tr>
<td> 93
</td>
<td> 37
</td>
<td> 2488
</td>
<td> 2539
</td>
<td> -2.01
</td></tr>
<tr>
<td> 195
</td>
<td> 76
</td>
<td> 2548
</td>
<td> 2602
</td>
<td> -2.08
</td></tr>
<tr>
<td> 207
</td>
<td> 202
</td>
<td> 2464
</td>
<td> 2487
</td>
<td> -0.92
</td></tr>
<tr>
<td> 219
</td>
<td> 49
</td>
<td> 2470
</td>
<td> 2493
</td>
<td> -0.922
</td></tr></table>
<h2><span class="mw-headline" id="Getting_help">Getting help</span></h2>
<p>If you have questions, please ask on the <a rel="nofollow" class="external text" href="https://forum.image.sc/">Image.sc Forum</a> with the <a rel="nofollow" class="external text" href="https://forum.image.sc/tags/slim-curve"><code>slim-curve</code> tag</a>.
</p>
<!-- 
NewPP limit report
Cached time: 20200713073242
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.088 seconds
Real time usage: 0.096 seconds
Preprocessor visited node count: 1592/1000000
Preprocessor generated node count: 11002/1000000
Post‐expand include size: 6208/2097152 bytes
Template argument size: 1317/2097152 bytes
Highest expansion depth: 10/40
Expensive parser function count: 0/3
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%   52.368      1 - -total
 59.31%   31.062      2 - Template:Key
 51.92%   27.187      2 - Template:Key_press/core
 26.12%   13.677      1 - Template:Infobox
 16.69%    8.740      1 - Template:Person
  6.77%    3.547      1 - Template:Warning
  5.43%    2.841      1 - Template:Bc
  4.89%    2.559      1 - Template:Ambox
  3.21%    1.679      1 - Template:GitHub
  2.53%    1.323      2 - Template:Linear-gradient
-->
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="index.php?title=SLIM_Curve&amp;oldid=41321">http://imagej.net/index.php?title=SLIM_Curve&amp;oldid=41321</a>"</div>
							</div>

			<div id="footer">
				<p> This page was last modified on 24 January 2020, at 11:55.</p><ul><li><a href="./ImageJ:Privacy_policy" title="ImageJ:Privacy policy">Privacy policy</a></li><li><a href="./ImageJ:About" class="mw-redirect" title="ImageJ:About">About ImageJ</a></li><li><a href="Imprint" title="Imprint">Imprint</a></li></ul>			</div>

			<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="./Special:Categories" title="Special:Categories">Category</a>: <ul><li><a href="./Category:Plugins" title="Category:Plugins">Plugins</a></li></ul></div></div>		</div>

		<div id="bottom-wrap">
			<div id="footer-wrap-inner">
				<div id="ternary" class="footer">
					<ul>
						<li class="widget">
							<img id="logo" src="skins/imagej-128.png" alt="">
						</li>
					</ul>
				</div>
			</div>
		</div>
		<script>(window.RLQ=window.RLQ||[]).push(function(){mw.loader.load(["ext.fancytree","ext.suckerfish","mediawiki.toc","mediawiki.action.view.postEdit","site","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest","ext.SimpleTooltip"]);});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":268});});</script>
		</body>
		</html>
		