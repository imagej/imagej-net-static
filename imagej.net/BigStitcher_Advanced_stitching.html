<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8"/>
<title>BigStitcher Advanced stitching - ImageJ</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"BigStitcher_Advanced_stitching","wgTitle":"BigStitcher Advanced stitching","wgCurRevisionId":37713,"wgRevisionId":37713,"wgArticleId":10327,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"BigStitcher_Advanced_stitching","wgRelevantArticleId":10327,"wgRequestId":"9500d9d73ba3c463c5faa955","wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgPreferredVariant":"en","fancytree_path":"/extensions/TreeAndMenu/fancytree"});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user.cssprefs":"ready","user":"ready","user.options":"loading","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","skins.erudite":"ready"});mw.loader.implement("user.options@0j3lz3q",function($,jQuery,require,module){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens@1ku9xth",function ( $, jQuery, require, module ) {
mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});/*@nomin*/;

});mw.loader.load(["mediawiki.page.startup"]);});</script>
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%252Cshared%257Cmediawiki.sectionAnchor%257Cskins.erudite&amp;only=styles&amp;skin=erudite.css"/>
<script async="" src="load.php%3Fdebug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=erudite"></script>
<link rel="stylesheet" href="extensions/TreeAndMenu/fancytree/fancytree.css"/><link rel="stylesheet" href="extensions/TreeAndMenu/suckerfish/suckerfish.css"/>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=erudite.css"/>
<meta name="generator" content="MediaWiki 1.28.0"/>
<meta name="description" content="In addition to the default Phase Correlation-based pairwise shift determination, we offer some alternative methods and advanced parameterization, as well as non-standard grouping of the views in your dataset."/>
<link rel="shortcut icon" href="skins/ij2.ico"/>
	<meta property="og:type" content="article"/>

	<meta property="og:site_name" content="ImageJ"/>

	<meta property="og:title" content="BigStitcher Advanced stitching"/>

	<meta property="og:description" content="In addition to the default Phase Correlation-based pairwise shift determination, we offer some alternative methods and advanced parameterization, as well as non-standard grouping of the views in your dataset."/>


<meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-BigStitcher_Advanced_stitching rootpage-BigStitcher_Advanced_stitching skin-erudite action-view">
		<div class="mw-jump">
			<a href="BigStitcher_Advanced_stitching.html#bodyContent">Skip to content</a>, 			<a href="BigStitcher_Advanced_stitching.html#search">Skip to search</a>
		</div>

		<div id="top-wrap" role="banner">
			<h1><a href="Welcome" title="ImageJ" rel="home">ImageJ</a></h1>
			<div id="tagline">From ImageJ</div>

			<a id="menubutton" href="BigStitcher_Advanced_stitching.html#menu">Menu</a>
			<div id="nav" role="navigation">
			<ul id='menu'>
<li id="menu-item-n-About"><a href="ImageJ">About</a></li>
<li id="menu-item-n-Downloads"><a href="Downloads">Downloads</a></li>
<li id="menu-item-n-Learn"><a href="Learn">Learn</a></li>
<li id="menu-item-n-Develop"><a href="Development">Develop</a></li>
<li id="menu-item-n-News"><a href="News">News</a></li>
<li id="menu-item-n-Events"><a href="Events">Events</a></li>
<li id="menu-item-n-Help"><a href="Help">Help</a></li>
</ul>
			</div>
		</div>

		<div id="mw-js-message"></div>
		
		<div id="main" role="main">
			<div id="nav-meta">
			<span id="ca-nstab-main" class="selected"><a href="BigStitcher_Advanced_stitching" title="View the content page [c]" accesskey="c">Page</a></span><span class="meta-sep">|</span><span id="ca-talk" class="new"><a href="index.php?title=Talk:BigStitcher_Advanced_stitching&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page [t]" accesskey="t">Discussion</a></span><span class="meta-sep">|</span><span id="ca-viewsource"><a href="index.php?title=BigStitcher_Advanced_stitching&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span><span class="meta-sep">|</span><span id="ca-history"><a href="index.php?title=BigStitcher_Advanced_stitching&amp;action=history" title="Past revisions of this page [h]" accesskey="h">History</a></span><span class="meta-sep">|</span>			</div>

			<div id="bodyContent">
				<h1>BigStitcher Advanced stitching</h1>
				
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="BigStitcher_Advanced_stitching.html#Overview"><span class="tocnumber">1</span> <span class="toctext">Overview</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="BigStitcher_Advanced_stitching.html#Advanced_pairwise_shift_calculation"><span class="tocnumber">2</span> <span class="toctext">Advanced pairwise shift calculation</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="BigStitcher_Advanced_stitching.html#Advanced_phase_correlation"><span class="tocnumber">2.1</span> <span class="toctext">Advanced phase correlation</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="BigStitcher_Advanced_stitching.html#Iterative_alignment_via_Lucas-Kanade_algorithm"><span class="tocnumber">2.2</span> <span class="toctext">Iterative alignment via Lucas-Kanade algorithm</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="BigStitcher_Advanced_stitching.html#Interest_point-based_shift_calculation"><span class="tocnumber">2.3</span> <span class="toctext">Interest point-based shift calculation</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6"><a href="BigStitcher_Advanced_stitching.html#Advanced_view_grouping"><span class="tocnumber">3</span> <span class="toctext">Advanced view grouping</span></a></li>
</ul>
</div>

<h1><span class="mw-headline" id="Overview">Overview</span></h1>
<p>In addition to the default Phase Correlation-based pairwise shift determination, we offer some alternative methods and advanced parameterization, as well as non-standard grouping of the views in your dataset.
</p>
<div class="center"><div class="floatnone"><a href="./File:BigStitcher_stitch_0.png" class="image"><img alt="BigStitcher stitch 0.png" src="_images/a/ac/BigStitcher_stitch_0.png" width="600" height="186" /></a></div></div>
<p>If you want to proceed straight to the next steps after calculating the shifts, we offer the same options under <span><em><span style="border-bottom:1px dotted #ccc;">Stitching Wizard</span>&#160;&#8250; <span style="border-bottom:1px dotted #ccc;">Stitch dataset (expert) ...</span></em></span>
</p>
<h1><span class="mw-headline" id="Advanced_pairwise_shift_calculation">Advanced pairwise shift calculation</span></h1>
<p>We currently support three different ways of calculating pairwise shifts.
</p>
<div style="overflow:hidden"><table class="metadata plainlinks ambox ambox-notice">
<tr>
<td class="ambox-image">
<p><a href="./File:Information-sign.png" class="image"><img alt="Information-sign.png" src="_images/2/24/Information-sign.png" width="40" height="40" /></a>
</p>
</td>
<td> We strongly advice to try the default <b>Phase Correlation</b> first, as it tends to give the most robust results in comparison to the more specialized methods below. </td>
<p><br />
</p>
</tr>
</table></div>
<p><br />
</p>
<h2><span class="mw-headline" id="Advanced_phase_correlation">Advanced phase correlation</span></h2>
<p>First, you will be asked for parameters for the phase correlation calculation:
</p>
<ul><li> <b>number of peaks to check:</b> the output of the Fourier-based phase correlation is a phase correlation matrix (PCM) with, ideally, a single intensity peak corresponding to the shift vector between the input images. However, due to noise, there might actually be multiple peaks in the PCM. Each peak can also correspond to multiple (8) shifts due to the circular nature of the phase correlation, so we have to verify all possible shifts by calculating the cross correlation of the shifted images to determine the correct one. We can do the verification for not just the highest PCM-peak, but the <i>n</i> highest peaks. This parameter specifies how many peaks to consider. Increasing it might improve results in very noisy images, but it will also increase the computation time. </li>
<li> <b>minimal overlap:</b> when checking multiple possible shifts, we can immediately discard some of them if the resulting overlap is to big. You can increase this parameter to restrict the results to small shifts (minimal overlap of 100 would correspond to NO shift) if you already have a rough alignment of the views.</li>
<li> <b>subpixel accuracy:</b> whether to localize the peaks in the PCM with subpixel accuracy or not. This slightly increases the computational burden, but is especially important if you use <b>downsampled images</b>.</li>
<li> <b>interpolate subpixel cross correlation:</b> when verifying subpixel-localized PCM-peaks, you can either calculate cross correlations with the nearest integer shift or, for maximum fidelity, on linearly interpolated images. Doing this on the fly increases the computational load quite a bit and the differences in results are typically negligible, so we recommend leaving this off.</li>
<li> <b>show expert grouping options</b>: if you activate this, you will be asked which views to include in the calculation and how to group them in another dialog. See the <a href="BigStitcher_Advanced_stitching#Advanced_view_grouping" title="BigStitcher Advanced stitching">Advanced view grouping section below</a> for details.</li></ul>
<p>Next, you will be asked how to treat grouped views and which downsampling of the images to use. This is the same as in the simple mode, so please look <a href="BigStitcher_Pairwise_shift#Pairwise_shift_calculation" title="BigStitcher Pairwise shift">to the corresponding page</a> for details.
</p>
<div class="center"><div class="floatnone"><a href="./File:BigStitcher_stitch_advanced_phasecorr.png" class="image"><img alt="BigStitcher stitch advanced phasecorr.png" src="_images/b/bd/BigStitcher_stitch_advanced_phasecorr.png" width="600" height="387" /></a></div></div>
<h2><span class="mw-headline" id="Iterative_alignment_via_Lucas-Kanade_algorithm">Iterative alignment via Lucas-Kanade algorithm</span></h2>
<p>The Lucas-Kanade Algorithm can align two images by iteratively minimizing the difference between them via Gradient descent an the transformation parameters. It can in theory be used for more complex transformation models, such as affine transforms, but at the moment, we restrict it to a simple translation. Lucas-Kanade tends to produce good, subpixel-accurate alignments. It requires, however, that the images <b>are already roughly aligned</b>, otherwise the optimization often fails to determine the correct shift.  
</p><p>First, you will be asked for three parameters:
</p>
<ul><li> <b>maximum iterations:</b> how many Gradient descent iterations to run. You might want to increase this parameter if the prior alignment is far off (however, the method generally performs poorly in such cases) or if you set the minimum parameter change very low. If no optimum was found after the maximum iteration number, we consider the alignment to have failed and return no shift for the image pair.</li>
<li> <b>minimum parameter change for convergence:</b> the optimization will run until the change in length for the current estimate for the shift vector falls below this threshold (in pixels). Lower values might provide more accurate alignments but increase computation times.</li>
<li> <b>show expert grouping options</b>: if you activate this, you will be asked which views to include in the calculation and how to group them in another dialog. See the <a href="BigStitcher_Advanced_stitching#Advanced_view_grouping" title="BigStitcher Advanced stitching">Advanced view grouping section below</a> for details.</li></ul>
<p>Next, you will be asked how to treat grouped views and which downsampling of the images to use. This is the same as in the simple mode, so please look <a href="BigStitcher_Pairwise_shift#Pairwise_shift_calculation" title="BigStitcher Pairwise shift">to the corresponding page</a> for details.
</p>
<div class="center"><div class="floatnone"><a href="./File:BigStitcher_stitch_advanced_lk.png" class="image"><img alt="BigStitcher stitch advanced lk.png" src="_images/9/98/BigStitcher_stitch_advanced_lk.png" width="600" height="343" /></a></div></div>
<h2><span class="mw-headline" id="Interest_point-based_shift_calculation">Interest point-based shift calculation</span></h2>
<p>Finally, you can use the interest point-based registration of the <a href="Multiview-Reconstruction" title="Multiview-Reconstruction">Multiview-Reconstruction</a> to determine pairwise shifts. In the right-click menu, you can choose whether to do the alignment with <b>new interest points</b> or <b>existing interest points</b> (if they exist).
</p><p>Also in the menu, you can activate or deactivate <b>Show expert grouping options</b>. If it is activated, you will be asked which views to include in the calculation and how to group them. See the <a href="BigStitcher_Advanced_stitching#Advanced_view_grouping" title="BigStitcher Advanced stitching">Advanced view grouping section below</a> for details.
</p><p>If you chose to detect new interest points, you will then have to proceed through the steps of interest point detection. Please refer to the <a href="BigStitcher_Interest_points" title="BigStitcher Interest points">corresponding section</a> of this Wiki for detailed instructions.
</p><p>Next, the image pairs will be registered using the interest points. Please refer to the <a href="BigStitcher_Registration" title="BigStitcher Registration">corresponding section</a> of this Wiki for detailed instructions. Note that the transformation model is restricted to a simple translation at the moment and you can only use the following strategies:
</p>
<ul><li> Fast descriptor-based (rotation invariant)</li>
<li> Fast descriptor-based (translation invariant)</li>
<li> Precise descriptor-based (translation invariant)</li></ul>
<h1><span class="mw-headline" id="Advanced_view_grouping">Advanced view grouping</span></h1>
<p>In the expert mode of the stitching steps, we offer advanced options for view grouping (in addition to the channel and illumination grouping available via the UI) and batch processing.
</p><p>In the next two dialogs, you will be asked which views to include in the calculations and how to group them.
</p>
<ul><li> In the first dialog, you can select whether all instances of an attribute or just the currently selected views should be processed. For example, in the example below, we use all Channels, Tiles and Illuminations, but only for the currently selected timepoint and angle.</li></ul>
<div class="center"><div class="floatnone"><a href="./File:BigStitcher_stitch_6.png" class="image"><img alt="BigStitcher stitch 6.png" src="_images/b/b6/BigStitcher_stitch_6.png" width="600" height="427" /></a></div></div>
<ul><li>Select how to process the different attributes. For example, in the figure below, we will <i>treat TimePoints and Angles individually</i>, which means that we will compute shifts between view pairs separately for each time point and angle. Likewise, we <i>group Channels and Illuminations</i>, meaning that we will combine all channels and illumination directions for a tile into one image beforw calculating shifts. Finally, we <i>compare</i> Tiles, which means that shifts will be calculated between tiles.</li></ul>
<div class="center"><div class="floatnone"><a href="./File:BigStitcher_stitch_8.png" class="image"><img alt="BigStitcher stitch 8.png" src="_images/8/8d/BigStitcher_stitch_8.png" width="600" height="361" /></a></div></div>
<div style="overflow:hidden"><table class="metadata plainlinks ambox ambox-content">
<tr>
<td class="ambox-image">
<p><a href="./File:Important-sign.png" class="image"><img alt="Important-sign.png" src="_images/f/f0/Important-sign.png" width="40" height="40" /></a>
</p>
</td>
<td> Theoretically, you can use the second dialog to generate arbitrary groupings of the data, e.g. compare Channels but group Tiles for chromatic shift correction. Not all of these groupings might make sense and not all of them can be properly visualized in the UI (e.g. for <i>interactive link preview</i>). Note that you have to use for the same grouping of the data in the subsequent <i>global optimization</i> step. </td>
<p><br />
</p>
</tr>
</table></div>
<p><br />
</p><p>Go back to the <a href="BigStitcher#Documentation" title="BigStitcher">main page</a>
</p>
<!-- 
NewPP limit report
Cached time: 20200713064608
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.040 seconds
Real time usage: 0.043 seconds
Preprocessor visited node count: 148/1000000
Preprocessor generated node count: 856/1000000
Post‐expand include size: 2436/2097152 bytes
Template argument size: 1250/2097152 bytes
Highest expansion depth: 6/40
Expensive parser function count: 0/3
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%    8.750      1 - -total
 46.30%    4.051      1 - Template:Bc
 34.07%    2.981      1 - Template:Notice
 31.92%    2.793      2 - Template:Ambox
 16.86%    1.475      1 - Template:Warning
 11.72%    1.025      1 - Template:Arrow
-->
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="index.php?title=BigStitcher_Advanced_stitching&amp;oldid=37713">http://imagej.net/index.php?title=BigStitcher_Advanced_stitching&amp;oldid=37713</a>"</div>
							</div>

			<div id="footer">
				<p> This page was last modified on 3 May 2018, at 03:03.</p><ul><li><a href="./ImageJ:Privacy_policy" title="ImageJ:Privacy policy">Privacy policy</a></li><li><a href="./ImageJ:About" class="mw-redirect" title="ImageJ:About">About ImageJ</a></li><li><a href="Imprint" title="Imprint">Imprint</a></li><li><a href="index.php?title=BigStitcher_Advanced_stitching&amp;mobileaction=toggle_view_mobile" class="noprint stopMobileRedirectToggle">Mobile view</a></li></ul>			</div>

			<div id="catlinks" class="catlinks catlinks-allhidden" data-mw="interface"></div>		</div>

		<div id="bottom-wrap">
		</div>
		<script>(window.RLQ=window.RLQ||[]).push(function(){mw.loader.load(["ext.fancytree","ext.suckerfish","mediawiki.toc","mediawiki.action.view.postEdit","site","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest","ext.SimpleTooltip"]);});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":236});});</script>
		</body>
		</html>
		