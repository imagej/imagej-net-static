<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8"/>
<title>Using TrackMate from MATLAB - ImageJ</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Using_TrackMate_from_MATLAB","wgTitle":"Using TrackMate from MATLAB","wgCurRevisionId":41416,"wgRevisionId":41416,"wgArticleId":2084,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Matlab","Scripting","Tracking"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Using_TrackMate_from_MATLAB","wgRelevantArticleId":2084,"wgRequestId":"6b89f2b51327537cbf1bfe5a","wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgPreferredVariant":"en","fancytree_path":"/extensions/TreeAndMenu/fancytree"});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user.cssprefs":"ready","user":"ready","user.options":"loading","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","skins.erudite":"ready"});mw.loader.implement("user.options@0j3lz3q",function($,jQuery,require,module){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens@1ku9xth",function ( $, jQuery, require, module ) {
mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});/*@nomin*/;

});mw.loader.load(["mediawiki.page.startup"]);});</script>
<link rel="stylesheet" href="erudite14.css"/>
<link rel="stylesheet" href="extensions/TreeAndMenu/fancytree/fancytree.css"/><link rel="stylesheet" href="extensions/TreeAndMenu/suckerfish/suckerfish.css"/>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="erudite15.css"/>
<meta name="generator" content="MediaWiki 1.28.0"/>
<meta name="description" content="This page shows how to use and control TrackMate directly from within MATLAB. This is great and made possible thanks to the great Miji tool, that make the Fiji classes visible from MATLAB. Check this page first if you have not already. Note however that as 2016, Mark Hinerm and friends built a stronger replacement from Miji, ImageJ-MATLAB. This page still clings to using Miji, but moving to ImageJ-MATLAB should be painless."/>
<link rel="shortcut icon" href="skins/ij2.ico"/>

<script type="text/javascript" src="extensions/SyntaxHighlighter/syntaxhighlighter/scripts/shCore.js"></script>
<script type="text/javascript" src="extensions/SyntaxHighlighter/syntaxhighlighter/scripts/shBrushMatlab.js"></script>
<script type="text/javascript">
SyntaxHighlighter.all();
</script>
<link rel="stylesheet" type="text/css" media="screen" href="extensions/SyntaxHighlighter/syntaxhighlighter/styles/shCoreMinit.css" />

	<meta property="og:type" content="article"/>

	<meta property="og:site_name" content="ImageJ"/>

	<meta property="og:title" content="Using TrackMate from MATLAB"/>

	<meta property="og:description" content="This page shows how to use and control TrackMate directly from within MATLAB. This is great and made possible thanks to the great Miji tool, that make the Fiji classes visible from MATLAB. Check this page first if you have not already. Note however that as 2016, Mark Hinerm and friends built a stronger replacement from Miji, ImageJ-MATLAB. This page still clings to using Miji, but moving to ImageJ-MATLAB should be painless."/>


<meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Using_TrackMate_from_MATLAB rootpage-Using_TrackMate_from_MATLAB skin-erudite action-view">
		<div id="top-wrap" role="banner">
			<h1><a href="Welcome" title="ImageJ" rel="home">ImageJ</a></h1>
			<div id="tagline">From ImageJ</div>

			<a id="menubutton" href="Using_TrackMate_from_MATLAB.html#menu">Menu</a>
			<div id="nav" role="navigation">
			<ul id='menu'>
<li id="menu-item-n-About"><a href="ImageJ">About</a></li>
<li id="menu-item-n-Downloads"><a href="Downloads">Downloads</a></li>
<li id="menu-item-n-Learn"><a href="Learn">Learn</a></li>
<li id="menu-item-n-Develop"><a href="Development">Develop</a></li>
<li id="menu-item-n-News"><a href="News">News</a></li>
<li id="menu-item-n-Events"><a href="Events">Events</a></li>
<li id="menu-item-n-Help"><a href="Help">Help</a></li>
</ul>
			</div>
		</div>

		<div id="mw-js-message"></div>
		
		<div id="main" role="main">

			<div id="bodyContent">
				<div style="font-size: large; border: 1px solid black; padding: 1em; margin-bottom: 1em; text-align: center; background-color: #fda;">
					This is a read-only version of imagej.net, available during the transition to a new site.
					<br>Please direct any questions or issues to <a href="https://forum.image.sc/t/imagej-wiki-is-down/39672">this Image.sc Forum thread</a>.
					<br>Thank you for your patience as we improve the website!
				</div>

				<h1>Using TrackMate from MATLAB</h1>
				
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><p>This page shows how to use and control TrackMate directly from <i>within <a href="MATLAB" class="mw-redirect" title="MATLAB">MATLAB</a></i>. This is great and made possible thanks to the great <a href="Miji" title="Miji">Miji</a> tool, that make the Fiji classes visible from <a href="MATLAB" class="mw-redirect" title="MATLAB">MATLAB</a>. Check this page first if you have not already. Note however that as 2016, Mark Hinerm and friends built a stronger replacement from Miji, <a href="MATLAB_Scripting" title="MATLAB Scripting">ImageJ-MATLAB</a>. This page still clings to using Miji, but moving to ImageJ-MATLAB should be painless.
</p><p>All the following examples assume you have launched <a href="MATLAB" class="mw-redirect" title="MATLAB">MATLAB</a>, and properly initiated Miji, using for instance
</p>
<pre class="brush:matlab">
Miji(false)
</pre>
<p>or 
</p>
<pre class="brush:matlab">
Miji(true)
</pre>
<p>if you want the Fiji window to be visible.
</p><p>Apart from that, the collections of examples that follow just look like several scripts. Which is actually the case: We use the <a href="MATLAB" class="mw-redirect" title="MATLAB">MATLAB</a> interpreter as a scripting interface for TrackMate, as we did in the <a href="Scripting_TrackMate" title="Scripting TrackMate">Scripting TrackMate</a> page. We separated this page to highlight <a href="MATLAB" class="mw-redirect" title="MATLAB">MATLAB</a> specificities and to exploit its capabilities better.
</p><p><br />
</p>
<h2><span class="mw-headline" id="A_simple_tracking_example">A simple tracking example</span></h2>
<p>Here we open an image though Fiji (not though <a href="MATLAB" class="mw-redirect" title="MATLAB">MATLAB</a>) and track its content. The results are displayed in a Fiji window as well. <a href="MATLAB" class="mw-redirect" title="MATLAB">MATLAB</a> is used here only to control TrackMate and does not really plays a role in the process. This example is actually the same that in the first <a href="Scripting_TrackMate" title="Scripting TrackMate">Scripting TrackMate</a> example.
</p><p>Note that we used the fully qualified name for TrackMate classes, <i>e.g.</i> <code>fiji.plugin.trackmate.TrackMate</code> instead of <code>TrackMate</code>. This is the first way to import classes in a <a href="MATLAB" class="mw-redirect" title="MATLAB">MATLAB</a> script. We will see another way later.
</p>
<pre class="brush:matlab">
% Get currently selected image
% imp = ij.IJ.openImage('https://fiji.sc/samples/FakeTracks.tif')
imp = ij.ImagePlus('/Users/tinevez/Desktop/Data/FakeTracks.tif');
imp.show()
   
   
%----------------------------
% Create the model object now
%----------------------------
   
% Some of the parameters we configure below need to have
% a reference to the model at creation. So we create an
% empty model now.
model = fiji.plugin.trackmate.Model();
   
% Send all messages to ImageJ log window.
model.setLogger(fiji.plugin.trackmate.Logger.IJ_LOGGER)
      
%------------------------
% Prepare settings object
%------------------------
      
settings = fiji.plugin.trackmate.Settings();
settings.setFrom(imp)
      
% Configure detector - We use a java map
settings.detectorFactory = fiji.plugin.trackmate.detection.LogDetectorFactory();
map = java.util.HashMap();
map.put('DO_SUBPIXEL_LOCALIZATION', true);
map.put('RADIUS', 2.5);
map.put('TARGET_CHANNEL', 1);
map.put('THRESHOLD', 0);
map.put('DO_MEDIAN_FILTERING', false);
settings.detectorSettings = map;
   
% Configure spot filters - Classical filter on quality
filter1 = fiji.plugin.trackmate.features.FeatureFilter('QUALITY', 1.0, true);
settings.addSpotFilter(filter1)
    
% Configure tracker - We want to allow splits and fusions
settings.trackerFactory  = fiji.plugin.trackmate.tracking.sparselap.SparseLAPTrackerFactory();
settings.trackerSettings = fiji.plugin.trackmate.tracking.LAPUtils.getDefaultLAPSettingsMap();&#160;% almost good enough
settings.trackerSettings.put('ALLOW_TRACK_SPLITTING', true);
settings.trackerSettings.put('ALLOW_TRACK_MERGING', true);
   
% Configure track analyzers - Later on we want to filter out tracks 
% based on their displacement, so we need to state that we want 
% track displacement to be calculated. By default, out of the GUI, 
% not features are calculated. 
   
% The displacement feature is provided by the TrackDurationAnalyzer.
settings.addTrackAnalyzer(fiji.plugin.trackmate.features.track.TrackDurationAnalyzer())
   
% Configure track filters - We want to get rid of the two immobile spots at 
% the bottom right of the image. Track displacement must be above 10 pixels.
filter2 = fiji.plugin.trackmate.features.FeatureFilter('TRACK_DISPLACEMENT', 10.0, true);
settings.addTrackFilter(filter2)
   
   
%-------------------
% Instantiate plugin
%-------------------
   
trackmate = fiji.plugin.trackmate.TrackMate(model, settings);
      
%--------
% Process
%--------
   
ok = trackmate.checkInput();
if ~ok
    display(trackmate.getErrorMessage())
end

ok = trackmate.process();
if ~ok
    display(trackmate.getErrorMessage())
end
      
%----------------
% Display results
%----------------
    
selectionModel = fiji.plugin.trackmate.SelectionModel(model);
displayer =  fiji.plugin.trackmate.visualization.hyperstack.HyperStackDisplayer(model, selectionModel, imp);
displayer.render()
displayer.refresh()
   
% Echo results
display(model.toString())
</pre>
<p><br />
</p>
<h2><span class="mw-headline" id="Using_imports_in_MATLAB">Using imports in MATLAB</span></h2>
<p>MATLAB lets you import java names into its workspace, using the <code>import</code> command. Check <a rel="nofollow" class="external text" href="http://www.mathworks.fr/fr/help/matlab/matlab_external/bringing-java-classes-and-methods-into-matlab-workspace.html#f46341">this</a>. So we could rewrite the above script as follow:
</p><p><br />
</p>
<pre class="brush:matlab">
%----------------------------------
% Import Fiji and TrackMate classes
%----------------------------------

import java.util.HashMap
import ij.*
import fiji.plugin.trackmate.*
import fiji.plugin.trackmate.detection.*
import fiji.plugin.trackmate.features.*
import fiji.plugin.trackmate.features.track.*
import fiji.plugin.trackmate.tracking.*
import fiji.plugin.trackmate.visualization.hyperstack.*


%--------------------
% Pick a source image
%--------------------

% Get currently selected image
% imp = IJ.openImage('https://fiji.sc/samples/FakeTracks.tif')
imp = ImagePlus('/Users/tinevez/Desktop/Data/FakeTracks.tif');
imp.show()
    
    
%----------------------------
% Create the model object now
%----------------------------
    
% Some of the parameters we configure below need to have
% a reference to the model at creation. So we create an
% empty model now.
model = Model();
    
% Send all messages to ImageJ log window.
model.setLogger(Logger.IJ_LOGGER)
       
%------------------------
% Prepare settings object
%------------------------
       
settings = Settings();
settings.setFrom(imp)
       
% Configure detector - We use a java map
settings.detectorFactory = LogDetectorFactory();
map = HashMap();
map.put('DO_SUBPIXEL_LOCALIZATION', true);
map.put('RADIUS', 2.5);
map.put('TARGET_CHANNEL', 1);
map.put('THRESHOLD', 0);
map.put('DO_MEDIAN_FILTERING', false);
settings.detectorSettings = map;
    
% Configure spot filters - Classical filter on quality
filter1 = FeatureFilter('QUALITY', 1.0, true);
settings.addSpotFilter(filter1)
     
% Configure tracker - We want to allow splits and fusions
settings.trackerFactory  = fiji.plugin.trackmate.tracking.sparselap.SparseLAPTrackerFactory();
settings.trackerSettings = LAPUtils.getDefaultLAPSettingsMap();&#160;% almost good enough
settings.trackerSettings.put('ALLOW_TRACK_SPLITTING', true);
settings.trackerSettings.put('ALLOW_TRACK_MERGING', true);
    
% Configure track analyzers - Later on we want to filter out tracks 
% based on their displacement, so we need to state that we want 
% track displacement to be calculated. By default, out of the GUI, 
% not features are calculated. 
    
% The displacement feature is provided by the TrackDurationAnalyzer.
settings.addTrackAnalyzer(TrackDurationAnalyzer())
    
% Configure track filters - We want to get rid of the two immobile spots at 
% the bottom right of the image. Track displacement must be above 10 pixels.
filter2 = FeatureFilter('TRACK_DISPLACEMENT', 10.0, true);
settings.addTrackFilter(filter2)
    
    
%-------------------
% Instantiate plugin
%-------------------
    
trackmate = TrackMate(model, settings);
       
%--------
% Process
%--------
    
ok = trackmate.checkInput();
if ~ok
    display(trackmate.getErrorMessage())
end
 
ok = trackmate.process();
if ~ok
    display(trackmate.getErrorMessage())
end
       
%----------------
% Display results
%----------------
     
selectionModel = SelectionModel(model);
displayer = HyperStackDisplayer(model, selectionModel, imp);
displayer.render()
displayer.refresh()
    
% Echo results
display(model.toString())
</pre>
<h2><span class="mw-headline" id="Why_is_this_greater_than_it_seems.3F">Why is this greater than it seems?</span></h2>
<p>Because your just ran a <a href="MATLAB" class="mw-redirect" title="MATLAB">MATLAB</a> script that uses and benefits from multithreading without relying on any toolbox! Here is how to tune the number of threads used by TrackMate:
</p><p><br />
</p>
<pre class="brush:matlab">
% ... Do initialization before.


trackmate = TrackMate(model, settings);
trackmate.setNumThreads(3);&#160;% As many threads as you want.
</pre>
<p><br />
</p><p><a href="./User:JeanYvesTinevez" title="User:JeanYvesTinevez">JeanYvesTinevez</a> (<a href="index.php?title=User_talk:JeanYvesTinevez&amp;action=edit&amp;redlink=1" class="new" title="User talk:JeanYvesTinevez (page does not exist)">talk</a>) 13:44, 17 January 2017 (CST)
</p>
<!-- 
NewPP limit report
Cached time: 20200713074359
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.012 seconds
Real time usage: 0.014 seconds
Preprocessor visited node count: 50/1000000
Preprocessor generated node count: 116/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/3
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 - -total
-->
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="index.php?title=Using_TrackMate_from_MATLAB&amp;oldid=41416">http://imagej.net/index.php?title=Using_TrackMate_from_MATLAB&amp;oldid=41416</a>"</div>
							</div>

			<div id="footer">
				<p> This page was last modified on 24 January 2020, at 11:56.</p><ul><li><a href="./ImageJ:Privacy_policy" title="ImageJ:Privacy policy">Privacy policy</a></li><li><a href="./ImageJ:About" class="mw-redirect" title="ImageJ:About">About ImageJ</a></li><li><a href="Imprint" title="Imprint">Imprint</a></li></ul>			</div>

			<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="./Special:Categories" title="Special:Categories">Categories</a>: <ul><li><a href="./Category:Matlab" title="Category:Matlab">Matlab</a></li><li><a href="./Category:Scripting" title="Category:Scripting">Scripting</a></li><li><a href="./Category:Tracking" title="Category:Tracking">Tracking</a></li></ul></div></div>		</div>

		<div id="bottom-wrap">
			<div id="footer-wrap-inner">
				<div id="ternary" class="footer">
					<ul>
						<li class="widget">
							<img id="logo" src="skins/imagej-128.png" alt="">
						</li>
					</ul>
				</div>
			</div>
		</div>
		<script>(window.RLQ=window.RLQ||[]).push(function(){mw.loader.load(["ext.fancytree","ext.suckerfish","mediawiki.action.view.postEdit","site","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest","ext.SimpleTooltip"]);});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":252});});</script>
		</body>
		</html>
		